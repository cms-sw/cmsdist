diff -Naur orig.src/ConnectionService/src/ConnectionParams.h coral/ConnectionService/src/ConnectionParams.h
--- orig.src/ConnectionService/src/ConnectionParams.h	2006-11-22 10:31:43.000000000 +0100
+++ src/ConnectionService/src/ConnectionParams.h	2009-01-06 17:10:37.000000000 +0100
@@ -15,6 +15,9 @@
       public:
 
       /// constructor 
+      ConnectionParams( const std::string& connectionString );
+      
+      /// constructor 
       ConnectionParams( const std::string& connectionString,
                         const std::string& serviceName,
                         const std::string& technologyName,
@@ -30,6 +33,15 @@
       
       /// assignment operator
       ConnectionParams& operator=(const ConnectionParams& rhs);
+
+      /// setter for db parameters
+      void setDbParams(const std::string& serviceName,
+                       const std::string& technologyName,
+                       const std::string& schemaName);
+
+      /// setter for authentication parameters
+      void setAuthenticationParams(const std::string& userName,
+                                   const std::string& password );
       
       /// returns the user associated to the connection request
       const std::string& userName() const;
@@ -91,6 +103,18 @@
 }
 
 inline
+coral::ConnectionService::ConnectionParams::ConnectionParams( const std::string& connectionString ):
+  m_connectionString( connectionString ),
+  m_serviceName( "" ),
+  m_serviceKey( "" ),
+  m_technologyName( "" ),
+  m_schemaName( "" ),
+  m_userName( "" ),
+  m_password( "" ),
+  m_serviceParameters(){
+}
+
+inline
 coral::ConnectionService::ConnectionParams::ConnectionParams( const std::string& connectionString,
                                                               const std::string& serviceName,
                                                               const std::string& technologyName,
@@ -139,6 +163,26 @@
   return *this;
 }
 
+inline
+void
+coral::ConnectionService::ConnectionParams::setDbParams(const std::string& serviceName,
+                                                        const std::string& technologyName,
+                                                        const std::string& schemaName){
+  m_serviceName = serviceName;
+  m_serviceKey = technologyName;
+  m_serviceKey.append(":").append(m_serviceName);
+  m_technologyName = technologyName;
+  m_schemaName = schemaName;
+}
+
+inline
+void
+coral::ConnectionService::ConnectionParams::setAuthenticationParams(const std::string& userName,
+                                                                    const std::string& password ){
+  m_userName = userName;
+  m_password = password;
+}
+
 /// returns the user associated to the connection request
 inline
 const std::string&
diff -Naur orig.src/ConnectionService/src/ConnectionPool.cpp coral/ConnectionService/src/ConnectionPool.cpp
--- orig.src/ConnectionService/src/ConnectionPool.cpp	2008-03-28 17:44:34.000000000 +0100
+++ src/ConnectionService/src/ConnectionPool.cpp	2009-01-06 17:17:30.000000000 +0100
@@ -1,5 +1,6 @@
 #include "ConnectionPool.h"
 #include "ConnectionPoolTimer.h"
+#include "DataSource.h"
 #include "ReplicaCatalogue.h"
 #include "ConnectionServiceConfiguration.h"
 
@@ -223,19 +224,25 @@
 
   SessionHandle sessionHandle;
   
-  std::vector<ConnectionParams>* replicas = m_replicaCatalogue->getReplicas(connectionString, role, accessMode);
+  std::vector<ConnectionParams>* replicas = m_replicaCatalogue->getReplicas(connectionString, accessMode);
   
   unsigned int iReplica = 0;
   bool sessionOk = false;
   while( iReplica < replicas->size() && !sessionOk ){
-    sessionHandle = getSessionFromConnectionPool( (*replicas)[iReplica], accessMode );
-    sessionOk = sessionHandle.isOpen();
-    if( !sessionOk ) {
-      log << coral::Debug << "No valid connection for string \""<< connectionString << "\" found in the pool. Creating a new connection." << coral::MessageStream::endmsg;
-      if(!m_replicaCatalogue->isConnectionExcluded((*replicas)[iReplica].technologyName(),(*replicas)[iReplica].serviceName())){
-        sessionHandle = getSessionFromNewConnection( (*replicas)[iReplica], accessMode );
-        sessionOk = sessionHandle.isOpen();
+    ConnectionParams& params = (*replicas)[iReplica];
+    DataSource dataSource(m_connectionServiceConfiguration);
+    if(dataSource.setupForConnection( params, role )){
+      sessionHandle = getSessionFromConnectionPool( params, accessMode );
+      sessionOk = sessionHandle.isOpen();
+      if( !sessionOk ) {
+        log << coral::Debug << "No valid connection for string \""<< params.connectionString() << "\" found in the pool. Creating a new connection." << coral::MessageStream::endmsg;
+        if(!m_replicaCatalogue->isConnectionExcluded(params.technologyName(),params.serviceName())){
+          sessionHandle = getSessionFromNewConnection( params, accessMode );
+          sessionOk = sessionHandle.isOpen();
+        }
       }
+    } else {
+      log << coral::Info << "Replica with connection \""<<params.connectionString() <<"\" is invalid and will be skipped."<< coral::MessageStream::endmsg;
     }
     iReplica++;
   }
diff -Naur orig.src/ConnectionService/src/DataSource.cpp coral/ConnectionService/src/DataSource.cpp
--- orig.src/ConnectionService/src/DataSource.cpp	1970-01-01 01:00:00.000000000 +0100
+++ src/ConnectionService/src/DataSource.cpp	2009-01-06 17:10:37.000000000 +0100
@@ -0,0 +1,85 @@
+#include "DataSource.h"
+#include "ConnectionServiceConfiguration.h"
+#include "CoralBase/MessageStream.h"
+#include "RelationalAccess/AuthenticationServiceException.h"
+#include "RelationalAccess/IAuthenticationService.h"
+#include "RelationalAccess/IAuthenticationCredentials.h"
+#include "RelationalAccess/IRelationalDomain.h"
+#include "RelationalAccess/IRelationalService.h"
+
+/// constructor
+coral::ConnectionService::DataSource::DataSource( const ConnectionServiceConfiguration& serviceConfiguration ):
+  m_serviceConfiguration( serviceConfiguration ){
+}
+
+
+/// loads the required plugin library and retrieves the connection parametes
+bool coral::ConnectionService::DataSource::setupForConnection( ConnectionParams& connectionParameters,
+                                                               const std::string& role ){
+  bool isValid = false;
+  coral::MessageStream log( m_serviceConfiguration.serviceName() );
+  coral::IRelationalDomain* domain = 0;
+  const std::string& connectionString = connectionParameters.connectionString();
+  try {
+    domain = &m_serviceConfiguration.relationalService().domainForConnection( connectionString );
+  } catch (const std::runtime_error& e){
+    log << coral::Error << "Cannot find plugin for connection string \""<<connectionString<<"\": "<<e.what()<<coral::MessageStream::endmsg;
+    domain = 0;
+  }
+  if(domain){
+    std::pair<std::string,std::string> connTokens = domain->decodeUserConnectionString( connectionString );
+    bool authenticated = false;
+
+    connectionParameters.setDbParams(connTokens.first,
+                                     domain->flavorName(),
+                                     connTokens.second);
+    if(domain->isAuthenticationRequired( connTokens.first )){
+      try {
+        std::pair<std::string,std::string>* credentials = getCredentials( connectionString, role );
+        if(credentials){
+          authenticated = true;
+          connectionParameters.setAuthenticationParams(credentials->first,credentials->second);
+          delete credentials;
+        }
+      } catch (const AuthenticationServiceException& exc){
+        log << coral::Debug << "Could not retrieve credentials for connection \""<<connectionString<<"\" from authentication service: "<< exc.what() << coral::MessageStream::endmsg;
+      }
+    } else {
+      authenticated = true;
+    }
+    if(authenticated) {
+      isValid = true;
+    } else {
+      log << coral::Warning << "Replica on connection \""<<connectionString<<"\" cannot be used (no authentication provided)." << coral::MessageStream::endmsg;
+    }
+  }
+  return isValid;
+}
+
+
+/// returns the credentials for the specified connection string
+std::pair<std::string,std::string>*
+coral::ConnectionService::DataSource::getCredentials( const std::string& connectionString,
+                                                      const std::string& role ) const {
+  coral::IAuthenticationService& authenticationService = m_serviceConfiguration.authenticationService();
+  std::pair<std::string, std::string>* credentials =  new std::pair<std::string,std::string>("","");
+//  coral::MessageStream log( m_serviceConfiguration.serviceContext(),
+//                           m_serviceConfiguration.serviceName(),
+//                           coral::Verbose );
+  coral::MessageStream log( m_serviceConfiguration.serviceName() );
+  try {
+    if(role.empty()){
+      credentials->first = authenticationService.credentials( connectionString ).valueForItem( IAuthenticationCredentials::userItem() );
+      credentials->second = authenticationService.credentials( connectionString ).valueForItem( IAuthenticationCredentials::passwordItem());
+    } else {
+      credentials->first = authenticationService.credentials( connectionString, role ).valueForItem( IAuthenticationCredentials::userItem() );
+      credentials->second = authenticationService.credentials( connectionString, role ).valueForItem( IAuthenticationCredentials::passwordItem()  );
+    }
+  } catch (const coral::AuthenticationServiceException& exc) {
+    delete credentials;
+    credentials = 0;
+    throw;
+  }
+  return credentials;
+}
+
diff -Naur orig.src/ConnectionService/src/DataSource.h coral/ConnectionService/src/DataSource.h
--- orig.src/ConnectionService/src/DataSource.h	1970-01-01 01:00:00.000000000 +0100
+++ src/ConnectionService/src/DataSource.h	2009-01-06 17:10:37.000000000 +0100
@@ -0,0 +1,48 @@
+// -*-C++-*-
+#ifndef CONNECTIONSERVICE_DATASOURCE_H
+#define CONNECTIONSERVICE_DATASOURCE_H
+
+#include "ConnectionParams.h"
+
+#include "CoralBricks/ThreadTraits.h"
+
+#include <map>
+#include <vector>
+
+namespace coral {
+
+  namespace ConnectionService {
+
+    class ConnectionServiceConfiguration;
+
+    /// class providing data source paramters 
+    class DataSource {
+      
+      public:
+
+        /// constructor
+        DataSource( const ConnectionServiceConfiguration& serviceConfiguration );
+
+        /// destructor
+        virtual ~DataSource(){}
+
+        /// loads the required plugin library and retrieves the connection parametes
+        bool setupForConnection( ConnectionParams& connectionParameters, const std::string& role );
+
+      private:
+
+        std::pair<std::string,std::string>* getCredentials( const std::string& connectionString,
+                                                            const std::string& role) const;
+        
+      private:
+
+        /// the reference to the service configuration
+        const ConnectionServiceConfiguration& m_serviceConfiguration;
+
+    };
+  }
+}
+
+#endif
+
+
diff -Naur orig.src/ConnectionService/src/ReplicaCatalogue.cpp coral/ConnectionService/src/ReplicaCatalogue.cpp
--- orig.src/ConnectionService/src/ReplicaCatalogue.cpp	2008-03-28 18:43:24.000000000 +0100
+++ src/ConnectionService/src/ReplicaCatalogue.cpp	2009-01-06 17:17:30.000000000 +0100
@@ -4,12 +4,9 @@
 #include "RelationalAccess/ConnectionServiceException.h"
 #include "ConnectionServiceConfiguration.h"
 
-#include "RelationalAccess/AuthenticationServiceException.h"
 #include "RelationalAccess/ILookupService.h"
 #include "RelationalAccess/IDatabaseServiceSet.h"
 #include "RelationalAccess/IDatabaseServiceDescription.h"
-#include "RelationalAccess/IAuthenticationService.h"
-#include "RelationalAccess/IAuthenticationCredentials.h"
 #include "RelationalAccess/IRelationalService.h"
 #include "RelationalAccess/IRelationalDomain.h"
 #include "RelationalAccess/IReplicaSortingAlgorithm.h"
@@ -17,7 +14,7 @@
 #include "CoralBase/MessageStream.h"
 #include "CoralBase/TimeStamp.h"
 
-
+#include <stdexcept>
 #include <boost/date_time/posix_time/ptime.hpp>
 
 typedef coral::ConnectionService::ReplicaCatalogue::PosixTime CsPosixTime;
@@ -100,75 +97,16 @@
   return excluded;
 }
 
-/// returns the credentials for the specified connection string
-std::pair<std::string,std::string>*
-coral::ConnectionService::ReplicaCatalogue::getCredentials( const std::string& connectionString,
-                                                            const std::string& role ) const {
-  coral::IAuthenticationService& authenticationService = m_serviceConfiguration.authenticationService();
-  std::pair<std::string, std::string>* credentials =  new std::pair<std::string,std::string>("","");
-//  coral::MessageStream log( m_serviceConfiguration.serviceContext(),
-//                           m_serviceConfiguration.serviceName(),
-//                           coral::Verbose );
-  coral::MessageStream log( m_serviceConfiguration.serviceName() );
-  try {
-    if(role.empty()){
-      credentials->first = authenticationService.credentials( connectionString ).valueForItem( IAuthenticationCredentials::userItem() );
-      credentials->second = authenticationService.credentials( connectionString ).valueForItem( IAuthenticationCredentials::passwordItem());
-    } else {
-      credentials->first = authenticationService.credentials( connectionString, role ).valueForItem( IAuthenticationCredentials::userItem() );
-      credentials->second = authenticationService.credentials( connectionString, role ).valueForItem( IAuthenticationCredentials::passwordItem()  );
-    }
-  } catch (const coral::AuthenticationServiceException& exc) {
-    delete credentials;
-    credentials = 0;
-    throw;
-  }
-  return credentials;
-}
-
-
-
 /// returns an array of connection strings - the replicas of the specified connection
 std::vector<coral::ConnectionService::ConnectionParams>*
 coral::ConnectionService::ReplicaCatalogue::getReplicas( const std::string& connectionString,
-                                                         const std::string& role,
                                                          AccessMode accessMode ) const
 {
-//  coral::MessageStream log( m_serviceConfiguration.serviceContext(),
-//                           m_serviceConfiguration.serviceName(),
-//                           coral::Verbose );
   coral::MessageStream log( m_serviceConfiguration.serviceName() );
   
   std::vector<ConnectionParams>*  replicas = new std::vector<ConnectionParams>;
-  bool readOnlyOnUpdate = m_serviceConfiguration.isReadOnlySessionOnUpdateConnectionsEnabled();
   if(isConnectionPhysical( connectionString )) {
-    coral::IRelationalDomain& domain =
-      m_serviceConfiguration.relationalService().domainForConnection( connectionString );
-    std::pair<std::string,std::string> connParams = domain.decodeUserConnectionString( connectionString );
-
-    std::string userName("");
-    std::string password("");
-    bool authenticated = false;
-    if(domain.isAuthenticationRequired( connParams.first )){
-      std::pair<std::string,std::string>* credentials = getCredentials( connectionString, role );
-      if(credentials){
-        authenticated = true;
-        userName = credentials->first;
-        password = credentials->second;
-        delete credentials;
-      } else {
-        // should never happen...
-        throw ConnectionServiceException("Could not find authentication credentials.","ReplicaCatalogue::getReplicas");
-      }
-    } else {
-      authenticated = true;
-    }
-    if(authenticated) replicas->push_back( ConnectionParams(connectionString,
-                                                            connParams.first,
-                                                            domain.flavorName(),
-                                                            connParams.second,
-                                                            userName,
-                                                            password) );
+    replicas->push_back( ConnectionParams(connectionString) );
   } else {
     log << coral::Debug << "Looking up "<<
       ((accessMode==coral::ReadOnly)? std::string("read-only") : std::string("update") )<<
@@ -194,58 +132,43 @@
     for(int i=0;i<numOfReplicas;i++){
       std::string replicaConnectionString = sortedReplicaSet[ i ]->connectionString();
       if(replicaConnectionString.empty()) continue;
-      coral::IRelationalDomain& domain =
-        m_serviceConfiguration.relationalService().domainForConnection( replicaConnectionString );
-      std::pair<std::string,std::string> connParams = domain.decodeUserConnectionString( replicaConnectionString );
-
-      if((accessMode==coral::Update) || // update capable connection are selected by the lookup
-         readOnlyOnUpdate || // for read-only connection the lookup will also consider the update
-         (dbSet->replica( i ).accessMode()==coral::ReadOnly)) // otherwise strictly select the read-only capable connection
-      {
-        std::string userName("");
-        std::string password("");
-        bool authenticated = false;
-
-        if(domain.isAuthenticationRequired( connParams.first )){
-          try {
-            std::pair<std::string,std::string>* credentials = getCredentials( replicaConnectionString, role );
-            if(credentials){
-              authenticated = true;
-              userName = credentials->first;
-              password = credentials->second;
-              delete credentials;
-            }
-          } catch (const AuthenticationServiceException& exc){
-            log << coral::Debug << "Could not retrieve credentials for connection \""<<replicaConnectionString<<"\" from authentication service: "<< exc.what() << coral::MessageStream::endmsg;
-          }
-        } else {
-          authenticated = true;
-        }
-        if(authenticated) {
-          ConnectionParams connPars(replicaConnectionString,
-                                    connParams.first,
-                                    domain.flavorName(),
-                                    connParams.second,
-                                    userName,password);
+      coral::IRelationalDomain* domain = 0;
+      try {
+        domain = &m_serviceConfiguration.relationalService().domainForConnection( replicaConnectionString );
+      } catch (const std::runtime_error& e){
+        log << coral::Error << "Cannot find plugin for connection string \""<<replicaConnectionString<<"\": "<<e.what()<<coral::MessageStream::endmsg;
+        domain = 0;
+      }
+      
+      if(domain){
+        std::pair<std::string,std::string> connParams = domain->decodeUserConnectionString( replicaConnectionString );
+
+        bool readOnlyOnUpdate = m_serviceConfiguration.isReadOnlySessionOnUpdateConnectionsEnabled();
+        if((accessMode==coral::Update) || // update capable connection are selected by the lookup
+           readOnlyOnUpdate || // for read-only connection the lookup will also consider the update
+           (dbSet->replica( i ).accessMode()==coral::ReadOnly)) // otherwise strictly select the read-only capable connection
+        {
+          ConnectionParams connPars(replicaConnectionString);
           // loading service-specific parameters
           std::string connRetrPeriod =
             sortedReplicaSet[ i ]->serviceParameter(coral::IDatabaseServiceDescription::connectionRetrialPeriodParam());
           if(!connRetrPeriod.empty())
             connPars.serviceParameters().insert(
               std::make_pair(coral::IDatabaseServiceDescription::connectionRetrialPeriodParam(),connRetrPeriod));
+
           std::string connRetrTime =
             sortedReplicaSet[ i ]->serviceParameter(coral::IDatabaseServiceDescription::connectionRetrialTimeOutParam());
           if(!connRetrTime.empty())
             connPars.serviceParameters().insert(
               std::make_pair(coral::IDatabaseServiceDescription::connectionRetrialTimeOutParam(),connRetrTime));
+
           std::string connTime =
             sortedReplicaSet[ i ]->serviceParameter(coral::IDatabaseServiceDescription::connectionTimeOutParam());
           if(!connTime.empty())
             connPars.serviceParameters().insert(
               std::make_pair(coral::IDatabaseServiceDescription::connectionTimeOutParam(),connTime));
+          
           replicas->push_back( connPars );
-        } else {
-          log << coral::Warning << "Replica on connection \""<<replicaConnectionString<<"\" skipped (no authentication provided)." << coral::MessageStream::endmsg;
         }
       }
     }
diff -Naur orig.src/ConnectionService/src/ReplicaCatalogue.h coral/ConnectionService/src/ReplicaCatalogue.h
--- orig.src/ConnectionService/src/ReplicaCatalogue.h	2008-08-08 01:19:01.000000000 +0200
+++ src/ConnectionService/src/ReplicaCatalogue.h	2009-01-06 17:17:30.000000000 +0100
@@ -37,7 +37,6 @@
       
       /// returns an array of connection strings - the replicas of the specified connection
       std::vector<ConnectionParams>* getReplicas( const std::string& connectionString,
-                                                  const std::string& role,
                                                   AccessMode accessMode ) const;
       /// sets the specified connection as unavailable 
       void setConnectionExcluded( const std::string& technologyName,
@@ -47,10 +46,6 @@
       bool isConnectionExcluded( const std::string& technologyName,
                                  const std::string& serviceName ) const;
       
-      /// returns the credentials for the specified connection string
-      std::pair<std::string,std::string>*  getCredentials( const std::string& connectionString,
-                                                           const std::string& role ) const;
-      
       private:
 
       /// the reference to the service configuration
diff -Naur orig.src/CoralBase/CoralBase/AttributeSpecification.h coral/CoralBase/CoralBase/AttributeSpecification.h
--- orig.src/CoralBase/CoralBase/AttributeSpecification.h	2005-12-01 10:08:09.000000000 +0100
+++ src/CoralBase/CoralBase/AttributeSpecification.h	2009-01-05 16:30:56.000000000 +0100
@@ -99,7 +99,7 @@
   {}
 
 
-  inline 
+  inline
   AttributeSpecification::AttributeSpecification( const AttributeSpecification& rhs ):
     m_name( rhs.m_name ),
     m_type( rhs.m_type )
@@ -120,14 +120,14 @@
   {
     return m_name;
   }
-  
+
 
   inline const std::type_info&
   AttributeSpecification::type() const
   {
     return *m_type;
   }
-  
+
 
   inline std::string
   AttributeSpecification::typeName() const
@@ -142,7 +142,7 @@
     return ( this->m_name == rhs.m_name &&
              *( this->m_type ) == *( rhs.m_type ) );
   }
-  
+
   inline bool
   AttributeSpecification::operator!=( const AttributeSpecification& rhs ) const
   {
diff -Naur orig.src/CoralBase/src/AttributeSpecification.cpp coral/CoralBase/src/AttributeSpecification.cpp
--- orig.src/CoralBase/src/AttributeSpecification.cpp	2007-02-13 12:13:28.000000000 +0100
+++ src/CoralBase/src/AttributeSpecification.cpp	2008-12-19 18:58:48.000000000 +0100
@@ -3,7 +3,6 @@
 #include "CoralBase/Blob.h"
 #include "CoralBase/Date.h"
 #include "CoralBase/TimeStamp.h"
-
 coral::AttributeSpecification::AttributeSpecification( const std::string& name, const std::type_info& type ):
   m_name( name ),
   m_type( AttributeSpecification::validateType( type ) )
@@ -21,6 +20,7 @@
   if ( type == typeid(bool) ) return "bool";
   else if ( type == typeid(char) ) return "char";
   else if ( type == typeid(unsigned char) ) return "unsigned char";
+  else if ( type == typeid(signed char) ) return "char";
   else if ( type == typeid(short) ) return "short";
   else if ( type == typeid(unsigned short) ) return "unsigned short";
   else if ( type == typeid(int) ) return "int";
@@ -49,6 +49,7 @@
   if ( typeName == "bool" ) return &( typeid(bool) );
   else if ( typeName == "char" ) return &( typeid(char) );
   else if ( typeName == "unsigned char" ) return &( typeid(unsigned char) );
+  else if ( typeName == "signed char" ) return &( typeid(char) );
   else if ( typeName == "short" ) return &( typeid(short) );
   else if ( typeName == "unsigned short" ) return &( typeid(unsigned short) );
   else if ( typeName == "int" ) return &( typeid(int) );
@@ -93,7 +94,10 @@
        type == typeid(coral::Blob) ||
        type == typeid(coral::Date) ||
        type == typeid(coral::TimeStamp) ) return &type;
-
+  //
+  //here we assume char type is always signed following original coral assumption.
+  //
+  if (type == typeid(signed char)) return &(typeid(char));
   // Type not supported
   throw coral::AttributeListException( "Type \"" + std::string( type.name() ) + "\" is not supported" );
   return 0;
diff -Naur orig.src/CoralBase/src/Regexp.cpp coral/CoralBase/src/Regexp.cpp
--- orig.src/CoralBase/src/Regexp.cpp	2008-10-27 23:20:38.000000000 +0100
+++ src/CoralBase/src/Regexp.cpp	2009-01-06 16:51:14.000000000 +0100
@@ -3,8 +3,10 @@
 #include "CoralBase/Regexp.h"
 #include "CoralBase/RegexpMatch.h"
 #include "CoralBase/RegexpError.h"
-#include "pcre.h"
-#include <regex.h>
+
+#include <pcre.h>
+#include <pcreposix.h>
+
 #include <cstring>
 
 namespace coral {
@@ -790,7 +792,7 @@
     // An invalid pattern always fails to match.  Don't touch
     // the result, it is assumed to be only added to.
     if (! m_rep || ! m_rep->good ())
-	return -1;
+	return false;
 
     // Adjust offset
     if (offset < 0)
diff -Naur orig.src/CoralBase/src/StringOps.cpp coral/CoralBase/src/StringOps.cpp
--- orig.src/CoralBase/src/StringOps.cpp	2008-10-27 23:20:38.000000000 +0100
+++ src/CoralBase/src/StringOps.cpp	2008-12-05 14:43:07.000000000 +0100
@@ -292,8 +292,8 @@
 	// separator at the end of s.  This may match a null-length
 	// string at index, that's ok since it's handled in loop code
 	// below (begin will be one less than index).
-	if ((match = rawfind(s, sep, index, flags & CaseInsensitiveSep)) == -1)
-	    match = s.size ();
+	match = rawfind(s, sep, index, (flags & CaseInsensitiveSep) != 0);
+	if (match == -1) match = s.size ();
 
 	// We have a field, determine what to do with it.  If it is
 	// null, push it to pos but don't move the mark.
@@ -422,9 +422,8 @@
 	// separator at the end of s.  This may match a null-length
 	// string at index, that's ok since it's handled in loop code
 	// below (begin will be one less than index).
-	if ((match = rawfind (s, sep.c_str (), sep.size (), index,
-			      flags & CaseInsensitiveSep)) == -1)
-	    match = s.size ();
+	match = rawfind (s, sep.c_str (), sep.size (), index, (flags & CaseInsensitiveSep) != 0);
+	if (match == -1) match = s.size ();
 
 	// We have a field, determine what to do with it.  If it is
 	// null, push it to pos but don't move the mark.
diff -Naur orig.src/CoralBase/tests/AttributeReadWrite/attributeReadWrite.cpp coral/CoralBase/tests/AttributeReadWrite/attributeReadWrite.cpp
--- orig.src/CoralBase/tests/AttributeReadWrite/attributeReadWrite.cpp	2008-10-28 20:26:33.000000000 +0100
+++ src/CoralBase/tests/AttributeReadWrite/attributeReadWrite.cpp	2008-12-05 12:31:48.000000000 +0100
@@ -53,7 +53,7 @@
     try {
 		// Must throw exception
 		attribute.data<double>() = 11.22;
-	} catch ( coral::AttributeException& e ) {
+	} catch ( coral::AttributeException& ) {
 		thrown = true;
 	} catch (...) { throw; }
 	
@@ -68,7 +68,7 @@
 		// also... (the const method)
 		const coral::Attribute& cAttr = attribute;
 		cAttr.data<double>();
-	} catch ( coral::AttributeException& e ) {
+	} catch ( coral::AttributeException& ) {
 		thrown = true;
 	} catch (...) { throw; }
 	
diff -Naur orig.src/CoralBase/tests/BlobReadWrite/blobReadWrite.cpp coral/CoralBase/tests/BlobReadWrite/blobReadWrite.cpp
--- orig.src/CoralBase/tests/BlobReadWrite/blobReadWrite.cpp	2008-01-16 17:13:26.000000000 +0100
+++ src/CoralBase/tests/BlobReadWrite/blobReadWrite.cpp	2008-12-05 12:31:49.000000000 +0100
@@ -7,9 +7,9 @@
 {
   try {
     coral::Blob blob1;
-    
+
     coral::Blob blob1cp( blob1 );
-    
+
     coral::Blob blob1cpasgn = blob1;
 
     blob1cp = blob1cpasgn;
@@ -23,15 +23,15 @@
     float* addressToElement = static_cast< float* >( blob1.startingAddress() );
 
     for ( int i = 0; i < numberOfElements; ++i, ++addressToElement ) {
-      *addressToElement = i;
+      *addressToElement = (float)i;
     }
 
     int extraElements = 512;
     blob1.extend( extraElements * sizeof(float) );
     addressToElement = static_cast< float* >( blob1.startingAddress() );
-    for ( int i = 0; i < numberOfElements; ++i, ++addressToElement );
+    for ( int i = 0; i < numberOfElements; ++i, ++addressToElement ) {}
     for ( int i = numberOfElements; i < numberOfElements + extraElements; ++i, ++addressToElement ) {
-      *addressToElement = i;
+      *addressToElement = (float)i;
     }
 
     int numberOfDroppedElements = 126;
@@ -49,7 +49,7 @@
     coral::Blob blob2( 100 * sizeof(float) );
     addressToElement = static_cast< float* >( blob2.startingAddress() );
     for ( int i = 0; i < 100; ++i, ++addressToElement ) {
-      *addressToElement = i + numberOfElements;
+      *addressToElement = (float)i + numberOfElements;
     }
 
     blob1 += blob2;
diff -Naur orig.src/CoralBricks/CoralBricks/BoostThreadTraits.h coral/CoralBricks/CoralBricks/BoostThreadTraits.h
--- orig.src/CoralBricks/CoralBricks/BoostThreadTraits.h	2008-10-16 05:20:33.000000000 +0200
+++ src/CoralBricks/CoralBricks/BoostThreadTraits.h	2008-11-13 15:51:39.000000000 +0100
@@ -1,8 +1,8 @@
-/* 
+/*
  * Project: POOL
  * Sub-project: CORAL
  * Web site: http://pool.cern.ch/coral
- * 
+ *
  * Author: Zsolt.Molnar@cern.ch (http://www.zsoltmolnar.hu)
  */
 #ifndef CORALBRICKS_BOOSTTHREADTRAITS_H_
@@ -11,7 +11,7 @@
 /**
  * Include this file only from ThreadTraits. If you include it from elsewhere,
  * you will get compilation error.
- */ 
+ */
 
 #ifndef __THREADTRAITS_H_GUARD__
   #error File is included from elsewhere that ThreadTraits.h
@@ -29,6 +29,7 @@
 #endif
 
 #include <boost/thread.hpp>
+#include <boost/thread/condition.hpp>
 
 #ifndef BOOST_HAS_THREADS
   #error Threaded version of Boost is required.
@@ -56,7 +57,7 @@
         return 0;
     }
 #endif
-    
+
 };
 
 } // namespace coral
diff -Naur orig.src/CoralCommon/CoralCommon/base.h coral/CoralCommon/CoralCommon/base.h
--- orig.src/CoralCommon/CoralCommon/base.h	2008-09-23 20:13:27.000000000 +0200
+++ src/CoralCommon/CoralCommon/base.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,33 +0,0 @@
-/* 
- * Project: POOL
- * Sub-project: CORAL
- * Web site: http://pool.cern.ch/coral
- * 
- * Author: Zsolt.Molnar@cern.ch (http://www.zsoltmolnar.hu)
- */
-#ifndef CORALCOMMON_BASE_H_
-#define CORALCOMMON_BASE_H_
-
-#ifndef START_CORALCOMMON_NAMESPACE
-  #define START_CORALCOMMON_NAMESPACE namespace coral { namespace CoralCommon {
-#endif
-
-#ifndef END_CORALCOMMON_NAMESPACE
-  #define END_CORALCOMMON_NAMESPACE } } 
-#endif
-
-#ifndef CORALCOMMON_NAMESPACE_NAME
-  #define CORALCOMMON_NAMESPACE_NAME coral::CoralCommon
-#endif
-
-#include <assert.h>
-#define CORALCOMMON_FORCE_CRASH_HERE assert(0);
-
-#ifdef NDEBUG
-  #define CORALCOMMON_DEBUG_ASSERT(x) 
-#else
-  #define CORALCOMMON_DEBUG_ASSERT(x) assert((x));
-#endif
-
-#endif // #ifndef CORALCOMMON_BASE_H_
-
diff -Naur orig.src/CoralCommon/CoralCommon/ExpressionParser.h coral/CoralCommon/CoralCommon/ExpressionParser.h
--- orig.src/CoralCommon/CoralCommon/ExpressionParser.h	2008-11-06 17:27:52.000000000 +0100
+++ src/CoralCommon/CoralCommon/ExpressionParser.h	2008-12-11 15:42:27.000000000 +0100
@@ -8,8 +8,6 @@
 #ifndef CORALCOMMON_EXPRESSIONPARSER_H
 #define CORALCOMMON_EXPRESSIONPARSER_H
 
-#include "base.h"
-
 #include <string>
 #include <map>
 #include <set>
@@ -21,7 +19,7 @@
   class AttributeList;
 }
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
 /// Simple class to identify table elements in an expression, appending double quotes arround each identified variable
 
@@ -62,6 +60,6 @@
   std::set< std::string> m_bindVariables;
 };
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace CoralCommon, coral
 
 #endif // #ifndef CORALCOMMON_EXPRESSIONPARSER_H
diff -Naur orig.src/CoralCommon/CoralCommon/IDevSession.h coral/CoralCommon/CoralCommon/IDevSession.h
--- orig.src/CoralCommon/CoralCommon/IDevSession.h	2008-11-05 15:31:13.000000000 +0100
+++ src/CoralCommon/CoralCommon/IDevSession.h	2008-12-17 22:41:38.000000000 +0100
@@ -25,7 +25,7 @@
     bool isValid() const;
 
     /**
-     * Returns the technology name for the remote session.
+     * Returns the server version for the remote session.
      * For plugins establishing a database connection through a middle-tier 
      * (e.g. CoralAccess), this method is overloaded because the value
      * is discovered only when establishing the remote session.
diff -Naur orig.src/CoralCommon/src/ExpressionParser.cpp coral/CoralCommon/src/ExpressionParser.cpp
--- orig.src/CoralCommon/src/ExpressionParser.cpp	2008-11-06 17:48:19.000000000 +0100
+++ src/CoralCommon/src/ExpressionParser.cpp	2008-12-11 15:42:27.000000000 +0100
@@ -17,9 +17,9 @@
 
 #include <sstream>
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
-ExpressionParser::ExpressionParser() 
+ExpressionParser::ExpressionParser()
   : m_tablesAndColumns()
   , m_tableAliases()
   , m_bindVariables()
@@ -36,7 +36,7 @@
 {
   std::set< std::string>& variables = m_tablesAndColumns[description.name()];
   int numberOfColumns = description.numberOfColumns();
-  for ( int i = 0; i < numberOfColumns; ++i ) 
+  for ( int i = 0; i < numberOfColumns; ++i )
   {
     variables.insert(description.columnDescription(i).name());
   }
@@ -159,4 +159,4 @@
   }
 }
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace CoralCommon, coral
diff -Naur orig.src/CoralCommon/tests/Timer/timer.cpp coral/CoralCommon/tests/Timer/timer.cpp
--- orig.src/CoralCommon/tests/Timer/timer.cpp	2008-03-05 13:03:23.000000000 +0100
+++ src/CoralCommon/tests/Timer/timer.cpp	2008-11-18 14:34:06.000000000 +0100
@@ -9,20 +9,20 @@
   try
   {
     coral::SimpleTimer st;
-    
+
     if( st.total() != 0 )
       throw std::logic_error( "Invalid total duration of an idle timer!" );
-    
+
     st.start();
-    
+
     if( st.total() != 0 )
       throw std::logic_error( "Invalid total duration of an empty timer!" );
-    
+
     coral::SimpleTimer::ValueType snap1 = st.sample();
-    
+
     if( snap1 == 0 )
       throw std::logic_error( "Invalid sample duration of a running timer!" );
-    
+
     if( st.total() != snap1 )
       throw std::logic_error( "Invalid total duration of a running timer!" );
 
@@ -32,7 +32,7 @@
 
     if( snap2 == 0 )
       throw std::logic_error( "Invalid sample duration of a running timer!" );
-    
+
     if( st.total() != snap2 )
       throw std::logic_error( "Invalid total duration of a running timer!" );
 
@@ -47,20 +47,20 @@
     coral::sys::sleep(2);
     slt.stop();
     std::cout << "Was supposed to sleep for 2 secs and was sleeping roughly the " << slt.total() << " microseconds" << std::endl;
-    
-        
+
+
     coral::SimpleTimer::ValueType snap3 = st.sample();
-    
-    for( int i=0; i<100000; i++ );
-    
+
+    for( int i=0; i<100000; i++ ) {};
+
     st.stop();
-    
+
     std::cout << "100000 iterations loop running for " << st.total()-snap3 << " microseconds" << std::endl;
-    
+
     if( st.total() <= snap2 )
       throw std::logic_error( "Invalid total duration of a stopped timer!" );
 
-    
+
     std::cout << "Total running time " << st.total() << " microseconds" << std::endl;
   }
   catch( const std::exception& e )
@@ -71,6 +71,6 @@
   {
     std::cerr << "Caught an unknown exception..." << std::endl;
   }
-  
+
   return 0;
 }
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.cpp coral/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.cpp
--- orig.src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.cpp	2008-10-09 22:36:54.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.cpp	2008-12-11 17:34:37.000000000 +0100
@@ -9,7 +9,7 @@
 #include "CoralCommon/ExpressionParser.h"
 #include "ExpressionParserTest.h"
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
 void ExpressionParserTest::testSingleQuote()
 {
@@ -17,4 +17,4 @@
 
 }
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace coral, CoralCommon
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.h coral/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.h
--- orig.src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.h	2008-10-12 00:00:53.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/ExpressionParserTest.h	2008-12-11 17:34:37.000000000 +0100
@@ -9,9 +9,8 @@
 #define CORALCOMMON_EXPRESSIONPARSERTEST_H
 
 #include "UnitTests/UnitTestBase.h"
-#include "CoralCommon/base.h"
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
 #define TEST_NAMES (testSingleQuote)
 
@@ -31,7 +30,7 @@
 	BOOST_PP_SEQ_FOR_EACH(TESTBASE_METHODEF, ~, TEST_NAMES)
 };
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace coral, CoralCommon
 
 #undef CLASS_NAME
 #undef TEST_NAMES
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/TestBase.h coral/CoralCommon/tests/UnitTestSuite/TestBase.h
--- orig.src/CoralCommon/tests/UnitTestSuite/TestBase.h	2008-10-09 22:36:54.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/TestBase.h	2008-12-11 17:44:06.000000000 +0100
@@ -9,6 +9,5 @@
 #define CORALCOMMON_TESTS_TESTBASE_H
 
 #include "UnitTests/UnitTestBase.h"
-#include "CoralCommon/base.h"
 
 #endif /* #ifndef CORALCOMMON_TESTS_TESTBASE_H*/
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/testSuite.cpp coral/CoralCommon/tests/UnitTestSuite/testSuite.cpp
--- orig.src/CoralCommon/tests/UnitTestSuite/testSuite.cpp	2008-10-09 22:36:54.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/testSuite.cpp	2008-12-11 17:44:06.000000000 +0100
@@ -9,13 +9,13 @@
 #include "ExpressionParserTest.h"
 #include "UriParserTest.h"
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 // Registered tests
 // comment out the test that you do not want to run
 CPPUNIT_TEST_SUITE_REGISTRATION (ExpressionParserTest);
 CPPUNIT_TEST_SUITE_REGISTRATION (UriParserTest);
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace coral, CoralCommon
 
 int main ()
 {
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/UriParserTest.cpp coral/CoralCommon/tests/UnitTestSuite/UriParserTest.cpp
--- orig.src/CoralCommon/tests/UnitTestSuite/UriParserTest.cpp	2008-10-09 22:36:54.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/UriParserTest.cpp	2008-12-11 17:44:06.000000000 +0100
@@ -10,7 +10,7 @@
 #include "CoralCommon/URIParser.h"
 #include "UriParserTest.h"
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
 void UriParserTest::test()
 {
@@ -54,4 +54,4 @@
 	);
 }
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace coral, CoralCommon
diff -Naur orig.src/CoralCommon/tests/UnitTestSuite/UriParserTest.h coral/CoralCommon/tests/UnitTestSuite/UriParserTest.h
--- orig.src/CoralCommon/tests/UnitTestSuite/UriParserTest.h	2008-10-09 22:36:54.000000000 +0200
+++ src/CoralCommon/tests/UnitTestSuite/UriParserTest.h	2008-12-11 17:44:06.000000000 +0100
@@ -11,9 +11,8 @@
 #include <boost/tuple/tuple_comparison.hpp>
 
 #include "UnitTests/UnitTestBase.h"
-#include "CoralCommon/base.h"
 
-START_CORALCOMMON_NAMESPACE
+namespace coral { namespace CoralCommon {
 
 #define TEST_NAMES (test)
 
@@ -38,7 +37,7 @@
 	URIParserTest_Results _testParser(const std::string& uri);
 };
 
-END_CORALCOMMON_NAMESPACE
+} } // namespace coral, CoralCommon
 
 #undef CLASS_NAME
 
diff -Naur orig.src/CoralKernel/CoralKernel/Context.h coral/CoralKernel/CoralKernel/Context.h
--- orig.src/CoralKernel/CoralKernel/Context.h	2008-08-08 00:53:29.000000000 +0200
+++ src/CoralKernel/CoralKernel/Context.h	2008-11-24 15:34:41.000000000 +0100
@@ -35,7 +35,7 @@
     template< typename T > IHandle<T> query()
     {
       boost::mutex::scoped_lock lock( m_mutex );
-      
+
       for ( std::map<std::string, ILoadableComponent*>::iterator
               iComponent = m_components.begin(); iComponent != m_components.end(); ++iComponent )
       {
@@ -46,7 +46,7 @@
           return IHandle<T>( component );
         }
       }
-      
+
       // Return an empty handle
       return IHandle<T>();
     }
@@ -55,14 +55,14 @@
     template< typename T > IHandle<T> query( const std::string& name )
     {
       boost::mutex::scoped_lock lock( m_mutex );
-      
+
       std::map<std::string, ILoadableComponent*>::iterator iComponent = m_components.find( name );
-      
+
       if ( iComponent == m_components.end() )
         return IHandle<T>();
-      
+
       T* component = dynamic_cast<T*>( iComponent->second );
-      
+
       if ( component != 0 )
       {
         iComponent->second->addReference();
@@ -73,13 +73,17 @@
         return IHandle<T>();
       }
     }
-    
+
     /// Returns the CORAL property manager component
     IPropertyManager& PropertyManager();
 
-    /// Returns the list of plugins loaded
+    /// Returns the list of the components known bt the internal CORAL
+    /// plugin manager
     std::set<std::string> knownComponents() const;
 
+    /// Returns the list of plugins loaded
+    std::set<std::string> loadedComponents() const;
+
   private:
     /// Constructor
     Context( coral::IPluginManager* pluginManager = 0 );
@@ -99,14 +103,15 @@
     boost::mutex   m_mutex;
 
     /// The loaded components
-    std::map<std::string, ILoadableComponent*> m_components;
+    typedef std::map<std::string, ILoadableComponent*> m_components_type;
+	m_components_type m_components;
 
     /// The internal plugin manager
     mutable coral::PluginManager*  m_nativePluginManager;
-    
+
     /// The plugin manager proxy
     mutable coral::IPluginManager* m_pluginManager;
-    
+
     /// The property manager
 	boost::scoped_ptr<coral::IPropertyManager> m_propertyManager;
   };
diff -Naur orig.src/CoralKernel/src/Context.cpp coral/CoralKernel/src/Context.cpp
--- orig.src/CoralKernel/src/Context.cpp	2008-05-21 20:13:37.000000000 +0200
+++ src/CoralKernel/src/Context.cpp	2008-11-24 15:34:41.000000000 +0100
@@ -1,3 +1,5 @@
+#include <boost/foreach.hpp>
+
 #include "CoralKernel/Context.h"
 #include "CoralKernel/ILoadableComponent.h"
 
@@ -8,7 +10,7 @@
 coral::Context::instance( coral::IPluginManager* pluginManager )
 {
   static coral::Context theInstance( pluginManager );
-  
+
   return theInstance;
 }
 
@@ -41,7 +43,7 @@
       m_nativePluginManager = new coral::PluginManager();
       m_pluginManager = m_nativePluginManager;
     }
-    
+
     thePluginManager = m_pluginManager;
   }
 
@@ -60,10 +62,21 @@
 }
 
 std::set<std::string>
+coral::Context::loadedComponents() const
+{
+	std::set<std::string> comlist;
+
+	BOOST_FOREACH (m_components_type::value_type v, m_components)
+		comlist.insert(v.first);
+
+	return comlist;
+}
+
+std::set<std::string>
 coral::Context::knownComponents() const
-{  
-  std::set<std::string> comlist = m_pluginManager->knownPlugins();
-  return comlist;
+{
+	std::set<std::string> comlist = m_pluginManager->knownPlugins();
+	return comlist;
 }
 
 coral::Context::Context( coral::IPluginManager* pluginManager ):
@@ -71,7 +84,7 @@
   m_components(),
   m_pluginManager( 0 ),
   m_propertyManager(new coral::PropertyManager)
-{  
+{
   if ( pluginManager == 0 )
   {
     boost::mutex::scoped_lock lock( m_mutex );
diff -Naur orig.src/CoralKernel/src/PluginManager.cpp coral/CoralKernel/src/PluginManager.cpp
--- orig.src/CoralKernel/src/PluginManager.cpp	2008-11-06 10:48:57.000000000 +0100
+++ src/CoralKernel/src/PluginManager.cpp	2008-11-20 14:39:27.000000000 +0100
@@ -92,6 +92,9 @@
   pluginName  = "CORAL/Services/XMLAuthenticationService"; libraryName = "XMLAuthenticationService";
   m_factories.insert( std::make_pair( pluginName, std::make_pair( libraryName, p ) ) );
   
+  pluginName  = "CORAL/Services/RelationalAuthenticationService"; libraryName = "RelationalAuthenticationService";
+  m_factories.insert( std::make_pair( pluginName, std::make_pair( libraryName, p ) ) );
+
   pluginName  = "CORAL/Services/XMLLookupService"; libraryName = "XMLLookupService";
   m_factories.insert( std::make_pair( pluginName, std::make_pair( libraryName, p ) ) );
 
diff -Naur orig.src/CoralKernel/src/PropertyManager.cpp coral/CoralKernel/src/PropertyManager.cpp
--- orig.src/CoralKernel/src/PropertyManager.cpp	2008-11-06 10:48:57.000000000 +0100
+++ src/CoralKernel/src/PropertyManager.cpp	2008-11-20 14:39:27.000000000 +0100
@@ -23,6 +23,8 @@
 
 void PropertyManager::_setDefaultProperties()
 {
+	_addProperty("CredentialDatabase", "sqlite_file:coral_credentials.db");
+	_addProperty("EncryptionKey","");
 	_addProperty("AuthenticationFile", "authentication.xml");
 	_addProperty("DBLookupFile", "dblookup.xml");
 	_addProperty("Server_Hostname", "localhost");
diff -Naur orig.src/CoralKernel/tests/PropertyManager/main.cpp coral/CoralKernel/tests/PropertyManager/main.cpp
--- orig.src/CoralKernel/tests/PropertyManager/main.cpp	2008-10-07 16:20:18.000000000 +0200
+++ src/CoralKernel/tests/PropertyManager/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,112 +0,0 @@
-#include <boost/bind.hpp>
-
-#include "UnitTests/cppunit_wrapper.h"
-
-#include "CoralKernel/Context.h"
-#include "CoralKernel/IPropertyManager.h"
-#include "CoralKernel/Property.h"
-
-class PropertyManagerTest : public CPPUNIT_NS :: TestFixture
-{
-    CPPUNIT_TEST_SUITE (PropertyManagerTest);
-    CPPUNIT_TEST (testDefaults);
-    CPPUNIT_TEST (testPropertySetting);
-    CPPUNIT_TEST (testMissingPropertySetting);
-    CPPUNIT_TEST (testCallback);
-    CPPUNIT_TEST_SUITE_END ();
-
-public:
-    void setUp (void) 
-    {
-    	pm = &coral::Context::instance().PropertyManager();
-    }
-    
-    void tearDown (void) {}
- 
-protected:
-	void testDefaults() 
-	{
-		coral::IProperty* p1 = pm->property("AuthenticationFile");
-		CPPUNIT_ASSERT(p1);
-		CPPUNIT_ASSERT_EQUAL(std::string("authentication.xml"), p1->get());
-		p1 = pm->property("DBLookupFile");
-		CPPUNIT_ASSERT(p1);
-		CPPUNIT_ASSERT_EQUAL(std::string("dblookup.xml"), p1->get());
-		// For the rest, check only the existence of the properties
-		CPPUNIT_ASSERT(pm->property("Server_Hostname"));
-		CPPUNIT_ASSERT(pm->property("Server_Port"));
-	}
-	
-	void testPropertySetting() 
-	{
-		coral::IProperty* p1 = pm->property("AuthenticationFile");
-		CPPUNIT_ASSERT(p1);
-		CPPUNIT_ASSERT(p1->set("newValue"));
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), p1->get());
-		// New search
-		coral::IProperty* p2 = pm->property("AuthenticationFile");
-		CPPUNIT_ASSERT(p2);
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), p2->get());
-	}
-	
-	void testMissingPropertySetting() 
-	{
-		coral::IProperty* p1 = pm->property("SurelyMissingProperty");
-		CPPUNIT_ASSERT(!p1);
-	}
-	
-	struct TestCallback 
-	{
-		void set (const std::string& v) {val = v;}
-		std::string val;
-	};
-	
-	void testCallback() 
-	{
-		coral::Property* p1 = dynamic_cast<coral::Property*>(pm->property("AuthenticationFile"));
-		CPPUNIT_ASSERT(p1);
-		coral::Property::CallbackID cid1 = -1, cid2 = -1;
-		TestCallback obj1, obj2;
-		boost::function1<void, std::string> cb1(boost::bind(&TestCallback::set, &obj1, _1));
-		boost::function1<void, std::string> cb2(boost::bind(&TestCallback::set, &obj2, _1));
-		cid1 = p1->registerCallback(cb1);
-		CPPUNIT_ASSERT_EQUAL((coral::Property::CallbackID) 0, cid1);
-		cid2 = p1->registerCallback(cb2);
-		CPPUNIT_ASSERT_EQUAL((coral::Property::CallbackID) 1, cid2);
-		CPPUNIT_ASSERT(p1->set("newValue"));
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), obj1.val);
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), obj2.val);
-		CPPUNIT_ASSERT(p1->unregisterCallback(cid1));
-		CPPUNIT_ASSERT(p1->set("newValue2"));
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), obj1.val);
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue2"), obj2.val);
-		CPPUNIT_ASSERT(!p1->unregisterCallback(cid1));
-		CPPUNIT_ASSERT(p1->unregisterCallback(cid2));
-		CPPUNIT_ASSERT(p1->set("newValue2"));
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue"), obj1.val);
-		CPPUNIT_ASSERT_EQUAL(std::string("newValue2"), obj2.val);
-	}
-	
-private:
-	coral::IPropertyManager* pm; 
-};
-
-// Registered tests
-// comment out the test that you do not want to run
-CPPUNIT_TEST_SUITE_REGISTRATION(PropertyManagerTest);
-
-int main ()
-{
-    CPPUNIT_NS :: TestResult testresult;
-    CPPUNIT_NS :: TestResultCollector collectedresults;
-    testresult.addListener (&collectedresults);
-    CPPUNIT_NS :: BriefTestProgressListener progress;
-    testresult.addListener (&progress);
-    CPPUNIT_NS :: TestRunner testrunner;
-    testrunner.addTest (CPPUNIT_NS :: TestFactoryRegistry :: getRegistry ().makeTest ());
-    testrunner.run (testresult);
-    CPPUNIT_NS :: CompilerOutputter compileroutputter (&collectedresults, std::cerr);
-    compileroutputter.write ();
-   
-    return collectedresults.wasSuccessful () ? 0 : 1;
-}
diff -Naur orig.src/FrontierAccess/src/QueryDefinition.cpp coral/FrontierAccess/src/QueryDefinition.cpp
--- orig.src/FrontierAccess/src/QueryDefinition.cpp	2008-10-09 22:27:33.000000000 +0200
+++ src/FrontierAccess/src/QueryDefinition.cpp	2008-12-11 16:17:16.000000000 +0100
@@ -24,7 +24,7 @@
 #include <stdexcept>
 #include <iostream>
 
-using CORALCOMMON_NAMESPACE_NAME::ExpressionParser;
+using coral::CoralCommon::ExpressionParser;
 
 coral::FrontierAccess::QueryDefinition::QueryDefinition( const coral::FrontierAccess::ISessionProperties& properties )
   : m_properties( properties ),
diff -Naur orig.src/OracleAccess/src/DataEditor.cpp coral/OracleAccess/src/DataEditor.cpp
--- orig.src/OracleAccess/src/DataEditor.cpp	2008-10-09 22:32:30.000000000 +0200
+++ src/OracleAccess/src/DataEditor.cpp	2008-12-11 17:14:33.000000000 +0100
@@ -20,7 +20,7 @@
 
 #include <sstream>
 
-using CORALCOMMON_NAMESPACE_NAME::ExpressionParser;
+using coral::CoralCommon::ExpressionParser;
 
 coral::OracleAccess::DataEditor::DataEditor( const coral::OracleAccess::ISessionProperties& properties,
                                              const coral::ITableDescription& description ):
diff -Naur orig.src/OracleAccess/src/Domain.cpp coral/OracleAccess/src/Domain.cpp
--- orig.src/OracleAccess/src/Domain.cpp	2008-03-20 15:56:48.000000000 +0100
+++ src/OracleAccess/src/Domain.cpp	2008-12-10 19:23:22.000000000 +0100
@@ -75,9 +75,9 @@
 : coral::Service( componentName ),
   m_flavorName( "Oracle" ),
   m_implementationName( "OCI" ),
-  m_implementationVersion( "10.2.0.2" ),
-  m_properties( new coral::OracleAccess::DomainProperties( this ) )
+  m_implementationVersion( "10.2.0.2" )
 {
+  m_properties = new coral::OracleAccess::DomainProperties( this );
   this->setProperties();
 }
 
diff -Naur orig.src/OracleAccess/src/OracleStatement.h coral/OracleAccess/src/OracleStatement.h
--- orig.src/OracleAccess/src/OracleStatement.h	2007-01-17 11:45:10.000000000 +0100
+++ src/OracleAccess/src/OracleStatement.h	2008-12-04 17:13:30.000000000 +0100
@@ -1,6 +1,10 @@
 #ifndef ORACLEACCESS_ORACLESTATEMENT_H
 #define ORACLEACCESS_ORACLESTATEMENT_H
 
+#ifdef WIN32
+#include <WTypes.h> // AK 04.12.2008 include this first on Win (bug #35683)
+#endif
+
 #include "oratypes.h"
 #include <string>
 #include <vector>
diff -Naur orig.src/OracleAccess/src/QueryDefinition.cpp coral/OracleAccess/src/QueryDefinition.cpp
--- orig.src/OracleAccess/src/QueryDefinition.cpp	2008-11-06 18:10:51.000000000 +0100
+++ src/OracleAccess/src/QueryDefinition.cpp	2008-12-11 17:14:33.000000000 +0100
@@ -18,7 +18,7 @@
 
 #include <sstream>
 
-using CORALCOMMON_NAMESPACE_NAME::ExpressionParser;
+using coral::CoralCommon::ExpressionParser;
 
 coral::OracleAccess::QueryDefinition::QueryDefinition( const coral::OracleAccess::ISessionProperties& properties ):
   m_properties( properties ),
diff -Naur orig.src/OracleAccess/src/Session.cpp coral/OracleAccess/src/Session.cpp
--- orig.src/OracleAccess/src/Session.cpp	2008-09-25 17:11:07.000000000 +0200
+++ src/OracleAccess/src/Session.cpp	2008-12-12 15:59:47.000000000 +0100
@@ -26,26 +26,23 @@
 coral::OracleAccess::Session::Session(  coral::IDevConnection& connection,
                                         coral::OracleAccess::ConnectionProperties& connectionProperties,
                                         const std::string& schemaName,
-                                        coral::AccessMode mode ):
-  coral::IDevSession( connection ),
-  m_properties( new coral::OracleAccess::SessionProperties( connectionProperties,
-                                                            schemaName,
-                                                            static_cast<coral::ISession&>( *this ),
-                                                            ( mode == coral::ReadOnly ) ? true : false ) ),
-  m_monitorController( new coral::OracleAccess::MonitorController( *m_properties ) ),
-  m_sessionHandle( 0 ),
-  m_schema( 0 ),
-  m_transaction( 0 ),
-  m_mutex(),
-  m_mutexForSchemas(),
-  m_schemas()
-{}
+                                        coral::AccessMode mode )
+  : coral::IDevSession( connection )
+  , m_sessionHandle( 0 )
+  , m_schema( 0 )
+  , m_transaction( 0 )
+  , m_mutex()
+  , m_mutexForSchemas()
+  , m_schemas()
+{
+  m_properties = new coral::OracleAccess::SessionProperties( connectionProperties, schemaName, static_cast<coral::ISession&>( *this ), mode == coral::ReadOnly);
+  m_monitorController = new coral::OracleAccess::MonitorController( *m_properties );
+}
 
 
 coral::OracleAccess::Session::~Session()
 {
-  if ( this->isUserSessionActive() )
-    this->endUserSession();
+  if ( this->isUserSessionActive() ) this->endUserSession();
   delete m_monitorController;
   delete m_properties;
 }
diff -Naur orig.src/OracleAccess/src/TableDescriptionProxy.cpp coral/OracleAccess/src/TableDescriptionProxy.cpp
--- orig.src/OracleAccess/src/TableDescriptionProxy.cpp	2008-04-17 18:34:05.000000000 +0200
+++ src/OracleAccess/src/TableDescriptionProxy.cpp	2008-12-16 15:42:47.000000000 +0100
@@ -253,6 +253,9 @@
     else if ( columnType == OCI_TYPECODE_TIMESTAMP ) {
       columnTypeName = coral::AttributeSpecification::typeNameForId( typeid(coral::TimeStamp) );
     }
+    else if ( columnType == OCI_TYPECODE_TIMESTAMP_TZ ) {
+      columnTypeName = "TIMESTAMP WITH TIME ZONE";
+    }
     else if ( columnType == OCI_TYPECODE_CHAR ) {
       if ( columnSize == 1 ) {
         columnTypeName = coral::AttributeSpecification::typeNameForId( typeid(char) );
diff -Naur orig.src/OracleAccess/tests/MultipleSessions/ThreadBody.cpp coral/OracleAccess/tests/MultipleSessions/ThreadBody.cpp
--- orig.src/OracleAccess/tests/MultipleSessions/ThreadBody.cpp	2008-03-05 13:00:23.000000000 +0100
+++ src/OracleAccess/tests/MultipleSessions/ThreadBody.cpp	2008-12-10 19:09:37.000000000 +0100
@@ -83,10 +83,10 @@
     float& f = rowBuffer[1].data<float>();
     double& d = rowBuffer[2].data<double>();
 
-    for ( int row = 0; row < 100; ++row ) {
-      i = row;
-      f = row + 0.001 * m_threadID;
-      d = row + 0.000001 * m_threadID;
+    for ( int row01 = 0; row01 < 100; ++row01 ) {
+      i = row01;
+      f = row01 + 0.001 * m_threadID;
+      d = row01 + 0.000001 * m_threadID;
       table.dataEditor().insertRow( rowBuffer );
     }
     session->transaction().commit();
@@ -108,15 +108,15 @@
     query->defineOutput( outputBuffer );
 
     coral::ICursor& cursor = query->execute();
-    int row = 0;
+    int row02 = 0;
     double& res = outputBuffer[0].data<double>();
     while ( cursor.next() ) {
-      if ( ::fabs( res - ( 2* row + 0.001001 * m_threadID ) ) > 0.00001 )
+      if ( ::fabs( res - ( 2* row02 + 0.001001 * m_threadID ) ) > 0.00001 )
         throw std::runtime_error( "Unexpected data" );
-      ++row;
+      ++row02;
     }
 
-    if ( row != 100 )
+    if ( row02 != 100 )
       throw std::runtime_error( "Unexpected number of rows" );
 
     session->transaction().commit();
diff -Naur orig.src/OracleAccess/tests/MultiThreading/TableCreateAndQueryThread.cpp coral/OracleAccess/tests/MultiThreading/TableCreateAndQueryThread.cpp
--- orig.src/OracleAccess/tests/MultiThreading/TableCreateAndQueryThread.cpp	2006-11-16 11:42:24.000000000 +0100
+++ src/OracleAccess/tests/MultiThreading/TableCreateAndQueryThread.cpp	2008-12-10 19:06:33.000000000 +0100
@@ -49,10 +49,10 @@
     float& f = rowBuffer[1].data<float>();
     double& d = rowBuffer[2].data<double>();
 
-    for ( int row = 0; row < 100; ++row ) {
-      i = row;
-      f = row + 0.001 * m_tableNumber;
-      d = row + 0.000001 * m_tableNumber;
+    for ( int row01 = 0; row01 < 100; ++row01 ) {
+      i = row01;
+      f = row01 + 0.001 * m_tableNumber;
+      d = row01 + 0.000001 * m_tableNumber;
       table.dataEditor().insertRow( rowBuffer );
     }
 
@@ -70,15 +70,15 @@
     query->defineOutput( outputBuffer );
 
     coral::ICursor& cursor = query->execute();
-    int row = 0;
+    int row02 = 0;
     double& res = outputBuffer[0].data<double>();
     while ( cursor.next() ) {
-      if ( ::fabs( res - ( 2* row + 0.001001 * m_tableNumber ) ) > 0.00001 )
+      if ( ::fabs( res - ( 2* row02 + 0.001001 * m_tableNumber ) ) > 0.00001 )
         throw std::runtime_error( "Unexpected data" );
-      ++row;
+      ++row02;
     }
 
-    if ( row != 100 )
+    if ( row02 != 100 )
       throw std::runtime_error( "Unexpected number of rows" );
 
   }
diff -Naur orig.src/pkgs.out coral/pkgs.out
--- orig.src/pkgs.out	1970-01-01 01:00:00.000000000 +0100
+++ src/pkgs.out	2009-01-08 18:48:34.000000000 +0100
@@ -0,0 +1,20 @@
+ConnectionService
+CoralBase
+CoralBricks
+CoralCommon
+CoralKernel
+CVS
+EnvironmentAuthenticationService
+FrontierAccess
+MonitoringService
+OracleAccess
+pkgs.out
+PyCoral
+RelationalAccess
+RelationalAuthenticationService
+RelationalService
+SQLiteAccess
+Tests
+UnitTests
+XMLAuthenticationService
+XMLLookupService
diff -Naur orig.src/PyCoral/src/Attribute.cpp coral/PyCoral/src/Attribute.cpp
--- orig.src/PyCoral/src/Attribute.cpp	2008-10-27 23:20:38.000000000 +0100
+++ src/PyCoral/src/Attribute.cpp	2008-12-10 19:00:39.000000000 +0100
@@ -384,10 +384,10 @@
   }
   else if ( typeInfo == typeid(unsigned char) ){
    if ( PyLong_Check( args ) ) {
-    coralAttributeDataObject->setValue<unsigned char>( PyLong_AsUnsignedLong(args) );
+    coralAttributeDataObject->setValue<unsigned char>( (unsigned char)PyLong_AsUnsignedLong(args) );
    }
    else if ( PyInt_Check( args ) ) {
-    coralAttributeDataObject->setValue<unsigned char>( PyInt_AsUnsignedLongMask(args) );
+    coralAttributeDataObject->setValue<unsigned char>( (unsigned char)PyInt_AsUnsignedLongMask(args) );
    }
    else {
     PyErr_SetString( coral::PyCoral::Exception(), 
@@ -423,10 +423,10 @@
   }
   else if ( typeInfo == typeid(short int) ) {
    if ( PyLong_Check( args ) ) {
-    coralAttributeDataObject->setValue<short>( PyLong_AsLong(args) );
+    coralAttributeDataObject->setValue<short>( (short)PyLong_AsLong(args) );
    }
    else if ( PyInt_Check( args ) ) {
-    coralAttributeDataObject->setValue<short>( PyInt_AS_LONG(args) );
+    coralAttributeDataObject->setValue<short>( (short)PyInt_AS_LONG(args) );
    }
    else {
     PyErr_SetString( coral::PyCoral::Exception(), 
@@ -436,10 +436,10 @@
   }
   else if ( typeInfo == typeid(unsigned short) ) {
    if ( PyLong_Check( args ) ) {
-    coralAttributeDataObject->setValue<unsigned short>( PyLong_AsUnsignedLong(args) );
+    coralAttributeDataObject->setValue<unsigned short>( (unsigned short)PyLong_AsUnsignedLong(args) );
    }
    else if ( PyInt_Check( args ) ) {
-    coralAttributeDataObject->setValue<unsigned short>( PyInt_AsUnsignedLongMask(args) );
+    coralAttributeDataObject->setValue<unsigned short>( (unsigned short)PyInt_AsUnsignedLongMask(args) );
    }
    else {
     PyErr_SetString( coral::PyCoral::Exception(), 
@@ -475,13 +475,13 @@
   }
   else if ( typeInfo == typeid(float) ) {
    if ( PyFloat_Check( args ) ) {
-    coralAttributeDataObject->setValue<float>( PyFloat_AS_DOUBLE(args) );
+    coralAttributeDataObject->setValue<float>( (float)PyFloat_AS_DOUBLE(args) );
    }
    else if ( PyLong_Check( args ) ) {
-    coralAttributeDataObject->setValue<float>( PyLong_AsDouble(args) );
+    coralAttributeDataObject->setValue<float>( (float)PyLong_AsDouble(args) );
    }
    else if ( PyInt_Check( args ) ) {
-    coralAttributeDataObject->setValue<float>( PyInt_AS_LONG(args) );
+    coralAttributeDataObject->setValue<float>( (float)PyInt_AS_LONG(args) );
    }
    else {
     PyErr_SetString( coral::PyCoral::Exception(), 
diff -Naur orig.src/RelationalAuthenticationService/BuildFile coral/RelationalAuthenticationService/BuildFile
--- orig.src/RelationalAuthenticationService/BuildFile	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/BuildFile	2008-11-04 14:59:17.000000000 +0100
@@ -0,0 +1,5 @@
+<use name=CoralCommon>
+<export>
+  <use name=CoralCommon>
+  <lib name=lcg_RelationalAuthenticationService>
+</export>
diff -Naur orig.src/RelationalAuthenticationService/src/AuthenticationCredentialSet.cpp coral/RelationalAuthenticationService/src/AuthenticationCredentialSet.cpp
--- orig.src/RelationalAuthenticationService/src/AuthenticationCredentialSet.cpp	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/AuthenticationCredentialSet.cpp	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,65 @@
+#include "AuthenticationCredentialSet.h"
+#include "CoralCommon/AuthenticationCredentials.h"
+#include "RelationalAccess/AuthenticationServiceException.h"
+
+coral::AuthenticationCredentialSet::AuthenticationCredentialSet( const std::string& serviceName,
+                                                                 const std::string& connectionName ):
+  m_serviceName( serviceName ),
+  m_connectionName( connectionName ),
+  m_default( new coral::AuthenticationCredentials( serviceName ) ),
+  m_data()
+{}
+
+
+coral::AuthenticationCredentialSet::~AuthenticationCredentialSet()
+{
+  delete m_default;
+  for ( std::map< std::string, coral::AuthenticationCredentials* >::iterator iData = m_data.begin();
+        iData != m_data.end(); ++iData )
+    delete iData->second;
+}
+
+
+void
+coral::AuthenticationCredentialSet::appendCredentialItem( const std::string& item,
+                                                          const std::string& value )
+{
+  m_default->registerItem( item, value );
+}
+
+
+void
+coral::AuthenticationCredentialSet::appendCredentialItemForRole( const std::string& item,
+                                                                 const std::string& value,
+                                                                 const std::string& role )
+{
+  std::map< std::string, coral::AuthenticationCredentials* >::iterator iRole = m_data.find( role );
+  if ( iRole == m_data.end() ) {
+    iRole = m_data.insert( std::make_pair( role, new coral::AuthenticationCredentials( m_serviceName ) ) ).first;
+  }
+  iRole->second->registerItem( item, value );
+}
+
+
+const coral::IAuthenticationCredentials&
+coral::AuthenticationCredentialSet::credentials() const
+{
+  if(!m_default){
+    throw coral::AuthenticationServiceException( "Default credential not found.",
+                                                 "coral::AuthenticationCredentialSet::credentials",
+                                                 "LFCReplicaService" );    
+  }
+  return *m_default;
+}
+
+
+const coral::IAuthenticationCredentials&
+coral::AuthenticationCredentialSet::credentials( const std::string& role ) const
+{
+  std::map< std::string, coral::AuthenticationCredentials* >::const_iterator iRole = m_data.find( role );
+  if ( iRole == m_data.end() )
+    throw coral::UnknownRoleException( m_serviceName,
+                                       m_connectionName,
+                                       role );
+  return *( iRole->second );
+}
diff -Naur orig.src/RelationalAuthenticationService/src/AuthenticationCredentialSet.h coral/RelationalAuthenticationService/src/AuthenticationCredentialSet.h
--- orig.src/RelationalAuthenticationService/src/AuthenticationCredentialSet.h	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/AuthenticationCredentialSet.h	2009-01-07 10:54:35.000000000 +0100
@@ -0,0 +1,86 @@
+#ifndef RELATIONALAUTHENTICATIONSERVICE_AUTHENTITACTIONCREDENTIALSET_H
+#define RELATIONALAUTHENTICATIONSERVICE_AUTHENTITACTIONCREDENTIALSET_H
+
+#include <map>
+#include <string>
+
+namespace coral {
+
+  class AuthenticationCredentials;
+  class IAuthenticationCredentials;
+
+    /**
+     * @class AuthenticationCredentialSet
+     *
+     * A simple class holding the roles and the credentials corresponding to a database service
+     */
+    class AuthenticationCredentialSet
+    {
+    public:
+      /// Constructor
+      AuthenticationCredentialSet( const std::string& serviceName,
+                                   const std::string& connectionName );
+
+      /// Destructor
+      virtual ~AuthenticationCredentialSet();
+
+      /**
+       * Adds a credential item to the default role.
+       */
+      void appendCredentialItem( const std::string& item,
+                                 const std::string& value );
+
+      /**
+       * Adds a credential item to the default role.
+       */
+      void appendCredentialItemForRole( const std::string& item,
+                                        const std::string& value,
+                                        const std::string& role );
+
+      /**
+       * Returns a reference to the credentials object for the default role.
+       */
+      const coral::IAuthenticationCredentials& credentials() const;
+
+      /**
+       * Returns a reference to the credentials object for a given role.
+       * If the role is not known to the service an UnknownRoleException is thrown.
+       */
+      const coral::IAuthenticationCredentials& credentials( const std::string& role ) const;
+
+      const std::map< std::string, coral::AuthenticationCredentials* >& roleMap() const;
+
+      bool hasDefault() const;
+
+      private:
+      /// The service name
+      std::string m_serviceName;
+
+      /// The connection name
+      std::string m_connectionName;
+
+      /// The input file with the data
+      coral::AuthenticationCredentials* m_default;
+
+      /// The structure with the authentication data for the various roles
+      std::map< std::string, coral::AuthenticationCredentials* > m_data;
+
+    private:
+      AuthenticationCredentialSet();
+      AuthenticationCredentialSet( const AuthenticationCredentialSet& );
+      AuthenticationCredentialSet& operator=( const AuthenticationCredentialSet& );
+    };
+
+}
+
+inline
+const std::map< std::string, coral::AuthenticationCredentials* >& coral::AuthenticationCredentialSet::roleMap() const{
+  return m_data;
+}
+
+inline
+bool coral::AuthenticationCredentialSet::hasDefault() const{
+  return m_default != NULL;
+}
+
+#endif
diff -Naur orig.src/RelationalAuthenticationService/src/RelationalAuthenticationService.cpp coral/RelationalAuthenticationService/src/RelationalAuthenticationService.cpp
--- orig.src/RelationalAuthenticationService/src/RelationalAuthenticationService.cpp	2008-11-03 16:21:36.000000000 +0100
+++ src/RelationalAuthenticationService/src/RelationalAuthenticationService.cpp	2008-11-12 12:05:05.000000000 +0100
@@ -3,10 +3,10 @@
 #include "CoralBase/Attribute.h"
 #include "CoralBase/MessageStream.h"
 #include "CoralCommon/AuthenticationCredentials.h"
-#include "CoralCommon/AuthenticationCredentialSet.h"
+#include "AuthenticationCredentialSet.h"
 #include "CoralCommon/Cipher.h"
-#include "CoralCommon/XMLAuthenticationFileParser.h"
-#include "CoralCommon/XMLAuthenticationFileContent.h"
+#include "XMLAuthenticationFileParser.h"
+#include "XMLAuthenticationFileContent.h"
 #include "RelationalAccess/AuthenticationServiceException.h"
 #include "RelationalAccess/IBulkOperation.h"
 #include "RelationalAccess/IAuthenticationCredentials.h"
diff -Naur orig.src/RelationalAuthenticationService/src/XercesWrapper.h coral/RelationalAuthenticationService/src/XercesWrapper.h
--- orig.src/RelationalAuthenticationService/src/XercesWrapper.h	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/XercesWrapper.h	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,34 @@
+/* 
+ * Project: POOL
+ * Sub-project: CORAL
+ * Web site: http://pool.cern.ch/coral
+ * 
+ * Author: Zsolt.Molnar@cern.ch (http://www.zsoltmolnar.hu)
+ */
+#ifndef RELATIONALAUTHENTICATIONSERVICE_XERCESWRAPPER_H_
+#define RELATIONALAUTHENTICATIONSERVICE_XERCESWRAPPER_H_
+
+// Disable warnings coming from xerces headers
+// See http://wiki.services.openoffice.org/wiki/Writing_warning-free_code
+// See also http://www.artima.com/cppsource/codestandards.html
+#if defined __GNUC__
+#  pragma GCC system_header
+#elif defined __SUNPRO_CC
+#  pragma disable_warn
+#elif defined _MSC_VER
+#  pragma warning(push, 1)
+#endif
+
+#include "xercesc/parsers/XercesDOMParser.hpp"
+#include "xercesc/dom/DOM.hpp"
+#include "xercesc/sax/HandlerBase.hpp"
+#include "xercesc/util/XMLString.hpp"
+#include "xercesc/util/PlatformUtils.hpp"
+
+#if defined __SUNPRO_CC
+#  pragma enable_warn
+#elif defined _MSC_VER
+#  pragma warning(pop)
+#endif
+
+#endif /* RELATIONALAUTHENTICATIONSERVICE_XERCESWRAPPER_H_ */
diff -Naur orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.cpp coral/RelationalAuthenticationService/src/XMLAuthenticationFileContent.cpp
--- orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.cpp	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.cpp	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,91 @@
+#include "RelationalAccess/IAuthenticationCredentials.h"
+#include "XMLAuthenticationFileContent.h"
+#include <iomanip>
+
+coral::XMLAuthenticationFileContent::XMLAuthenticationFileContent(std::ostream& out):
+  m_out(out),
+  m_connectionListOpen(false),
+  m_connectionEntryOpen(false),
+  m_roleEntryOpen(false),
+  m_ind(0){  
+  m_out << "<?xml version=\"1.0\" ?>"<<std::endl;
+  m_out << "<connectionlist>"<<std::endl;
+  m_connectionListOpen = true;
+}
+
+bool coral::XMLAuthenticationFileContent::openConnectionEntry(const std::string& pcs){
+  bool ret = false;
+  if(m_connectionListOpen && !m_connectionEntryOpen){
+    m_out << std::endl;
+    m_ind+=2;
+    m_out << std::setw(m_ind)<<"";
+    m_out << "<connection name=\""<<pcs<<"\" >"<<std::endl;
+    m_connectionEntryOpen=true;
+    ret = true;
+  }
+  return ret;  
+}
+
+bool coral::XMLAuthenticationFileContent::closeConnectionEntry(){
+  bool ret = false;
+  if(m_connectionEntryOpen){
+    m_out << std::setw(m_ind)<<"";
+    m_out << "</connection>"<<std::endl;    
+    m_ind-=2;
+    ret = true;
+    m_connectionEntryOpen = false;
+  }
+  return ret;
+}
+
+bool coral::XMLAuthenticationFileContent::openRoleEntry(const std::string& roleName){
+  bool ret = false;
+  if(m_connectionEntryOpen && !m_roleEntryOpen){
+    m_ind+=2;
+    m_out << std::setw(m_ind)<<"";
+    m_out << "<role name=\""<<roleName<<"\" >"<<std::endl;
+    m_roleEntryOpen=true;
+    ret = true;
+  }
+  return ret;  
+  
+}
+
+bool  coral::XMLAuthenticationFileContent::closeRoleEntry(){
+  bool ret = false;
+  if(m_roleEntryOpen){
+    m_out << std::setw(m_ind)<<"";
+    m_out << "</role>"<<std::endl;    
+    m_ind-=2;
+    ret = true;
+    m_roleEntryOpen = false;
+  }
+  return ret;  
+}
+
+bool coral::XMLAuthenticationFileContent::addCredentialEntry(const std::string& userName,
+                                                                                const std::string& password ){
+  bool ret = false;
+  if(m_connectionEntryOpen){
+    m_out << std::setw(m_ind+2)<<"";
+    m_out << "<parameter name=\""<<coral::IAuthenticationCredentials::userItem()<<"\" value=\""<<userName<<"\" />"<<std::endl;
+    m_out << std::setw(m_ind+2)<<"";
+    m_out << "<parameter name=\""<<coral::IAuthenticationCredentials::passwordItem()<<"\" value=\""<<password<<"\" />"<<std::endl;
+    ret = true;
+  }
+  return ret;  
+}
+
+void coral::XMLAuthenticationFileContent::close(){
+  if(m_connectionListOpen){
+    if(m_connectionEntryOpen){
+      if(m_roleEntryOpen){
+        closeRoleEntry();
+      }
+      closeConnectionEntry();
+    }
+    m_out << std::endl;
+    m_out << "</connectionlist>"<<std::endl;
+  }
+  m_connectionListOpen = false;
+}
diff -Naur orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.h coral/RelationalAuthenticationService/src/XMLAuthenticationFileContent.h
--- orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.h	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/XMLAuthenticationFileContent.h	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,41 @@
+#ifndef RELATIONALAUTHENTICATIONSERVICE_XMLAUTHENTICATIONFILECONTENT_H
+#define RELATIONALAUTHENTICATIONSERVICE_XMLAUTHENTICATIONFILECONTENT_H
+#include <iostream>
+
+namespace coral {
+
+  class XMLAuthenticationFileContent {
+
+      public:
+
+      explicit XMLAuthenticationFileContent(std::ostream& out);
+
+      bool openConnectionEntry(const std::string& pcs);
+
+      bool closeConnectionEntry();
+      
+      bool openRoleEntry(const std::string& roleName);
+
+      bool closeRoleEntry();
+      
+      bool addCredentialEntry(const std::string& userName,
+                              const std::string& password );
+
+      void close();
+
+      private:
+
+      std::ostream& m_out;
+
+      bool m_connectionListOpen;
+
+      bool m_connectionEntryOpen;
+      
+      bool m_roleEntryOpen;
+
+      unsigned int m_ind;
+  };    
+}
+
+#endif
+    
diff -Naur orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.cpp coral/RelationalAuthenticationService/src/XMLAuthenticationFileParser.cpp
--- orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.cpp	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.cpp	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,169 @@
+#include "AuthenticationCredentialSet.h"
+#include "XMLAuthenticationFileParser.h"
+#include "XercesWrapper.h"
+#include "CoralBase/MessageStream.h"
+
+bool coral::XMLAuthenticationFileParser::parse(const std::string& inputFileName,
+                                               std::map< std::string, AuthenticationCredentialSet* >& data){
+  try
+  {
+    xercesc::XMLPlatformUtils::Initialize();
+  }
+  catch ( const xercesc::XMLException& toCatch )
+  {
+    char* message = xercesc::XMLString::transcode( toCatch.getMessage() );
+    coral::MessageStream log( m_serviceCallerName );
+    log << coral::Error << message << coral::MessageStream::endmsg;
+    xercesc::XMLString::release( &message );
+    return false;
+  }
+
+  bool result = true;
+  try
+  {
+    xercesc::XercesDOMParser parser;
+    parser.setValidationScheme( xercesc::XercesDOMParser::Val_Always );
+    parser.setDoNamespaces( true );
+    
+    xercesc::HandlerBase errorHandler; 
+    parser.setErrorHandler( &errorHandler );
+
+    parser.parse( inputFileName.c_str() );
+
+    xercesc::DOMDocument* document = parser.getDocument();
+
+    XMLCh tempStr[20];
+    xercesc::XMLString::transcode( "connection", tempStr, 19);
+
+    xercesc::DOMNodeList* connectionList = document->getElementsByTagName( tempStr );
+    
+    if ( connectionList )
+    {
+      XMLSize_t numberOfConnections = connectionList->getLength();
+      
+      for ( XMLSize_t iConnection = 0; iConnection < numberOfConnections; ++iConnection )
+      {
+        xercesc::DOMNode* connectionNode = connectionList->item( iConnection );
+
+        if ( connectionNode )
+        {
+          char*       connectionName  = xercesc::XMLString::transcode( connectionNode->getAttributes()->item( 0 )->getNodeValue() );
+          std::string sConnectionName = connectionName;
+          xercesc::XMLString::release( &connectionName );
+
+          // Locate the credential
+          coral::AuthenticationCredentialSet* credential = 0;
+          std::map< std::string, coral::AuthenticationCredentialSet* >::iterator iConnection = data.find( sConnectionName );
+          if ( iConnection != data.end() ) {
+            credential = iConnection->second;
+            // Issue a warning here.
+            coral::MessageStream log( m_serviceCallerName );
+            log << coral::Warning << "Credential parameters for connection string \""
+                << sConnectionName
+                << "\" have already been defined. Only new elements are appended, while existing will be ignored."
+                << coral::MessageStream::endmsg;
+          }
+          else {
+            credential = new coral::AuthenticationCredentialSet( m_serviceCallerName, sConnectionName );
+            data.insert( std::make_pair( sConnectionName, credential ) );
+          }
+
+          xercesc::DOMNodeList* parameterList = connectionNode->getChildNodes();
+          
+          if ( parameterList )
+          {
+            XMLSize_t numberOfParameters = parameterList->getLength();
+            
+            for ( XMLSize_t iParameter = 0; iParameter < numberOfParameters; ++iParameter )
+            {
+              xercesc::DOMNode* parameterNode = parameterList->item( iParameter );
+
+              if ( parameterNode && parameterNode->getNodeType() == xercesc::DOMNode::ELEMENT_NODE )
+              {
+                char* nodeName = xercesc::XMLString::transcode( parameterNode->getNodeName() );
+                std::string sNodeName = nodeName;
+                xercesc::XMLString::release( &nodeName );
+                
+                if ( sNodeName == "parameter" ) { // The default parameters
+                  char* parameterName = xercesc::XMLString::transcode( parameterNode->getAttributes()->item( 0 )->getNodeValue() );
+                  std::string sParameterName = parameterName;
+                  xercesc::XMLString::release( &parameterName );
+                  char* parameterValue = xercesc::XMLString::transcode( parameterNode->getAttributes()->item( 1 )->getNodeValue() );
+                  std::string sParameterValue = parameterValue;
+                  xercesc::XMLString::release( &parameterValue );
+
+                  credential->appendCredentialItem( sParameterName, sParameterValue );
+                }
+                else if ( sNodeName == "role" ) { // A role
+                  char* roleName  = xercesc::XMLString::transcode( parameterNode->getAttributes()->item( 0 )->getNodeValue() );
+                  std::string sRoleName = roleName;
+                  xercesc::XMLString::release( &roleName );
+
+                  // Retrieve the parameters for the role
+                  xercesc::DOMNodeList* roleParameterList = parameterNode->getChildNodes();
+
+
+                  if ( roleParameterList )
+                  {
+                    XMLSize_t numberOfRoleParameters = roleParameterList->getLength();
+            
+                    for ( XMLSize_t iRoleParameter = 0; iRoleParameter < numberOfRoleParameters; ++iRoleParameter )
+                    {
+                      xercesc::DOMNode* roleParameterNode = roleParameterList->item( iRoleParameter );
+                      if ( roleParameterNode && roleParameterNode->getNodeType() == xercesc::DOMNode::ELEMENT_NODE )
+                      {
+                        char* roleNodeName = xercesc::XMLString::transcode( roleParameterNode->getNodeName() );
+                        std::string sRoleNodeName = roleNodeName;
+                        xercesc::XMLString::release( &roleNodeName );
+                        
+                        if ( sRoleNodeName == "parameter" ) {
+                          char* roleParameterName = xercesc::XMLString::transcode( roleParameterNode->getAttributes()->item( 0 )->getNodeValue() );
+                          std::string sRoleParameterName = roleParameterName;
+                          xercesc::XMLString::release( &roleParameterName );
+                          char* roleParameterValue = xercesc::XMLString::transcode( roleParameterNode->getAttributes()->item( 1 )->getNodeValue() );
+                          std::string sRoleParameterValue = roleParameterValue;
+                          xercesc::XMLString::release( &roleParameterValue );
+                          
+                          credential->appendCredentialItemForRole( sRoleParameterName, sRoleParameterValue, sRoleName );
+                        }
+                      }
+                    }
+                  }
+                }
+              }
+            }
+          }
+        }
+      }
+    }
+
+    parser.reset();
+  }
+  catch ( const xercesc::XMLException& toCatch )
+  {
+    char* message = xercesc::XMLString::transcode( toCatch.getMessage() );
+    coral::MessageStream log( m_serviceCallerName );
+    log << coral::Error << message << coral::MessageStream::endmsg;
+    xercesc::XMLString::release( &message );
+    result = false;
+  }
+  catch ( const xercesc::DOMException& toCatch )
+  {
+    char* message = xercesc::XMLString::transcode( toCatch.msg );
+    coral::MessageStream log( m_serviceCallerName );
+    log << coral::Error << message << coral::MessageStream::endmsg;
+    xercesc::XMLString::release( &message );
+    result = false;
+  }
+  catch (...)
+  {
+    coral::MessageStream log( m_serviceCallerName );
+    log << coral::Error << "Unexpected Exception parsing file \"" << inputFileName << "\"" << coral::MessageStream::endmsg;
+    result = false;
+  }
+
+  xercesc::XMLPlatformUtils::Terminate();
+
+ return result;
+}
+
diff -Naur orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.h coral/RelationalAuthenticationService/src/XMLAuthenticationFileParser.h
--- orig.src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.h	1970-01-01 01:00:00.000000000 +0100
+++ src/RelationalAuthenticationService/src/XMLAuthenticationFileParser.h	2008-11-12 12:05:05.000000000 +0100
@@ -0,0 +1,33 @@
+#ifndef RELATIONALAUTHENTICATIONSERVICE_XMLAUTHENTICATIONFILEPARSER_H
+#define RELATIONALAUTHENTICATIONSERVICE_XMLAUTHENTICATIONFILEPARSER_H
+
+#include "RelationalAccess/AccessMode.h"
+#include <string>
+#include <vector>
+#include <map>
+
+namespace coral {
+
+  class AuthenticationCredentialSet;
+
+class XMLAuthenticationFileParser {
+  public:
+  explicit XMLAuthenticationFileParser(const std::string& serviceCallerName);
+  
+  virtual ~XMLAuthenticationFileParser(){}
+
+  // ownership of the DatabaseServiceDescription* objects is left to the caller
+  bool parse(const std::string& inputFileName, std::map< std::string,AuthenticationCredentialSet* >& data);
+
+  private:
+
+  std::string m_serviceCallerName;
+};
+ 
+}
+
+inline
+coral::XMLAuthenticationFileParser::XMLAuthenticationFileParser(const std::string& serviceCallerName):
+  m_serviceCallerName(serviceCallerName){}
+
+#endif
diff -Naur orig.src/SQLiteAccess/src/Domain.cpp coral/SQLiteAccess/src/Domain.cpp
--- orig.src/SQLiteAccess/src/Domain.cpp	2008-03-20 16:00:10.000000000 +0100
+++ src/SQLiteAccess/src/Domain.cpp	2008-12-05 14:22:47.000000000 +0100
@@ -11,8 +11,10 @@
   m_flavorName( "SQLite" ),
   m_implementationName( "sqlite" ),
   m_implementationVersion( sqlite3_libversion() ),
-  m_properties( new coral::SQLiteAccess::DomainProperties( this ) )
+  m_properties( NULL )
 {
+  //removed compilation warning for windows
+  m_properties = new coral::SQLiteAccess::DomainProperties( this );
 }
 
 coral::SQLiteAccess::Domain::~Domain()
diff -Naur orig.src/SQLiteAccess/src/QueryDefinition.h coral/SQLiteAccess/src/QueryDefinition.h
--- orig.src/SQLiteAccess/src/QueryDefinition.h	2006-11-06 15:30:21.000000000 +0100
+++ src/SQLiteAccess/src/QueryDefinition.h	2008-12-11 14:27:29.000000000 +0100
@@ -46,53 +46,53 @@
       /**
        * Requires a distinct selection.
        */
-      virtual void setDistinct();
+      void setDistinct();
       
       /**
        * Appends an expression to the output list
        */
-      virtual void addToOutputList( const std::string& expression,
+      void addToOutputList( const std::string& expression,
                                     std::string alias = "" );
       
       /**
        * Appends a table name in the table selection list (the FROM part of the query)
        */
-      virtual void addToTableList( const std::string& tableName,
+      void addToTableList( const std::string& tableName,
                                    std::string alias = "" );
       
       /**
        * Defines a subquery.
        * The specified name should be used in a subsequent call to addToTableList.
        */
-      virtual coral::IQueryDefinition& defineSubQuery( const std::string& allias );
+      coral::IQueryDefinition& defineSubQuery( const std::string& allias );
       
       /**
        * Defines the condition to the query (the WHERE clause)
        */
-      virtual void setCondition( const std::string& condition,
+      void setCondition( const std::string& condition,
                                  const coral::AttributeList& inputData );
       
       /**
        * Appends a GROUP BY clause in the query
        */
-      virtual void groupBy( const std::string& expression );
+      void groupBy( const std::string& expression );
 
       /**
        * Appends an expression to the ordering list (the ORDER clause)
        */
-      virtual void addToOrderList( const std::string& expression );
+      void addToOrderList( const std::string& expression );
       
       /**
        * Instructs the server to send only up to maxRows rows at the result
        * of the query starting from the offset row.
        */
-      virtual void limitReturnedRows( int maxRows = 1,
+      void limitReturnedRows( int maxRows = 1,
                                       int offset = 0 );
       
       /**
        * Applies a set operation. Returns the rhs query definition so that it can be filled in.
        */
-      virtual coral::IQueryDefinition& applySetOperation( coral::IQueryDefinition::SetOperation opetationType );
+      coral::IQueryDefinition& applySetOperation( coral::IQueryDefinition::SetOperation opetationType );
       
     private:
       /// Calculates the sql fragment from the underlying data
diff -Naur orig.src/SQLiteAccess/src/Query.h coral/SQLiteAccess/src/Query.h
--- orig.src/SQLiteAccess/src/Query.h	2006-01-13 11:51:14.000000000 +0100
+++ src/SQLiteAccess/src/Query.h	2008-12-12 15:17:47.000000000 +0100
@@ -1,6 +1,12 @@
 #ifndef SQLITEACCESS_QUERY_H
 #define SQLITEACCESS_QUERY_H
 
+#ifdef WIN32
+//IQuery and QueryDefinition are inherits of IQueryDefinition
+//QueryDefinition dominates the others but setting them to pure virtual
+#pragma warning ( disable : 4250 )
+#endif 
+
 #include "RelationalAccess/IQuery.h"
 #include "QueryDefinition.h"
 
diff -Naur orig.src/SQLiteAccess/src/Session.cpp coral/SQLiteAccess/src/Session.cpp
--- orig.src/SQLiteAccess/src/Session.cpp	2008-09-04 16:58:15.000000000 +0200
+++ src/SQLiteAccess/src/Session.cpp	2008-12-12 16:00:05.000000000 +0100
@@ -47,16 +47,15 @@
 }
 #endif
 
-coral::SQLiteAccess::Session::Session(coral::IDevConnection& connection,
-				      coral::SQLiteAccess::ConnectionProperties& connectionProperties,
-                                      const std::string& /* schemaName */, coral::AccessMode mode):
-  coral::IDevSession( connection ),
-  m_properties( new coral::SQLiteAccess::SessionProperties(connectionProperties,static_cast<coral::ISession&>( *this ),( mode == coral::ReadOnly ) ? true : false ) ) ,
-  m_monitorController( new coral::SQLiteAccess::MonitorController( *m_properties ) ),
-  m_transaction(0),
-  m_schema(0),
-  m_dbHandle(0)
-{}
+coral::SQLiteAccess::Session::Session(coral::IDevConnection& connection, coral::SQLiteAccess::ConnectionProperties& connectionProperties, const std::string& /* schemaName */, coral::AccessMode mode)
+  : coral::IDevSession( connection )
+  , m_transaction(0)
+  , m_schema(0)
+  , m_dbHandle(0)
+{
+  m_properties = new coral::SQLiteAccess::SessionProperties(connectionProperties,static_cast<coral::ISession&>( *this ), mode == coral::ReadOnly);
+  m_monitorController = new coral::SQLiteAccess::MonitorController( *m_properties );
+}
 coral::SQLiteAccess::Session::~Session()
 {
   if ( this->isUserSessionActive() ) this->endUserSession();  
diff -Naur orig.src/SQLiteAccess/src/SessionProperties.cpp coral/SQLiteAccess/src/SessionProperties.cpp
--- orig.src/SQLiteAccess/src/SessionProperties.cpp	2006-11-21 20:32:58.000000000 +0100
+++ src/SQLiteAccess/src/SessionProperties.cpp	2009-01-06 13:52:14.000000000 +0100
@@ -1,3 +1,8 @@
+#ifdef WIN32
+// Keep the 'class sqlite3' forward declaration even if it is a struct
+#pragma warning ( disable : 4099 )
+#endif 
+
 #include "SessionProperties.h"
 #include "ConnectionProperties.h"
 #include "DomainProperties.h"
diff -Naur orig.src/SQLiteAccess/src/TableDescriptionProxy.cpp coral/SQLiteAccess/src/TableDescriptionProxy.cpp
--- orig.src/SQLiteAccess/src/TableDescriptionProxy.cpp	2008-10-22 12:20:26.000000000 +0200
+++ src/SQLiteAccess/src/TableDescriptionProxy.cpp	2008-12-16 12:03:16.000000000 +0100
@@ -100,7 +100,8 @@
     bool isNullable=true;
     const std::string& columnName=result[1].data<std::string>();
     const std::string& columnType=result[2].data<std::string>(); //sql type
-    if( result[3].data<int>()==99 ){
+    // GG The code 1 is sure, can be retrieved when a notnull constraint is explicitly set. Not sure about 99, from Zhen. 
+    if( result[3].data<int>()==1 || result[3].data<int>()==99 ){
       isNullable=false;
     }
     if( result[5].data<int>()==1 ){
diff -Naur orig.src/SQLiteAccess/src/View.cpp coral/SQLiteAccess/src/View.cpp
--- orig.src/SQLiteAccess/src/View.cpp	2008-03-20 16:00:10.000000000 +0100
+++ src/SQLiteAccess/src/View.cpp	2008-12-16 12:03:16.000000000 +0100
@@ -110,7 +110,7 @@
     //std::cout<<"columnName "<<columnName<<std::endl;
     const std::string& columnType=result[2].data<std::string>(); //sql type
     //std::cout<<"columnType "<<columnType<<std::endl;
-    if( result[3].data<int>()==99 ){
+    if( result[3].data<int>()==1 || result[3].data<int>()==99 ){
       //std::cout<<"is not null"<<std::endl;
       isNullable=false;
     }
diff -Naur orig.src/SQLiteAccess/src/ViewFactory.h coral/SQLiteAccess/src/ViewFactory.h
--- orig.src/SQLiteAccess/src/ViewFactory.h	2005-08-18 14:58:20.000000000 +0200
+++ src/SQLiteAccess/src/ViewFactory.h	2008-12-12 15:17:47.000000000 +0100
@@ -1,6 +1,12 @@
 #ifndef SQLITEACCESS_VIEW_FACTORY_H
 #define SQLITEACCESS_VIEW_FACTORY_H
 
+#ifdef WIN32
+//IViewFactory and QueryDefinition are inherits of IQueryDefinition
+//QueryDefinition dominates the others but setting them to pure virtual
+#pragma warning ( disable : 4250 )
+#endif 
+
 #include "RelationalAccess/IViewFactory.h"
 #include "QueryDefinition.h"
 
diff -Naur orig.src/SQLiteAccess/tests/BulkInserts/bulkInserts.cpp coral/SQLiteAccess/tests/BulkInserts/bulkInserts.cpp
--- orig.src/SQLiteAccess/tests/BulkInserts/bulkInserts.cpp	2008-04-11 22:05:37.000000000 +0200
+++ src/SQLiteAccess/tests/BulkInserts/bulkInserts.cpp	2008-12-04 16:07:50.000000000 +0100
@@ -22,11 +22,15 @@
 
 #include <iostream>
 #include <stdexcept>
-#include <limits>
 #include <memory>
 #include <sstream>
 #include <float.h>
 
+#undef max  //solve windows compilation
+#undef min
+
+#include <limits>
+
 int main( int, char** )
 {
   std::string tablename="bulktest";
diff -Naur orig.src/SQLiteAccess/tests/DateAndTime/datetime.cpp coral/SQLiteAccess/tests/DateAndTime/datetime.cpp
--- orig.src/SQLiteAccess/tests/DateAndTime/datetime.cpp	2008-03-26 17:21:25.000000000 +0100
+++ src/SQLiteAccess/tests/DateAndTime/datetime.cpp	2008-12-11 14:27:29.000000000 +0100
@@ -99,13 +99,13 @@
     coral::IQuery* query = schema.tableHandle("T").newQuery();
     query->setRowCacheSize( 20 );
     coral::ICursor& cursor = query->execute();
-    int i = 0;
+    int j = 0;
     while ( cursor.next() ) {
       const coral::AttributeList& currentRow = cursor.currentRow();
       currentRow.toOutputStream( std::cout ) << std::endl;
-      ++i;
+      ++j;
     }
-    if ( i != 10 )
+    if ( j != 10 )
       throw std::runtime_error( "Unexpected number of rows" );
     delete query;
     session->transaction().commit();
diff -Naur orig.src/Tests/Integration_Basic/src/DmlOperations.cpp coral/Tests/Integration_Basic/src/DmlOperations.cpp
--- orig.src/Tests/Integration_Basic/src/DmlOperations.cpp	2008-08-13 18:50:38.000000000 +0200
+++ src/Tests/Integration_Basic/src/DmlOperations.cpp	2008-11-07 15:44:08.000000000 +0100
@@ -4,35 +4,9 @@
 DmlOperations::DmlOperations(TestEnv * env) : Testing(env) {
 }
 
-/*
-DmlOperations::DmlOperations( coral::IRelationalDomain& domain,
-                              const std::string& connectionString,
-                              coral::IAuthenticationService& authenticationService ):
-  TestBase( authenticationService, connectionString ),
-  m_connection( 0 ),
-  m_schemaName( "" )
-{
-  std::pair<std::string,std::string> databaseAndSchema = domain.decodeUserConnectionString( connectionString );
-  m_connection = domain.newConnection( databaseAndSchema.first );
-  m_schemaName = databaseAndSchema.second;
-}
-
-
-DmlOperations::~DmlOperations()
-{
-  if ( m_connection ) delete m_connection;
-}
-
-*/
 void
 DmlOperations::atomicOperations()
-{
-//  try {
-    
-//    m_connection->connect();
-//    std::auto_ptr<coral::ISession> session( m_connection->newSession( m_schemaName ) );
-//    session->startUserSession( this->username(), this->password() );
-    
+{    
     session->transaction().start();
 
     coral::ITableDataEditor& editor1 = session->nominalSchema().tableHandle(T1).dataEditor();
@@ -110,10 +84,6 @@
 void
 DmlOperations::bulkOperations()
 {
-//  try {
-//    m_connection->connect();
-//    std::auto_ptr<coral::ISession> session( m_connection->newSession( m_schemaName ) );
-//    session->startUserSession( this->username(), this->password() );
     session->transaction().start();
 
     // Fill in table T2
@@ -202,13 +172,4 @@
 
 
     session->transaction().commit();
-//    session->endUserSession();
-//    m_connection->disconnect();
-
-//  }
-//  catch ( coral::SchemaException& e ) {
-//    std::cerr << "Schema exception : " << e.what() << std::endl;
-//    return false;
-//  }
-//  return true;
 }
diff -Naur orig.src/Tests/Integration_Basic/src/main.cpp coral/Tests/Integration_Basic/src/main.cpp
--- orig.src/Tests/Integration_Basic/src/main.cpp	2008-10-07 16:24:56.000000000 +0200
+++ src/Tests/Integration_Basic/src/main.cpp	2008-12-12 14:57:10.000000000 +0100
@@ -19,7 +19,7 @@
   TestEnv TC01("BASIS");
   
   TestEnvWriters& wr01 = TC01.addWriters().addDefault("oracle").add("mysql").add("sqlite");
-  wr01.readers("oracle").addDefault("oracle").add("coral");  
+  wr01.readers("oracle").addDefault("oracle").add("coral");
   wr01.readers("mysql").addDefault("mysql");  
   wr01.readers("sqlite").addDefault("sqlite").add("coral");  
   
diff -Naur orig.src/Tests/Integration_Basic/src/SchemaDefinition.cpp coral/Tests/Integration_Basic/src/SchemaDefinition.cpp
--- orig.src/Tests/Integration_Basic/src/SchemaDefinition.cpp	2008-10-07 16:24:56.000000000 +0200
+++ src/Tests/Integration_Basic/src/SchemaDefinition.cpp	2008-11-07 15:47:27.000000000 +0100
@@ -61,6 +61,9 @@
     constraintColumns[0] = "X";
     constraintColumns[1] = "Z";
     
+    ///follwing was commented out of fialing for mysql plugin
+    ///related to bug #36513
+    
  //   table.schemaEditor().setUniqueConstraint( constraintColumns );
 
     /// Add a unique index
@@ -101,6 +104,10 @@
     session->nominalSchema().createTable( description3 ).privilegeManager().grantToPublic( coral::ITablePrivilegeManager::Select );
      
      coral::sleepSeconds( 1 );
+     
+     ///following part was commented out of failing for mysql plugin
+     ///related to bug #36512
+     
    // Create a view
 /*    std::cout << "ende10" << std::endl;
     coral::IViewFactory* factory = schema.viewFactory();
diff -Naur orig.src/Tests/Integration_Basic/src/SetOperations.cpp coral/Tests/Integration_Basic/src/SetOperations.cpp
--- orig.src/Tests/Integration_Basic/src/SetOperations.cpp	2008-08-13 18:50:38.000000000 +0200
+++ src/Tests/Integration_Basic/src/SetOperations.cpp	2008-11-14 10:42:55.000000000 +0100
@@ -1,9 +1,10 @@
 #include "SetOperations.h"
 #include "TestEnv/TestingConfig.h"
 
-SetOperations::SetOperations(TestEnv * env) : Testing(env)
+SetOperations::SetOperations(TestEnv * env)
+  : Testing(env)
 {
-  env->getTableString(T4, "T4");
+  _env.getTableString(T4, "T4");
 }
 
 SetOperations::~SetOperations()
@@ -34,7 +35,7 @@
       throw std::runtime_error( "Unexpected number of rows" );
       
     //at the moment MINUS and INTERSECT only working on oracle databases
-    if(env->getDBType(pos).compare("oracle") == 0){
+    if(_env.getDBType(pos).compare("oracle") == 0){
 
     std::cout << " Query 2:" << std::endl;
     coral::IQuery* query2 = workingSchema.newQuery();
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/authentication.xml coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/authentication.xml
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/authentication.xml	2006-08-10 12:04:00.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/authentication.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,9 +0,0 @@
-<?xml version="1.0" ?>
-<connectionlist>
-
-<connection name="oracle://devdb10/ral_writer">
-  <parameter name="user" value="ral_writer" />
-  <parameter name="password" value="ral" />
-</connection>
-
-</connectionlist>
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/BuildFile coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/BuildFile
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/BuildFile	2006-08-10 12:03:52.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,3 +0,0 @@
-<use name=RelationalAccess></use>
-<use name=ConnectionService></use>
-<lib name=lcg_coral_ConnectionService></lib>
\ No newline at end of file
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/dblookup.xml coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/dblookup.xml
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/dblookup.xml	2006-08-10 12:04:01.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,8 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-
-  <logicalservice name="/dbdev/service_1">
-    <service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-  </logicalservice>
-  
-</servicelist>
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/OvalFile coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/OvalFile
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/OvalFile	2006-08-10 12:03:59.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_ConnectionPool_LFCLookupService"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_ConnectionService_ConnectionPool_LFCLookupService"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/main.cpp coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/main.cpp
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/main.cpp	2006-08-10 12:04:07.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,40 +0,0 @@
-#include "TestApp.h"
-#include "CoralBase/Exception.h"
-#include "SealKernel/Exception.h"
-#include <iostream>
-#include <exception>
-#include <cstdlib>
-
-
-int main( int, char** )
-{
-  try {
-    // Set the authentication path
-    if ( ! ::getenv( "CORAL_AUTH_PATH" ) ) {
-      ::putenv( "CORAL_AUTH_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    }
-    //if ( ! ::getenv( "CORAL_DBLOOKUP_PATH" ) ) {
-    // ::putenv( "CORAL_DBLOOKUP_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    //}
-
-    TestApp app;
-    app.run();
-  }
-  catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.cpp coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.cpp
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.cpp	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,164 +0,0 @@
-#include "TestApp.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/IMessageService.h"
-#include "PluginManager/PluginManager.h"
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "../../../ConnectionService/src/ConnectionService.h"
-#include "../../../ConnectionService/src/SessionProxy.h"
-#include "../../../ConnectionService/src/ConnectionPool.h"
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp():
-  m_context( new seal::Context ){
-  this->loadServices();
-}
-
-
-TestApp::~TestApp()
-{
-}
-
-//
-void TestApp::setupDataSource( const std::string& connectionString){
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-  session->transaction().start();
-  // creates a dummy table to be looked up
-  session->nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session->nominalSchema().createTable( descr );
-  session->transaction().commit();
-  delete session;
-}
-
-void
-TestApp::loadServices()
-{
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context.get() );
-
-  // Load the SEAL Message service and set the output threshold to Info
-  loader->load( "SEAL/Services/MessageService" );
-  std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-  m_context->query( v_msgSvc );
-  if ( ! v_msgSvc.empty() ) {
-    seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-    msgSvc->setOutputLevel( seal::Msg::Debug);
-  }
-
-  // Load the Connection Service
-  std::cout << "Loading Connection Service"<<std::endl;
-  loader->load( "CORAL/Services/ConnectionService" );
-  loader->load( "CORAL/Services/LFCLookupService" );
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  std::vector< seal::IHandle<coral::IConnectionService> > v_svc;
-  m_context->query( v_svc );
-  if ( v_svc.empty() ) {
-    throw std::runtime_error( "Could not locate the connection service" );
-  }
-  return v_svc.front();
-}
-
-void
-TestApp::run(){
-  
-  setupDataSource("oracle://devdb10/ral_writer");
-  
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-
-  try {
-    theConnectionService->configuration().setConnectionTimeOut(10);
-    std::cout << "Getting the first sessionProxy object "<<std::endl;
-    std::string connectionString("write_test");  
-    coral::ISessionProxy* session1 = theConnectionService->connect( connectionString );
-    session1->transaction().start( true );
-    std::set<std::string> tables = session1->nominalSchema().listTables();
-    session1->transaction().commit();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    coral::ConnectionService::ConnectionService* myService =
-    dynamic_cast<coral::ConnectionService::ConnectionService*>(theConnectionService.get());
-    std::cout << "-------------------------(1)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    delete session1;
-    std::cout << "--------------------------(2)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    coral::ISessionProxy* session2 = theConnectionService->connect( connectionString );
-    std::cout << "--------------------------(3)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    coral::ISessionProxy* session3 = theConnectionService->connect( connectionString );
-    std::cout << "--------------------------(4)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    coral::ISessionProxy* session4 = theConnectionService->connect( connectionString, coral::ReadOnly );
-    std::cout << "--------------------------(5)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    session4->transaction().start( true );
-    tables = session4->nominalSchema().listTables();
-    session4->transaction().commit();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session2;
-    coral::ISessionProxy* session5 = theConnectionService->connect( connectionString, coral::ReadOnly );
-    std::cout << "--------------------------(6)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    session5->transaction().start( true );
-    tables = session5->nominalSchema().listTables();
-    session5->transaction().commit();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session3;
-    delete session4;
-    delete session5;
-    std::cout << "--------------------------(7)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;
-    ::sleep(20);
-    theConnectionService->purgeConnectionPool();
-    std::cout << "--------------------------(7-bis)"<<std::endl;
-    std::cout << OVALTAG <<"Number of idle connection:"<< myService->numberOfIdleConnectionsInPool()<<std::endl;
-    std::cout << OVALTAG <<"Number of active connection:"<< myService->numberOfActiveConnectionsInPool()<<std::endl;  
- 
-  }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.h coral/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.h
--- orig.src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.h	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ConnectionPool_LFCLookupService/src/TestApp.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,38 +0,0 @@
-#ifndef INCLUDE_TESTAPP_H
-#define INCLUDE_TESTAPP_H
-
-#include "RelationalAccess/IConnectionService.h"
-#include "SealKernel/Context.h"
-#include <string>
-
-class TestApp
-{
-public:
-  static const std::string OVALTAG;
-  
-  // Constructor
-  TestApp();
-
-  // Destructor
-  ~TestApp();
-
-  // run method
-  void run();
-
-private:
-  // Loads the basic services
-  void loadServices();
-
-  // Returns the connection service handle
-  seal::IHandle<coral::IConnectionService> connectionService();
-  
-  //
-  void setupDataSource( const std::string& connectionString);
-
-  
-private:
-  // The application context
-  seal::Handle<seal::Context> m_context;
-};
-
-#endif
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/authentication.xml coral/Tests/Integration_ConnectionService_LFCLookupService/authentication.xml
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/authentication.xml	2006-08-10 11:57:43.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/authentication.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,19 +0,0 @@
-<?xml version="1.0" ?>
-<connectionlist>
-
-<connection name="oracle://devdb10/ral_reader">
-  <parameter name="user" value="ral_reader" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="oracle://devdb10/ral_writer">
-  <parameter name="user" value="ral_writer" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="mysql://pcitdb59.cern.ch/RADO_POOL">
-  <parameter name="user" value="rado_pool" />
-  <parameter name="password" value="rado_pool" />
-</connection>
-
-</connectionlist>
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/BuildFile coral/Tests/Integration_ConnectionService_LFCLookupService/BuildFile
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/BuildFile	2006-08-10 11:57:43.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,5 +0,0 @@
-
-<use name=RelationalAccess></use>
-<use name=CoralCommon></use>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/OvalFile coral/Tests/Integration_ConnectionService_LFCLookupService/OvalFile
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/OvalFile	2006-08-10 11:57:43.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_LFCLookupService"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_Integration_ConnectionService_LFCLookupService"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.cpp coral/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.cpp
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.cpp	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,68 +0,0 @@
-#include "Connection.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include <iostream>
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ITransaction.h"
-#include "SealKernel/Context.h"
-#include <stdexcept>
-
-
-
-
-
-using std::cout;
-using std::endl;
-
-Connection::Connection()
-{
-    
-  m_context = new seal::Context ;
-
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context.get() );
-  loader->load("CORAL/Services/ConnectionService");
-  seal::IHandle<coral::IConnectionService> iHandle =
-  m_context->query<coral::IConnectionService>( "CORAL/Services/ConnectionService" );
-
-  if ( ! iHandle ) 
-          cout<<"can not find ConnectionService"<<endl;
-	  
-  else
-  {
-     coral::IConnectionServiceConfiguration& config = iHandle->configuration();
-    
-     config.setDefaultAuthenticationService("CORAL/Services/XMLAuthenticationService");
-     config.setDefaultRelationalService("CORAL/Services/RelationalService");
-     config.setDefaultLookupService("CORAL/Services/LFCLookupService");
-     config.setDefaultMonitoringService("CORAL/Services/MonitoringService"); 
-  
-     config.setConnectionRetrialPeriod(2);
-     config.setConnectionRetrialTimeOut(20);    
-    
-  }
- 
-}
-
-Connection::~Connection()
-{
-}
-
-coral::ISessionProxy* Connection::getSessionProxy( const std::string& ConnectionName, coral::AccessMode mode)
-{
-  seal::IHandle<coral::IConnectionService> iHandle =
-  m_context->query<coral::IConnectionService>( "CORAL/Services/ConnectionService" );
-
-  if ( ! iHandle )
-  { 
-          cout<<"can not find ConnectionService"<<endl;
-	  throw std::runtime_error( "Could not locate the connection service" );
-  }	  
-  else
-  {
-     coral::ISessionProxy *proxy = iHandle->connect(ConnectionName,mode );
-     return proxy;
-  }
-  
-}  
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.h coral/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.h
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.h	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/Connection.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,28 +0,0 @@
-#include <string>
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/AccessMode.h"
-#include "PluginManager/PluginManager.h"
-#include "SealKernel/Context.h"
-#include "SealKernel/ComponentLoader.h"
-#include "RelationalAccess/IConnectionService.h"
-
-namespace coral {
-  class ISessionProxy;
-}
-
-class Connection
-{
-public:
-  // Constructor
-  Connection();
-
-  // Destructor
-  ~Connection();
-  
-  coral::ISessionProxy* getSessionProxy( const std::string& ConnectionName, coral::AccessMode mode);
-  
-  
-  private:
-  seal::Handle<seal::Context> m_context;
-  
-};
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/main.cpp coral/Tests/Integration_ConnectionService_LFCLookupService/src/main.cpp
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/main.cpp	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,90 +0,0 @@
-
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/ISchema.h"
-#include <string>
-#include "Connection.h"
-#include "SchemaTest.h"
-#include "MysqlSchema.h"
-#include <iostream>
-#include <stdexcept>
-#include <stdio.h>	
-#include "CoralBase/Exception.h"
-#include "RelationalAccess/ITypeConverter.h"
-#include <exception>
-#include "RelationalAccess/ITransaction.h"
-using std::cout;
-using std::endl;
-
-
-int main( int, char** )
-{
-   
-try {  
-       /** Initialize Connection Service */
-       Connection  connService; 
-    
-       /** open session proxy using MySQL technology providing logical service name & access
-           mode */
-       coral::ISessionProxy* proxy1 = connService.getSessionProxy("my_test",coral::ReadOnly);
-    
-       std::cout << "Test with mysql."<<std::endl;
-	     MysqlSchema mysqlTest(proxy1);
-	     mysqlTest.listTables("test");
-	 
-	     /** connection exists and will be recycled */
-	     coral::ISessionProxy* proxy_update = connService.getSessionProxy("my_test",coral::Update);   
-        MysqlSchema mysqlTest_update(proxy_update);
-	     mysqlTest_update.listTables("RADO_POOL");
-	     cout<<" Is connection shared: "<<proxy_update->isConnectionShared()<<endl;
-	     delete proxy1;
-	     delete proxy_update;
-      
-       /** open session proxy using SQLite technology */
-       proxy1 = connService.getSessionProxy("sql_test",coral::Update);
-       cout << "Supported C++ types: " << std::endl;
-       std::set<std::string> cppTypes = proxy1->typeConverter().supportedCppTypes();
-       for ( std::set<std::string>::const_iterator iType = cppTypes.begin();
-        iType != cppTypes.end(); ++iType ) {
-        std::cout << *iType << std::endl;
-        std::cout << "                      -> "
-              << proxy1->typeConverter().sqlTypeForCppType( *iType ) << std::endl;
-       }
-       delete proxy1;
-       
-       
-       std::cout << "Schema Test - writer."<<std::endl;
-       /** get proxy to session providing logical service name and access mode */
-       coral::ISessionProxy* proxy = connService.getSessionProxy("oracle://devdb10/ral_writer",coral::Update);
-       /** create and fill schema using same authentication parameters */
-       SchemaTest *test1 = new (SchemaTest)(proxy);
-       test1->createSchema();
-       delete test1;
-       delete proxy;
-       
-       std::cout << "Schema Test - reader."<<std::endl;
-       /** read created schema using new authentication on previously opened
-           and released session - authentication parameters will be switched */ 
-       coral::ISessionProxy* proxy2 = connService.getSessionProxy("reader_test",coral::ReadOnly);
-       coral::ISchema& schema = proxy2->nominalSchema();
-       SchemaTest *test2 = new (SchemaTest)(proxy2);
-       test2->readSchema("ral_writer");
-       delete test2;
-       delete proxy2;
-       std::cout << "Test completed."<<std::endl;
-    }
-   catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/main.log coral/Tests/Integration_ConnectionService_LFCLookupService/src/main.log
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/main.log	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/main.log	1970-01-01 01:00:00.000000000 +0100
@@ -1,14 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : dpathy
-[oval run] HOST : lxplus065.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: main
-[oval run] =================================================
-
-main: Command not found.
-
-[oval run] ==========================================
-[oval run] result: FAILED RUN
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.cpp coral/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.cpp
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.cpp	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,26 +0,0 @@
-#include "MysqlSchema.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include <iostream>
-
-
-
-
-MysqlSchema::MysqlSchema(coral::ISessionProxy *proxy):
-m_proxy (proxy)
-{}
-
-
-MysqlSchema::~MysqlSchema()
-{
- 
-}
-void MysqlSchema::listTables(const std::string& schema)
-{
-    m_proxy->transaction().start();
-    std::cout << "Tables in the schema: " << schema<<std::endl;
-    std::set< std::string > listOfTables = m_proxy->schema(schema).listTables();
-    for ( std::set< std::string >::const_iterator iTable = listOfTables.begin();
-          iTable != listOfTables.end(); ++iTable ) std::cout << *iTable << std::endl;
-    m_proxy->transaction().commit();
-}    
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.h coral/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.h
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.h	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/MysqlSchema.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,20 +0,0 @@
-#include "RelationalAccess/ISessionProxy.h"
-#include <string>
-
-class MysqlSchema
-{
-public:
-  MysqlSchema( coral::ISessionProxy *proxy );
-
-  ~MysqlSchema();
-
-  void listTables(const std::string& schema);
-
-  
-
-private:
-  
-  coral::ISessionProxy *m_proxy;
-  
-};
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.cpp coral/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.cpp
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.cpp	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,302 +0,0 @@
-
-#include "RelationalAccess/ITransaction.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITable.h"
-#include "RelationalAccess/ITableSchemaEditor.h"
-//#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/IColumn.h"
-#include "RelationalAccess/IIndex.h"
-#include "RelationalAccess/IUniqueConstraint.h"
-#include "RelationalAccess/IPrimaryKey.h"
-#include "RelationalAccess/IForeignKey.h"
-#include "RelationalAccess/IViewFactory.h"
-#include "RelationalAccess/IView.h"
-#include "RelationalAccess/ITablePrivilegeManager.h"
-#include "RelationalAccess/SchemaException.h"
-#include "CoralBase/AttributeList.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ITableDataEditor.h"
-#include "RelationalAccess/IBulkOperation.h"
-
-#include "CoralBase/Attribute.h"
-#include "SealBase/IntBits.h"
-
-
-#include "CoralBase/Blob.h"
-#include "SealBase/TimeInfo.h"
-#include "SchemaTest.h"
-#include <memory>
-#include "RelationalAccess/IQuery.h"
-#include "RelationalAccess/ICursor.h"
-
-
-#include <stdexcept>
-#include <sstream>
-#include <memory>
-#include <iostream>
-
-SchemaTest::SchemaTest(coral::ISessionProxy *proxy)
-{
-   m_proxy = proxy;
-}
-
-
-SchemaTest::~SchemaTest()
-{
-
- //  delete m_proxy;
-}
-
- 
-bool SchemaTest::createSchema()
-{
-  try {
-    m_proxy->transaction().start();
-
-    // Get rid of the previous tables and views
-    m_proxy->nominalSchema().dropIfExistsView( "V0" );
-    m_proxy->nominalSchema().dropIfExistsTable( "T3" );
-    m_proxy->nominalSchema().dropIfExistsTable( "T2" );
-    m_proxy->nominalSchema().dropIfExistsTable( "T1" );
-
-    // Create the first table
-    coral::TableDescription description1( "SchemaTest_Test" );
-    description1.setName( "T1" );
-    description1.insertColumn( "id",
-                               coral::AttributeSpecification::typeNameForId( typeid(int) ) );
-    // Define primary key
-    description1.setPrimaryKey( "id" );
-    description1.insertColumn( "t",
-                               coral::AttributeSpecification::typeNameForId( typeid(short) ) );
-    description1.insertColumn( "Xx",
-                              coral::AttributeSpecification::typeNameForId( typeid(float) ) );
-    // Set column not null
-    description1.setNotNullConstraint( "Xx" );
-    description1.insertColumn( "Y",
-                               coral::AttributeSpecification::typeNameForId( typeid(double) ) );
-    // Add a unique constraint specifying a name
-    description1.setUniqueConstraint( "Y", "U_T1_Y" );
-    description1.insertColumn( "Z",
-                               coral::AttributeSpecification::typeNameForId( typeid(double) ) );
-    // Add a variable size string
-    description1.insertColumn( "Comment",
-                               coral::AttributeSpecification::typeNameForId( typeid(std::string) ),
-                               100,
-                               false );
-    // Add a blob
-    description1.insertColumn( "Data",
-                               coral::AttributeSpecification::typeNameForId( typeid(coral::Blob) ) );
-
-    // Create the actual table
-    coral::ITable& table = m_proxy->nominalSchema().createTable( description1 );
-
-
-    // Change the column name
-    table.schemaEditor().renameColumn( "Xx", "X" );
-
-    // Change the column type
-    table.schemaEditor().changeColumnType( "t",
-                                           coral::AttributeSpecification::typeNameForId( typeid(seal::IntBits<64>::SLeast) ) );
-    // Add a not null constaint
-    table.schemaEditor().setNotNullConstraint( "t" );
-
-    // Add a unique constraint made out of two columns
-    std::vector< std::string > constraintColumns( 2 );
-    constraintColumns[0] = "X";
-    constraintColumns[1] = "Z";
-    table.schemaEditor().setUniqueConstraint( constraintColumns );
-
-    /// Add a unique index
-    table.schemaEditor().createIndex( "T1_IDX_t", "t", true );
-
-    // Give privileges
-    table.privilegeManager().grantToPublic( coral::ITablePrivilegeManager::Select );
-
-    // Create the second table
-    coral::TableDescription description2( "SchemaDefinition_Test" );
-    description2.setName( "T2" );
-    description2.insertColumn( "id",
-                               coral::AttributeSpecification::typeNameForId( typeid(long) ) );
-    description2.setUniqueConstraint( "id" );
-    description2.setNotNullConstraint( "id" );
-    description2.insertColumn( "tx",
-                               coral::AttributeSpecification::typeNameForId( typeid(float) ) );
-    description2.setNotNullConstraint( "tx" );
-    description2.insertColumn( "ty",
-                               coral::AttributeSpecification::typeNameForId( typeid(double) ) );
-    description2.setNotNullConstraint( "ty" );
-    m_proxy->nominalSchema().createTable( description2 ).privilegeManager().grantToPublic( coral::ITablePrivilegeManager::Select );
-
-
-
-    // Create the third table
-    coral::TableDescription description3( "SchemaTest_Test" );
-    description3.setName( "T3" );
-    description3.insertColumn( "id",
-                               coral::AttributeSpecification::typeNameForId( typeid(long) ) );
-    description3.setPrimaryKey( "id" );
-    description3.insertColumn( "fk1",
-                               coral::AttributeSpecification::typeNameForId( typeid(long) ) );
-    description3.createForeignKey( "T3_FK1", "fk1", "T1", "id" );
-    description3.insertColumn( "fk2",
-                               coral::AttributeSpecification::typeNameForId( typeid(long) ) );
-    description3.createForeignKey( "T3_FK2", "fk2", "T2", "id" );
-    description3.insertColumn( "Qn",
-                               coral::AttributeSpecification::typeNameForId( typeid(float) ) );
-    m_proxy->nominalSchema().createTable( description3 ).privilegeManager().grantToPublic( coral::ITablePrivilegeManager::Select );
-
-    // Create a view
-    //coral::IViewFactory* factory = m_proxy->nominalSchema().viewFactory();
-    //factory->addToOutputList( "T3.id", "id" );
-    //factory->addToOutputList( "T1.X", "x" );
-    //factory->addToOutputList( "T1.Y", "y" );
-    //factory->addToOutputList( "T1.Z", "z" );
-    //factory->addToOutputList( "T2.tx", "TX" );
-    //factory->addToOutputList( "T2.ty", "TY" );
-    //factory->addToTableList( "T3" );
-    //factory->addToTableList( "T1" );
-    //factory->addToTableList( "T2" );
-    //factory->setCondition( "T1.id = T3.fk1 AND T2.id = T3.fk2 AND T3.Qn > 0.5",
-    //                      coral::AttributeList() );
-    //factory->create( "V0" ).privilegeManager().grantToPublic( coral::ITablePrivilegeManager::Select );
-    //delete factory;
-
-    m_proxy->transaction().commit();
-    seal::TimeInfo::sleep(1);
-  }
-  catch ( coral::SchemaException& e ) {
-    m_proxy->transaction().rollback();
-    std::cerr << "Schema exception " << e.what() << std::endl;
-    return false;
-  }
-  return true;
-}
-
-bool SchemaTest::readSchema(const std::string& schema)
-{
-  try {
-    
-    m_proxy->transaction().start( true );
-
-    // Examine the tables
-    this->printTableInfo( m_proxy->schema(schema).tableHandle( "T1" ).description() );
-    this->printTableInfo( m_proxy->schema(schema).tableHandle( "T2" ).description() );
-    this->printTableInfo( m_proxy->schema(schema).tableHandle( "T3" ).description() );
- 
-    m_proxy->transaction().commit();
-    
-  }
-  catch ( coral::SchemaException& e ) {
-    std::cerr << e.what() << std::endl;
-    return false;
-  }
-  return true;
-}
-
-void SchemaTest::printTableInfo( const coral::ITableDescription& description ) const
-{
-  int numberOfColumns = description.numberOfColumns();
-  std::cout << "Table " << description.name();
-  std::string tableSpaceName = description.tableSpaceName();
-  if ( ! tableSpaceName.empty() )
-    std::cout << " (created in tablespace " << tableSpaceName << ")";
-  std::cout << " has" << std::endl
-            << "  " << numberOfColumns << " columns :" << std::endl;
-  for ( int i = 0; i < numberOfColumns; ++i ) {
-    const coral::IColumn& column = description.columnDescription( i );
-    std::cout << "    " << column.name() << " (" << column.type() << ")";
-    if ( column.isUnique() ) std::cout << " UNIQUE";
-    if ( column.isNotNull() ) std::cout << " NOT NULL";
-    std::cout << std::endl;
-  }
-
-  if ( description.hasPrimaryKey() ) {
-    const std::vector<std::string>& columnNames = description.primaryKey().columnNames();
-    std::cout << "  Primary key defined for column";
-    if ( columnNames.size() > 1 ) std::cout << "s";
-    std::cout << " ";
-    for ( std::vector<std::string>::const_iterator iColumn = columnNames.begin();
-          iColumn != columnNames.end(); ++iColumn ) {
-      if ( iColumn != columnNames.begin() ) std::cout << ", ";
-      std::cout << *iColumn;
-    }
-    std::string tableSpace = description.primaryKey().tableSpaceName();
-    if ( ! tableSpace.empty() )
-      std::cout << " in tablespace " << tableSpace;
-    std::cout << std::endl;
-  }
-
-  int numberOfUniqueConstraints = description.numberOfUniqueConstraints();
-  std::cout << "  " << numberOfUniqueConstraints;
-  if ( numberOfUniqueConstraints == 1 ) std::cout << " unique constraint:" << std::endl;
-  else if ( numberOfUniqueConstraints == 0 ) std::cout << " unique constraints" << std::endl;
-  else std::cout << " unique constraints:" << std::endl;
-  for ( int i = 0; i < numberOfUniqueConstraints; ++i ) {
-    const coral::IUniqueConstraint& uniqueConstraint = description.uniqueConstraint( i );
-    std::cout << "    " << uniqueConstraint.name() << " defined for column";
-    const std::vector<std::string>& columnNames = uniqueConstraint.columnNames();
-    if ( columnNames.size() > 1 ) std::cout << "s";
-    std::cout << " ";
-    for (  std::vector<std::string>::const_iterator iColumn = columnNames.begin();
-           iColumn != columnNames.end(); ++iColumn ) {
-      if ( iColumn != columnNames.begin() ) std::cout << ", ";
-      std::cout << *iColumn;
-    }
-    std::string tableSpace = uniqueConstraint.tableSpaceName();
-    if ( ! tableSpace.empty() )
-      std::cout << " in tablespace " << tableSpace;
-    std::cout << std::endl;
-  }
-
-  int numberOfIndices = description.numberOfIndices();
-  std::cout << "  " << numberOfIndices;
-  if ( numberOfIndices == 1 ) std::cout << " index:" << std::endl;
-  else if ( numberOfIndices == 0 ) std::cout << " indices" << std::endl;
-  else std::cout << " indices:" << std::endl;
-  for ( int i = 0; i < numberOfIndices; ++i ) {
-    const coral::IIndex& index = description.index( i );
-    std::cout << "    " << index.name();
-    if ( index.isUnique() ) std::cout << " (UNIQUE)";
-    std::cout << " defined for column";
-    const std::vector<std::string>& columnNames = index.columnNames();
-    if ( columnNames.size() > 1 ) std::cout << "s";
-    std::cout << " ";
-    for (  std::vector<std::string>::const_iterator iColumn = columnNames.begin();
-           iColumn != columnNames.end(); ++iColumn ) {
-      if ( iColumn != columnNames.begin() ) std::cout << ", ";
-      std::cout << *iColumn;
-    }
-    std::string tableSpace = index.tableSpaceName();
-    if ( ! tableSpace.empty() )
-      std::cout << " in tablespace " << tableSpace;
-    std::cout << std::endl;
-  }
-
-  int numberOfForeignKeys = description.numberOfForeignKeys();
-  std::cout << "  " << numberOfForeignKeys;
-  if ( numberOfForeignKeys == 1 ) std::cout << " foreign key:" << std::endl;
-  else if ( numberOfForeignKeys == 0 ) std::cout << " foreign keys" << std::endl;
-  else std::cout << " foreign keys:" << std::endl;
-  for ( int i = 0; i < numberOfForeignKeys; ++i ) {
-    const coral::IForeignKey& foreignKey = description.foreignKey( i );
-    std::cout << "    " << foreignKey.name() << " defined for column";
-    const std::vector<std::string>& columnNames = foreignKey.columnNames();
-    if ( columnNames.size() > 1 ) std::cout << "s";
-    std::cout << " ";
-    for (  std::vector<std::string>::const_iterator iColumn = columnNames.begin();
-           iColumn != columnNames.end(); ++iColumn ) {
-      if ( iColumn != columnNames.begin() ) std::cout << ", ";
-      std::cout << *iColumn;
-    }
-    std::cout << " -> " << foreignKey.referencedTableName() << "( "; 
-    const std::vector<std::string>& columnNamesR = foreignKey.referencedColumnNames();
-    for (  std::vector<std::string>::const_iterator iColumn = columnNamesR.begin();
-           iColumn != columnNamesR.end(); ++iColumn ) {
-      if ( iColumn != columnNamesR.begin() ) std::cout << ", ";
-      std::cout << *iColumn;
-    }
-    std::cout << " )" << std::endl;
-  }
-}
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.h coral/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.h
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.h	2006-08-10 11:58:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/src/SchemaTest.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,31 +0,0 @@
-#include "RelationalAccess/ISessionProxy.h"
-
-#include "RelationalAccess/TableDescription.h"
-
-namespace coral {
-  class ITableDescription;
-  class IView;
-}
-
-class SchemaTest
-{
-public:
-  SchemaTest( coral::ISessionProxy *proxy );
-
-  ~SchemaTest();
-
-  bool createSchema();
-
-  bool readSchema(const std::string& schema);
-  
-  bool Query(const std::string& workingSchema);
-  bool bulkOperations();
-  bool atomicOperations();
-
-private:
- 
-  void printTableInfo( const coral::ITableDescription& description ) const;
-  coral::ISessionProxy *m_proxy;
-  std::string  m_connectionString;
-};
-
diff -Naur orig.src/Tests/Integration_ConnectionService_LFCLookupService/test_Integration_ConnectionService_LFCLookupService.ref coral/Tests/Integration_ConnectionService_LFCLookupService/test_Integration_ConnectionService_LFCLookupService.ref
--- orig.src/Tests/Integration_ConnectionService_LFCLookupService/test_Integration_ConnectionService_LFCLookupService.ref	2006-08-10 11:57:43.000000000 +0200
+++ src/Tests/Integration_ConnectionService_LFCLookupService/test_Integration_ConnectionService_LFCLookupService.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,204 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : dpathy
-[oval run] HOST : lxplus009.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: test_Integration_ConnectionService_LFCLookupService
-[oval run] =================================================
-
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=0
-CORAL/Services/ConnectionService: level[Info] Loading default plugin for coral::IRelationalService: CORAL/Services/RelationalService
-CORAL/Services/RelationalService: level[Info] Found plugin for RDBMS technology "frontier" with native implementation
-CORAL/Services/RelationalService: level[Info] Found plugin for RDBMS technology "mysql" with native implementation
-CORAL/Services/RelationalService: level[Info] Found plugin for RDBMS technology "oracle" with native implementation
-CORAL/Services/RelationalService: level[Info] Found plugin for RDBMS technology "sqlite" with native implementation
-CORAL/Services/RelationalService: level[Info] Default implementation for RDBMS technology "frontier" is native
-CORAL/Services/RelationalService: level[Info] Default implementation for RDBMS technology "mysql" is native
-CORAL/Services/RelationalService: level[Info] Default implementation for RDBMS technology "oracle" is native
-CORAL/Services/RelationalService: level[Info] Default implementation for RDBMS technology "sqlite" is native
-CORAL/Services/ConnectionService: level[Info] Loading default plugin for coral::ILookupService: CORAL/Services/LFCLookupService
-CORAL/Services/ConnectionService: level[Info] Loading default plugin for coral::IAuthenticationService: CORAL/Services/XMLAuthenticationService
-CORAL/Services/ConnectionService: level[Debug] No valid connection to my_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService: level[Debug] Trying to get a new Read-Only connection to mysql://pcitdb59.cern.ch/RADO_POOL
-CORAL/RelationalPlugins/mysql: level[Debug] MySQLAccess domain is loading its components
-MySQLAccess::TypeConverter: level[Debug] Initializing MySQL type converter
-CORAL/RelationalPlugins/mysql: level[Warning] Establishing connection with login name failed, user supplied credentials required
-CORAL/Services/ConnectionService: level[Info] Read-Only Connection to mysql://pcitdb59.cern.ch/RADO_POOL established. Id=4c9e1e5e-2785-11db-83e9-000e0c4d41f8
-CORAL/RelationalPlugins/mysql: level[Debug] Starting user session by connecting for: rado_pool
-CORAL/Services/ConnectionService: level[Info] Session on connection to mysql://pcitdb59.cern.ch/RADO_POOL started for user rado_pool. Id=4c9e1e5e-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] A new Read-Only connection to mysql://pcitdb59.cern.ch/RADO_POOL has been added in the active list. Id=4c9e1e5e-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=0
-Test with mysql.
-Tables in the schema: test
-T
-T_0
-T_1
-maxll
-CORAL/Services/ConnectionService: level[Debug] No valid connection to my_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService: level[Debug] Trying to get a new Update connection to mysql://pcitdb59.cern.ch/RADO_POOL
-CORAL/RelationalPlugins/mysql: level[Warning] Establishing connection with login name failed, user supplied credentials required
-CORAL/Services/ConnectionService: level[Info] Update Connection to mysql://pcitdb59.cern.ch/RADO_POOL established. Id=4d0c2e80-2785-11db-83e9-000e0c4d41f8
-CORAL/RelationalPlugins/mysql: level[Debug] Starting user session by connecting for: rado_pool
-CORAL/Services/ConnectionService: level[Info] Session on connection to mysql://pcitdb59.cern.ch/RADO_POOL started for user rado_pool. Id=4d0c2e80-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] A new Update connection to mysql://pcitdb59.cern.ch/RADO_POOL has been added in the active list. Id=4d0c2e80-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=0
-Tables in the schema: RADO_POOL
-ALIN_DATA
-DataTable
-DataTable2
-DataTable64
-DataTable_180
-Departments
-MySimpleTable1
-MySimpleTable2
-Offices
-POOL_FC_LFN
-POOL_FC_PFN
-T1
-oral1
-oral2
-temporal
-testdec
- Is connection shared: 0
-CORAL/Services/ConnectionService: level[Debug] The valid active connection id=4c9e1e5e-2785-11db-83e9-000e0c4d41f8 to mysql://pcitdb59.cern.ch/RADO_POOL has been moved to the idle list.
-CORAL/Services/ConnectionService: level[Debug] The valid active connection id=4d0c2e80-2785-11db-83e9-000e0c4d41f8 to mysql://pcitdb59.cern.ch/RADO_POOL has been moved to the idle list.
-CORAL/Services/ConnectionService: level[Warning] Failure while retrieving credential parameter "user" from authentication service: Connection string "sqlite_file:yulia.db" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService: level[Warning] Failure while retrieving credential parameter "password" from authentication service: Connection string "sqlite_file:yulia.db" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService: level[Debug] No valid connection to sql_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService: level[Warning] Failure while retrieving credential parameter "user" from authentication service: Connection string "sqlite_file:yulia.db" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService: level[Warning] Failure while retrieving credential parameter "password" from authentication service: Connection string "sqlite_file:yulia.db" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService: level[Debug] Trying to get a new Update connection to sqlite_file:yulia.db
-CORAL/Services/ConnectionService: level[Info] Update Connection to sqlite_file:yulia.db established. Id=4d8d5c62-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Info] Session on connection to sqlite_file:yulia.db started for user . Id=4d8d5c62-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] A new Update connection to sqlite_file:yulia.db has been added in the active list. Id=4d8d5c62-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=2
-Supported C++ types: 
-blob
-                      -> BLOB
-bool
-                      -> BOOLEAN
-char
-                      -> CHAR
-date
-                      -> DATE
-double
-                      -> DOUBLE
-float
-                      -> FLOAT
-int
-                      -> INT
-long
-                      -> LONG
-long double
-                      -> LONGDOUBLE
-long long
-                      -> SLONGLONG
-short
-                      -> SHORT
-string
-                      -> TEXT
-time stamp
-                      -> TIMESTAMP
-unsigned char
-                      -> UNSIGNEDCHAR
-unsigned int
-                      -> UNSIGNEDINT
-unsigned long
-                      -> UNSIGNEDLONG
-unsigned long long
-                      -> ULONGLONG
-unsigned short
-                      -> UNSIGNEDSHORT
-CORAL/Services/ConnectionService: level[Debug] The valid active connection id=4d8d5c62-2785-11db-83e9-000e0c4d41f8 to sqlite_file:yulia.db has been moved to the idle list.
-Schema Test - writer.
-CORAL/Services/ConnectionService: level[Debug] No valid connection to oracle://devdb10/ral_writer found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService: level[Debug] Trying to get a new Update connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService: level[Info] Update Connection to oracle://devdb10/ral_writer established. Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Info] Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] A new Update connection to oracle://devdb10/ral_writer has been added in the active list. Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=3
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "DROP TABLE RAL_WRITER."T3""
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "DROP TABLE RAL_WRITER."T2""
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "DROP TABLE RAL_WRITER."T1""
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "CREATE TABLE RAL_WRITER."T1" ( "id" NUMBER(10), "t" NUMBER(5), "Xx" BINARY_FLOAT NOT NULL, "Y" BINARY_DOUBLE, "Z" BINARY_DOUBLE, "Comment" VARCHAR(100), "Data" BLOB, CONSTRAINT "T1_PK" PRIMARY KEY ( "id" ), CONSTRAINT "U_T1_Y" UNIQUE ( "Y" ) )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "ALTER TABLE RAL_WRITER."T1" RENAME COLUMN "Xx" TO "X""
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "ALTER TABLE RAL_WRITER."T1" MODIFY ( "t" NUMBER(38) )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "ALTER TABLE RAL_WRITER."T1" MODIFY ( "t" NOT NULL )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT ALL_CONSTRAINTS.CONSTRAINT_NAME AS CONSTRAINT_NAME, ALL_CONS_COLUMNS.COLUMN_NAME AS COLUMN_NAME, ALL_INDEXES.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS, ALL_CONS_COLUMNS, ALL_INDEXES WHERE ALL_CONSTRAINTS.OWNER = :"OWNER" AND ALL_CONSTRAINTS.TABLE_NAME = :"TABLE_NAME" AND ALL_CONSTRAINTS.CONSTRAINT_TYPE = 'U' AND ALL_CONS_COLUMNS.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_CONS_COLUMNS.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_INDEXES.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_INDEXES.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_CONS_COLUMNS.CONSTRAINT_NAME = ALL_CONSTRAINTS.CONSTRAINT_NAME AND ALL_INDEXES.INDEX_NAME = ALL_CONS_COLUMNS.CONSTRAINT_NAME ORDER BY ALL_CONSTRAINTS.CONSTRAINT_NAME, ALL_CONS_COLUMNS.POSITION"
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=3
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.INDEX_NAME AS INDEX_NAME, A.UNIQUENESS AS UNIQUENESS, A.TABLESPACE_NAME AS TABLESPACE_NAME,  B.COLUMN_NAME AS COLUMN_NAME FROM ALL_INDEXES A, ALL_IND_COLUMNS B WHERE A.OWNER =:"OWNER" AND A.TABLE_NAME =:"TABLE_NAME" AND A.INDEX_NAME = B.INDEX_NAME AND B.INDEX_OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND A.INDEX_NAME NOT IN ( SELECT CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER = A.OWNER AND TABLE_NAME = A.TABLE_NAME AND ( CONSTRAINT_TYPE = 'P' OR CONSTRAINT_TYPE = 'U' ) ) ORDER BY A.INDEX_NAME, B.COLUMN_POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT B.COLUMN_NAME AS COLUMN_NAME, C.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS A, ALL_CONS_COLUMNS B, ALL_INDEXES C WHERE A.OWNER=:"OWNER" AND A.TABLE_NAME=:"TABLE_NAME" AND A.CONSTRAINT_TYPE = 'P' AND B.OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND B.CONSTRAINT_NAME = A.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = C.INDEX_NAME AND C.OWNER = B.OWNER AND C.TABLE_NAME = B.TABLE_NAME ORDER BY B.POSITION"
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=3
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "ALTER TABLE RAL_WRITER."T1" ADD ( UNIQUE ( "X", "Z" ) )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "CREATE UNIQUE INDEX RAL_WRITER."T1_IDX_t" ON RAL_WRITER."T1" ( "t" )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "GRANT SELECT ON RAL_WRITER."T1" TO PUBLIC"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "CREATE TABLE RAL_WRITER."T2" ( "id" NUMBER(10) NOT NULL UNIQUE, "tx" BINARY_FLOAT NOT NULL, "ty" BINARY_DOUBLE NOT NULL )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "GRANT SELECT ON RAL_WRITER."T2" TO PUBLIC"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "CREATE TABLE RAL_WRITER."T3" ( "id" NUMBER(10), "fk1" NUMBER(10), "fk2" NUMBER(10), "Qn" BINARY_FLOAT, CONSTRAINT "T3_PK" PRIMARY KEY ( "id" ), CONSTRAINT "T3_FK1" FOREIGN KEY ( "fk1" ) REFERENCES RAL_WRITER."T1" ( "id" ), CONSTRAINT "T3_FK2" FOREIGN KEY ( "fk2" ) REFERENCES RAL_WRITER."T2" ( "id" ) )"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "GRANT SELECT ON RAL_WRITER."T3" TO PUBLIC"
-CORAL/Services/ConnectionService: level[Debug] The valid active connection id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the idle list.
-Schema Test - reader.
-CORAL/Services/ConnectionService: level[Debug] User ral_reader allowed to start a Read-Only session on connection Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8 to oracle://devdb10/ral_writer.
-CORAL/Services/ConnectionService: level[Info] Session on connection to oracle://devdb10/ral_writer started for user ral_reader. Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8
-CORAL/Services/ConnectionService: level[Debug] The idle connection Id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the active list.
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=3
-Table T1CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT TABLESPACE_NAME FROM ALL_TABLES WHERE OWNER=:"owner" AND TABLE_NAME=:"table_name""
- (created in tablespace DATA01) has
-  7 columns :
-    id (int)CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT ALL_CONSTRAINTS.CONSTRAINT_NAME AS CONSTRAINT_NAME, ALL_CONS_COLUMNS.COLUMN_NAME AS COLUMN_NAME, ALL_INDEXES.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS, ALL_CONS_COLUMNS, ALL_INDEXES WHERE ALL_CONSTRAINTS.OWNER = :"OWNER" AND ALL_CONSTRAINTS.TABLE_NAME = :"TABLE_NAME" AND ALL_CONSTRAINTS.CONSTRAINT_TYPE = 'U' AND ALL_CONS_COLUMNS.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_CONS_COLUMNS.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_INDEXES.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_INDEXES.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_CONS_COLUMNS.CONSTRAINT_NAME = ALL_CONSTRAINTS.CONSTRAINT_NAME AND ALL_INDEXES.INDEX_NAME = ALL_CONS_COLUMNS.CONSTRAINT_NAME ORDER BY ALL_CONSTRAINTS.CONSTRAINT_NAME, ALL_CONS_COLUMNS.POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.INDEX_NAME AS INDEX_NAME, A.UNIQUENESS AS UNIQUENESS, A.TABLESPACE_NAME AS TABLESPACE_NAME,  B.COLUMN_NAME AS COLUMN_NAME FROM ALL_INDEXES A, ALL_IND_COLUMNS B WHERE A.OWNER =:"OWNER" AND A.TABLE_NAME =:"TABLE_NAME" AND A.INDEX_NAME = B.INDEX_NAME AND B.INDEX_OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND A.INDEX_NAME NOT IN ( SELECT CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER = A.OWNER AND TABLE_NAME = A.TABLE_NAME AND ( CONSTRAINT_TYPE = 'P' OR CONSTRAINT_TYPE = 'U' ) ) ORDER BY A.INDEX_NAME, B.COLUMN_POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT B.COLUMN_NAME AS COLUMN_NAME, C.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS A, ALL_CONS_COLUMNS B, ALL_INDEXES C WHERE A.OWNER=:"OWNER" AND A.TABLE_NAME=:"TABLE_NAME" AND A.CONSTRAINT_TYPE = 'P' AND B.OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND B.CONSTRAINT_NAME = A.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = C.INDEX_NAME AND C.OWNER = B.OWNER AND C.TABLE_NAME = B.TABLE_NAME ORDER BY B.POSITION"
- UNIQUE NOT NULL
-    t (long long) UNIQUE NOT NULL
-    X (float) NOT NULL
-    Y (double) UNIQUE
-    Z (double)
-    Comment (string)
-    Data (blob)
-  Primary key defined for column id in tablespace DATA01
-  2 unique constraints:
-    SYS_C001714137 defined for columns X, Z in tablespace DATA01
-    U_T1_Y defined for column Y in tablespace DATA01
-  1 index:
-    T1_IDX_t (UNIQUE) defined for column t in tablespace DATA01
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.CONSTRAINT_NAME AS FK_NAME, B.TABLE_NAME AS REF_TABLE, C.COLUMN_NAME AS FK_COL, D.COLUMN_NAME AS REF_COL FROM (SELECT CONSTRAINT_NAME, R_CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER" AND TABLE_NAME =:"TABLE_NAME" AND CONSTRAINT_TYPE='R') A, (SELECT TABLE_NAME, CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER") B, (SELECT COLUMN_NAME, CONSTRAINT_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER" AND TABLE_NAME=:"TABLE_NAME" ORDER BY POSITION) C, (SELECT COLUMN_NAME, CONSTRAINT_NAME, TABLE_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER") D WHERE A.R_CONSTRAINT_NAME = B.CONSTRAINT_NAME AND A.CONSTRAINT_NAME = C.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = D.CONSTRAINT_NAME AND C.POSITION = D.POSITION ORDER BY FK_NAME, D.POSITION"
-CORAL/Services/ConnectionService: level[Debug] Checking idle pool for timed-out connections - size=3
-  0 foreign keys
-Table T2CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT TABLESPACE_NAME FROM ALL_TABLES WHERE OWNER=:"owner" AND TABLE_NAME=:"table_name""
- (created in tablespace DATA01) has
-  3 columns :
-    id (int)CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT ALL_CONSTRAINTS.CONSTRAINT_NAME AS CONSTRAINT_NAME, ALL_CONS_COLUMNS.COLUMN_NAME AS COLUMN_NAME, ALL_INDEXES.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS, ALL_CONS_COLUMNS, ALL_INDEXES WHERE ALL_CONSTRAINTS.OWNER = :"OWNER" AND ALL_CONSTRAINTS.TABLE_NAME = :"TABLE_NAME" AND ALL_CONSTRAINTS.CONSTRAINT_TYPE = 'U' AND ALL_CONS_COLUMNS.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_CONS_COLUMNS.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_INDEXES.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_INDEXES.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_CONS_COLUMNS.CONSTRAINT_NAME = ALL_CONSTRAINTS.CONSTRAINT_NAME AND ALL_INDEXES.INDEX_NAME = ALL_CONS_COLUMNS.CONSTRAINT_NAME ORDER BY ALL_CONSTRAINTS.CONSTRAINT_NAME, ALL_CONS_COLUMNS.POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.INDEX_NAME AS INDEX_NAME, A.UNIQUENESS AS UNIQUENESS, A.TABLESPACE_NAME AS TABLESPACE_NAME,  B.COLUMN_NAME AS COLUMN_NAME FROM ALL_INDEXES A, ALL_IND_COLUMNS B WHERE A.OWNER =:"OWNER" AND A.TABLE_NAME =:"TABLE_NAME" AND A.INDEX_NAME = B.INDEX_NAME AND B.INDEX_OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND A.INDEX_NAME NOT IN ( SELECT CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER = A.OWNER AND TABLE_NAME = A.TABLE_NAME AND ( CONSTRAINT_TYPE = 'P' OR CONSTRAINT_TYPE = 'U' ) ) ORDER BY A.INDEX_NAME, B.COLUMN_POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT B.COLUMN_NAME AS COLUMN_NAME, C.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS A, ALL_CONS_COLUMNS B, ALL_INDEXES C WHERE A.OWNER=:"OWNER" AND A.TABLE_NAME=:"TABLE_NAME" AND A.CONSTRAINT_TYPE = 'P' AND B.OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND B.CONSTRAINT_NAME = A.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = C.INDEX_NAME AND C.OWNER = B.OWNER AND C.TABLE_NAME = B.TABLE_NAME ORDER BY B.POSITION"
- UNIQUE NOT NULL
-    tx (float) NOT NULL
-    ty (double) NOT NULL
-  1 unique constraint:
-    SYS_C001714141 defined for column id in tablespace DATA01
-  0 indices
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.CONSTRAINT_NAME AS FK_NAME, B.TABLE_NAME AS REF_TABLE, C.COLUMN_NAME AS FK_COL, D.COLUMN_NAME AS REF_COL FROM (SELECT CONSTRAINT_NAME, R_CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER" AND TABLE_NAME =:"TABLE_NAME" AND CONSTRAINT_TYPE='R') A, (SELECT TABLE_NAME, CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER") B, (SELECT COLUMN_NAME, CONSTRAINT_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER" AND TABLE_NAME=:"TABLE_NAME" ORDER BY POSITION) C, (SELECT COLUMN_NAME, CONSTRAINT_NAME, TABLE_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER") D WHERE A.R_CONSTRAINT_NAME = B.CONSTRAINT_NAME AND A.CONSTRAINT_NAME = C.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = D.CONSTRAINT_NAME AND C.POSITION = D.POSITION ORDER BY FK_NAME, D.POSITION"
-  0 foreign keys
-Table T3CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT TABLESPACE_NAME FROM ALL_TABLES WHERE OWNER=:"owner" AND TABLE_NAME=:"table_name""
- (created in tablespace DATA01) has
-  4 columns :
-    id (int)CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT ALL_CONSTRAINTS.CONSTRAINT_NAME AS CONSTRAINT_NAME, ALL_CONS_COLUMNS.COLUMN_NAME AS COLUMN_NAME, ALL_INDEXES.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS, ALL_CONS_COLUMNS, ALL_INDEXES WHERE ALL_CONSTRAINTS.OWNER = :"OWNER" AND ALL_CONSTRAINTS.TABLE_NAME = :"TABLE_NAME" AND ALL_CONSTRAINTS.CONSTRAINT_TYPE = 'U' AND ALL_CONS_COLUMNS.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_CONS_COLUMNS.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_INDEXES.OWNER = ALL_CONSTRAINTS.OWNER AND ALL_INDEXES.TABLE_NAME = ALL_CONSTRAINTS.TABLE_NAME AND ALL_CONS_COLUMNS.CONSTRAINT_NAME = ALL_CONSTRAINTS.CONSTRAINT_NAME AND ALL_INDEXES.INDEX_NAME = ALL_CONS_COLUMNS.CONSTRAINT_NAME ORDER BY ALL_CONSTRAINTS.CONSTRAINT_NAME, ALL_CONS_COLUMNS.POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.INDEX_NAME AS INDEX_NAME, A.UNIQUENESS AS UNIQUENESS, A.TABLESPACE_NAME AS TABLESPACE_NAME,  B.COLUMN_NAME AS COLUMN_NAME FROM ALL_INDEXES A, ALL_IND_COLUMNS B WHERE A.OWNER =:"OWNER" AND A.TABLE_NAME =:"TABLE_NAME" AND A.INDEX_NAME = B.INDEX_NAME AND B.INDEX_OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND A.INDEX_NAME NOT IN ( SELECT CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER = A.OWNER AND TABLE_NAME = A.TABLE_NAME AND ( CONSTRAINT_TYPE = 'P' OR CONSTRAINT_TYPE = 'U' ) ) ORDER BY A.INDEX_NAME, B.COLUMN_POSITION"
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT B.COLUMN_NAME AS COLUMN_NAME, C.TABLESPACE_NAME AS TABLESPACE_NAME FROM ALL_CONSTRAINTS A, ALL_CONS_COLUMNS B, ALL_INDEXES C WHERE A.OWNER=:"OWNER" AND A.TABLE_NAME=:"TABLE_NAME" AND A.CONSTRAINT_TYPE = 'P' AND B.OWNER = A.OWNER AND B.TABLE_NAME = A.TABLE_NAME AND B.CONSTRAINT_NAME = A.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = C.INDEX_NAME AND C.OWNER = B.OWNER AND C.TABLE_NAME = B.TABLE_NAME ORDER BY B.POSITION"
- UNIQUE NOT NULL
-    fk1 (int)
-    fk2 (int)
-    Qn (float)
-  Primary key defined for column id in tablespace DATA01
-  0 unique constraints
-  0 indices
-CORAL/RelationalPlugins/oracle: level[Debug] Prepared statement : "SELECT A.CONSTRAINT_NAME AS FK_NAME, B.TABLE_NAME AS REF_TABLE, C.COLUMN_NAME AS FK_COL, D.COLUMN_NAME AS REF_COL FROM (SELECT CONSTRAINT_NAME, R_CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER" AND TABLE_NAME =:"TABLE_NAME" AND CONSTRAINT_TYPE='R') A, (SELECT TABLE_NAME, CONSTRAINT_NAME FROM ALL_CONSTRAINTS WHERE OWNER=:"OWNER") B, (SELECT COLUMN_NAME, CONSTRAINT_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER" AND TABLE_NAME=:"TABLE_NAME" ORDER BY POSITION) C, (SELECT COLUMN_NAME, CONSTRAINT_NAME, TABLE_NAME, POSITION FROM ALL_CONS_COLUMNS WHERE OWNER=:"OWNER") D WHERE A.R_CONSTRAINT_NAME = B.CONSTRAINT_NAME AND A.CONSTRAINT_NAME = C.CONSTRAINT_NAME AND B.CONSTRAINT_NAME = D.CONSTRAINT_NAME AND C.POSITION = D.POSITION ORDER BY FK_NAME, D.POSITION"
-  2 foreign keys:
-    T3_FK1 defined for column fk1 -> T1( id )
-    T3_FK2 defined for column fk2 -> T2( id )
-CORAL/Services/ConnectionService: level[Debug] The valid active connection id=4dcfe0d2-2785-11db-83e9-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the idle list.
-Test completed.
-
-[oval run] ==========================================
-[oval run] result: OK
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/authentication.xml coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/authentication.xml
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/authentication.xml	2006-08-10 12:07:23.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/authentication.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,19 +0,0 @@
-<?xml version="1.0" ?>
-<connectionlist>
-
-<connection name="oracle://devdb10/ral_writer">
-  <parameter name="user" value="ral_writer" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="oracle://devdb10/ral_reader">
-  <parameter name="user" value="ral_reader" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="mysql://pcitdb59.cern.ch/RADO_POOL">
-  <parameter name="user" value="rado_pool" />
-  <parameter name="password" value="rado_pool" />
-</connection>
-   	
-</connectionlist>
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/BuildFile coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/BuildFile
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/BuildFile	2006-08-10 12:07:09.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,3 +0,0 @@
-<use name=RelationalAccess></use>
-<use name=ConnectionService></use>
-<lib name=lcg_coral_ConnectionService></lib>
\ No newline at end of file
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/dblookup.xml coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/dblookup.xml
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/dblookup.xml	2006-08-10 12:07:24.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,27 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-
-  <logicalservice name="/dbdev/service_0">
-  </logicalservice>
-
-  <logicalservice name="/dbdev/service_1">
-    <service name="oracle://devdb10/giacomo" accessMode="update" authentication="password" />
-  </logicalservice>
-
-  <logicalservice name="/dbdev/service_2">
-    <service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-  </logicalservice>
-
-  <logicalservice name="/dbdev/service_3">
-    <service name="oracle://devdb10/giacomo" accessMode="readonly" authentication="password" />
-    <service name="oracle://devdb10/ral_reader" accessMode="readonly" authentication="password" />
-    <service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-    <service name="oracle://devdb10/giacomo" accessMode="update" authentication="password" />
-  </logicalservice>
-
-  <logicalservice name="/dbdev/service_4">
-    <service name="oracle://devdb10/giacomo" accessMode="update" authentication="password" />
-    <service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-  </logicalservice>
-
-</servicelist>
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/OvalFile coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/OvalFile
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/OvalFile	2006-08-10 12:07:13.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_ReplicaHandling_LFCLookupService"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_ConnectionService_ReplicaHandling_LFCLookupService"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/main.cpp coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/main.cpp
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/main.cpp	2006-08-10 12:07:29.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,40 +0,0 @@
-#include "TestApp.h"
-#include "CoralBase/Exception.h"
-#include "SealKernel/Exception.h"
-#include <iostream>
-#include <exception>
-#include <cstdlib>
-
-
-int main( int, char** )
-{
-  try {
-    // Set the authentication path
-    if ( ! ::getenv( "CORAL_AUTH_PATH" ) ) {
-      ::putenv( "CORAL_AUTH_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    }
-    //if ( ! ::getenv( "CORAL_DBLOOKUP_PATH" ) ) {
-    // ::putenv( "CORAL_DBLOOKUP_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    //}
-
-    TestApp app;
-    app.run();
-  }
-  catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,169 +0,0 @@
-#include "TestApp.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/IMessageService.h"
-#include "PluginManager/PluginManager.h"
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "RelationalAccess/ConnectionServiceException.h"
-#include "../../../ConnectionService/src/ConnectionService.h"
-#include "../../../ConnectionService/src/SessionProxy.h"
-#include "../../../ConnectionService/src/ConnectionPool.h"
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp():
-  m_context( new seal::Context ){
-  this->loadServices();
-}
-
-
-TestApp::~TestApp()
-{
-}
-
-
-void
-TestApp::loadServices()
-{
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context.get() );
-
-  // Load the SEAL Message service and set the output threshold to Info
-  loader->load( "SEAL/Services/MessageService" );
-  std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-  m_context->query( v_msgSvc );
-  if ( ! v_msgSvc.empty() ) {
-    seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-    msgSvc->setOutputLevel( seal::Msg::Debug);
-  }
-
-  // Load the Connection Service
-  std::cout << "Loading Connection Service"<<std::endl;
-  loader->load( "CORAL/Services/ConnectionService" );
-  loader->load( "CORAL/Services/LFCLookupService" );
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  std::vector< seal::IHandle<coral::IConnectionService> > v_svc;
-  m_context->query( v_svc );
-  if ( v_svc.empty() ) {
-    throw std::runtime_error( "Could not locate the connection service" );
-  }
-  return v_svc.front();
-}
-
-//
-void TestApp::setupDataSource( const std::string& connectionString){
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-  session->transaction().start();
-  // creates a dummy table to be looked up
-  session->nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session->nominalSchema().createTable( descr );
-  session->transaction().commit();
-  delete session;
-}
-
-void
-TestApp::run(){
-  
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-  theConnectionService->configuration().setConnectionTimeOut(0);
-
-  
-  //setupDataSource("oracle://devdb10/ral_writer");
-  setupDataSource("mysql://pcitdb59.cern.ch/RADO_POOL");
-
-  ::sleep(1);
-  theConnectionService->purgeConnectionPool();
-  
-  try {
-	/*
-    try {
-      std::string connectionString = "service_1";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-	*/
-    try {
-      std::string connectionString = "F1/F2/F3/my_test";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    theConnectionService->configuration().disableReadOnlySessionOnUpdateConnections();
-    try {
-      std::string connectionString = "write_test";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      std::set<std::string> tables = session->nominalSchema().listTables();
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    coral::ISessionProxy* session = 0;
-    std::string connectionString = "service1";  
-    session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-    session->transaction().start( true );
-    std::set<std::string> tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    delete session;
-	/*
-    session = 0;
-    connectionString = "service_3";  
-    session = theConnectionService->connect( connectionString, coral::Update  );
-    session->transaction().start();
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    connectionString = "service_4";  
-    try {
-      session = theConnectionService->connect( connectionString, coral::Update  );
-      session->transaction().start();
-      tables = session->nominalSchema().listTables();
-      session->transaction().commit();
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }  
-	*/
-  }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp_Govi coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp_Govi
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp_Govi	2006-08-10 12:07:28.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.cpp_Govi	1970-01-01 01:00:00.000000000 +0100
@@ -1,164 +0,0 @@
-#include "TestApp.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/IMessageService.h"
-#include "PluginManager/PluginManager.h"
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "RelationalAccess/ConnectionServiceException.h"
-#include "../../../ConnectionService/src/ConnectionService.h"
-#include "../../../ConnectionService/src/SessionProxy.h"
-#include "../../../ConnectionService/src/ConnectionPool.h"
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp():
-  m_context( new seal::Context ){
-  this->loadServices();
-}
-
-
-TestApp::~TestApp()
-{
-  delete m_context;
-}
-
-
-void
-TestApp::loadServices()
-{
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context );
-
-  // Load the SEAL Message service and set the output threshold to Info
-  loader->load( "SEAL/Services/MessageService" );
-  std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-  m_context->query( v_msgSvc );
-  if ( ! v_msgSvc.empty() ) {
-    seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-    msgSvc->setOutputLevel( seal::Msg::Debug);
-  }
-
-  // Load the Connection Service
-  std::cout << "Loading Connection Service"<<std::endl;
-  loader->load( "CORAL/Services/ConnectionService" );
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  std::vector< seal::IHandle<coral::IConnectionService> > v_svc;
-  m_context->query( v_svc );
-  if ( v_svc.empty() ) {
-    throw std::runtime_error( "Could not locate the connection service" );
-  }
-  return v_svc.front();
-}
-
-//
-void TestApp::setupDataSource( const std::string& connectionString){
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-  session->transaction().start();
-  // creates a dummy table to be looked up
-  session->nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session->nominalSchema().createTable( descr );
-  session->transaction().commit();
-  delete session;
-}
-
-void
-TestApp::run(){
-  
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-  theConnectionService->configuration().setConnectionTimeOut(0);
-
-  
-  setupDataSource("oracle://devdb10/ral_writer");
-
-  ::sleep(1);
-  theConnectionService->purgeConnectionPool();
-  
-  try {
-    try {
-      std::string connectionString = "/dbdev/service_0";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    try {
-      std::string connectionString = "/dbdev/service_1";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    theConnectionService->configuration().disableReadOnlySessionOnUpdateConnections();
-    try {
-      std::string connectionString = "/dbdev/service_2";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      std::set<std::string> tables = session->nominalSchema().listTables();
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    coral::ISessionProxy* session = 0;
-    std::string connectionString = "/dbdev/service_3";  
-    session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-    session->transaction().start( true );
-    std::set<std::string> tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    connectionString = "/dbdev/service_3";  
-    session = theConnectionService->connect( connectionString, coral::Update  );
-    session->transaction().start();
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    connectionString = "/dbdev/service_4";  
-    try {
-      session = theConnectionService->connect( connectionString, coral::Update  );
-      session->transaction().start();
-      tables = session->nominalSchema().listTables();
-      session->transaction().commit();
-      delete session;
-    } catch (const coral::ConnectionServiceException& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }  
-  }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.h coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.h
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.h	2006-10-27 15:34:11.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/src/TestApp.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,37 +0,0 @@
-#ifndef INCLUDE_TESTAPP_H
-#define INCLUDE_TESTAPP_H
-
-#include "RelationalAccess/IConnectionService.h"
-#include "SealKernel/Context.h"
-#include <string>
-
-class TestApp
-{
-public:
-  static const std::string OVALTAG;
-  
-  // Constructor
-  TestApp();
-
-  // Destructor
-  ~TestApp();
-
-  // run method
-  void run();
-
-private:
-  // Loads the basic services
-  void loadServices();
-
-  // Returns the connection service handle
-  seal::IHandle<coral::IConnectionService> connectionService();
-
-  //
-  void setupDataSource( const std::string& connectionString);
-  
-private:
-  // The application context
-  seal::Handle<seal::Context> m_context;
-};
-
-#endif
diff -Naur orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/test_Integration_ConnectionService_ReplicaHandling_LFCLookupService.ref coral/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/test_Integration_ConnectionService_ReplicaHandling_LFCLookupService.ref
--- orig.src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/test_Integration_ConnectionService_ReplicaHandling_LFCLookupService.ref	2006-08-10 12:07:24.000000000 +0200
+++ src/Tests/Integration_ConnectionService_ReplicaHandling_LFCLookupService/test_Integration_ConnectionService_ReplicaHandling_LFCLookupService.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,46 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : dpathy
-[oval run] HOST : lxplus009.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: test_Integration_ConnectionService_ReplicaHandling_LFCLookupService
-[oval run] =================================================
-
-Loading Connection Service
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IRelationalService: CORAL/Services/RelationalService
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "frontier" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "mysql" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "oracle" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "sqlite" with native implementation
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "frontier" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "mysql" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "oracle" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "sqlite" is native
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IAuthenticationService: CORAL/Services/XMLAuthenticationService
-CORAL/Services/ConnectionService    Debug No valid connection to oracle://devdb10/ral_writer found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Update connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Update Connection to oracle://devdb10/ral_writer established. Id=128d4fa6-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=128d4fa6-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Update connection to oracle://devdb10/ral_writer has been added in the active list. Id=128d4fa6-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "DROP TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST""
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "CREATE TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST" ( "N_X" NUMBER(10), "N_S" VARCHAR2(4000) )"
-CORAL/Services/ConnectionService    Debug The valid active connection id=128d4fa6-27ac-11db-846e-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=1
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=128d4fa6-27ac-11db-846e-000e0c4d41f8 to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService    Debug No valid connection to reader_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb10/ral_reader
-CORAL/Services/ConnectionService     Info Read-Only Connection to oracle://devdb10/ral_reader established. Id=142762f2-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_reader started for user ral_reader. Id=142762f2-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to oracle://devdb10/ral_reader has been added in the active list. Id=142762f2-27ac-11db-846e-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/Services/ConnectionService    Debug The valid active connection id=142762f2-27ac-11db-846e-000e0c4d41f8 to oracle://devdb10/ral_reader has been moved to the idle list.
-[OVAL]Exception:No physical Read-Only connection for "write_test" is available. ( CORAL : "ConnectionReplicaService::replicasForConnection" from "CORAL/Services/ConnectionService" )
-TEST ERROR: No physical Read-Only connection for "my_test" is available. ( CORAL : "ConnectionReplicaService::replicasForConnection" from "CORAL/Services/ConnectionService" )
-[OVAL] Success
-
-[oval run] ==========================================
-[oval run] result: OK
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/BuildFile coral/Tests/Integration_ConnectionService_SimpleFailover/BuildFile
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/BuildFile	2006-06-19 18:00:08.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,3 +0,0 @@
-<use name=RelationalAccess></use>
-<use name=ConnectionService></use>
-<lib name=lcg_coral_ConnectionService></lib>
\ No newline at end of file
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/integration_connectionservice_simplefailover.qmt coral/Tests/Integration_ConnectionService_SimpleFailover/integration_connectionservice_simplefailover.qmt
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/integration_connectionservice_simplefailover.qmt	2007-03-22 16:15:12.000000000 +0100
+++ src/Tests/Integration_ConnectionService_SimpleFailover/integration_connectionservice_simplefailover.qmt	1970-01-01 01:00:00.000000000 +0100
@@ -1,53 +0,0 @@
-<?xml version="1.0" ?>
-<!DOCTYPE extension  PUBLIC "-//QM/2.3/Extension//EN"  "http://www.codesourcery.com/qm/dtds/2.3/-//qm/2.3/extension//en.dtd">
-
-<extension class="LCG_QMTestExtensions.ShellCommandTest" kind="test">
- <argument name="excluded_lines">
-  <text />
- </argument>
- <argument name="target_group">
-  <text>.*</text>
- </argument>
- <argument name="stderr">
-  <text>*</text>
- </argument>
- <argument name="stdout">
-  <text />
- </argument>
- <argument name="prerequisites">
-  <set />
- </argument>
- <argument name="stdout_ref">
-  <text>test_Integration_ConnectionService_SimpleFailover.ref</text>
- </argument>
- <argument name="stdout_tol">
-  <integer>0</integer>
- </argument>
- <argument name="exit_code">
-  <integer>0</integer>
- </argument>
- <argument name="stdout_tag">
-  <text>[OVAL]</text>
- </argument>
- <argument name="environment">
-  <set />
- </argument>
- <argument name="stdout_ref_path">
-  <text>./</text>
- </argument>
- <argument name="timeout">
-  <integer>-1</integer>
- </argument>
- <argument name="description_test">
-  <text />
- </argument>
- <argument name="command">
-  <text>test_Integration_ConnectionService_SimpleFailover</text>
- </argument>
- <argument name="resources">
-  <set />
- </argument>
- <argument name="stdin">
-  <text />
- </argument>
-</extension>
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/OvalFile coral/Tests/Integration_ConnectionService_SimpleFailover/OvalFile
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/OvalFile	2006-06-19 18:00:08.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_SimpleFailover"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_ConnectionService_SimpleFailover"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/main.cpp coral/Tests/Integration_ConnectionService_SimpleFailover/src/main.cpp
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/main.cpp	2008-03-27 14:37:34.000000000 +0100
+++ src/Tests/Integration_ConnectionService_SimpleFailover/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,39 +0,0 @@
-#include "TestApp.h"
-#include "CoralBase/Exception.h"
-#include <iostream>
-#include <exception>
-#include <cstdlib>
-
-
-int main( int, char** )
-{
-  try {
-    // Set the authentication path
-    if ( ! ::getenv( "CORAL_AUTH_PATH" ) ) {
-      ::putenv( "CORAL_AUTH_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    }
-    if ( ! ::getenv( "CORAL_DBLOOKUP_PATH" ) ) {
-     ::putenv( "CORAL_DBLOOKUP_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    }
-
-    TestApp app;
-    app.run();
-  }
-  catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.cpp coral/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.cpp
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.cpp	2008-03-27 14:45:40.000000000 +0100
+++ src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,111 +0,0 @@
-#include "TestApp.h"
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "../../../ConnectionService/src/ConnectionService.h"
-#include "../../../ConnectionService/src/SessionProxy.h"
-#include "../../../ConnectionService/src/ConnectionPool.h"
-#include <iostream>
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp(){
-}
-
-
-TestApp::~TestApp()
-{
-}
-
-//
-void TestApp::setupDataSource( const std::string& connectionString){
-  coral::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-  session->transaction().start();
-  // creates a dummy table to be looked up
-  session->nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session->nominalSchema().createTable( descr );
-  session->transaction().commit();
-  delete session;
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  coral::Context& ctx = coral::Context::instance();
-  coral::IHandle<coral::IConnectionService> conSvc = ctx.query<coral::IConnectionService>();
-  if ( ! conSvc.isValid() ) {
-    std::string pluginName("CORAL/Services/ConnectionService");
-    ctx.loadComponent( pluginName );
-    conSvc = ctx.query<coral::IConnectionService>();
-  }
-  return conSvc;
-}
-
-void
-TestApp::run(){
-  coral::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService.isValid() ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-  theConnectionService->configuration().setConnectionTimeOut(0);
-  setupDataSource("oracle://lcg_coral_nightly/coral_writer");
-  setupDataSource("sqlite_file:ral.db");
-  ::sleep(1);
-  theConnectionService->purgeConnectionPool();
-
-  try {
-    std::string connectionString("/SimpleFailover/dbdev/service_1");  
-    coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly );
-    session->transaction().start( true );
-    std::set<std::string> tables = session->nominalSchema().listTables();
-    session->transaction().commit();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    std::cout << "Trying to failover on the same db..."<<std::endl;
-    dynamic_cast<coral::ConnectionService::SessionProxy*>(session)->session()->endUserSession();
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session;
-    ::sleep(1);
-    theConnectionService->purgeConnectionPool();
-    connectionString = "/SimpleFailover/dbdev/service_2";  
-    session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session;
- 
-  }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.h coral/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.h
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.h	2008-03-27 14:37:34.000000000 +0100
+++ src/Tests/Integration_ConnectionService_SimpleFailover/src/TestApp.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,31 +0,0 @@
-#ifndef INCLUDE_TESTAPP_H
-#define INCLUDE_TESTAPP_H
-
-#include "RelationalAccess/IConnectionService.h"
-#include "CoralKernel/Context.h"
-#include <string>
-
-class TestApp
-{
-public:
-  static const std::string OVALTAG;
-  
-  // Constructor
-  TestApp();
-
-  // Destructor
-  ~TestApp();
-
-  // run method
-  void run();
-
-private:
-  // Returns the connection service handle
-  coral::IHandle<coral::IConnectionService> connectionService();
-
-  //
-  void setupDataSource( const std::string& connectionString);
-  
-};
-
-#endif
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover/test_Integration_ConnectionService_SimpleFailover.ref coral/Tests/Integration_ConnectionService_SimpleFailover/test_Integration_ConnectionService_SimpleFailover.ref
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover/test_Integration_ConnectionService_SimpleFailover.ref	2006-06-19 18:10:25.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover/test_Integration_ConnectionService_SimpleFailover.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,87 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : govi
-[oval run] HOST : pcitdb24.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: test_Integration_ConnectionService_SimpleFailover
-[oval run] =================================================
-
-Loading Connection Service
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IRelationalService: CORAL/Services/RelationalService
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "frontier" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "mysql" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "oracle" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "sqlite" with native implementation
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "frontier" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "mysql" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "oracle" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "sqlite" is native
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IAuthenticationService: CORAL/Services/XMLAuthenticationService
-CORAL/Services/ConnectionService    Debug No valid connection to oracle://devdb10/ral_writer found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Update connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Update Connection to oracle://devdb10/ral_writer established. Id=9de11794-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=9de11794-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug A new Update connection to oracle://devdb10/ral_writer has been added in the active list. Id=9de11794-ffad-11da-9544-000347cf812f
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "DROP TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST""
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "CREATE TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST" ( "N_X" NUMBER(10), "N_S" VARCHAR2(4000) )"
-CORAL/Services/ConnectionService    Debug The valid active connection id=9de11794-ffad-11da-9544-000347cf812f to oracle://devdb10/ral_writer has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug No valid connection to sqlite_file:ral.db found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Update connection to sqlite_file:ral.db
-CORAL/Services/ConnectionService     Info Update Connection to sqlite_file:ral.db established. Id=9e495de0-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService     Info Session on connection to sqlite_file:ral.db started for user . Id=9e495de0-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug A new Update connection to sqlite_file:ral.db has been added in the active list. Id=9e495de0-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug The valid active connection id=9e495de0-ffad-11da-9544-000347cf812f to sqlite_file:ral.db has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=9de11794-ffad-11da-9544-000347cf812f to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=9e495de0-ffad-11da-9544-000347cf812f to sqlite_file:ral.db has been removed from pool.
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::ILookupService: CORAL/Services/XMLLookupService
-CORAL/Services/ConnectionService    Debug No valid connection to /dbdev/service_1 found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Read-Only Connection to oracle://devdb10/ral_writer established. Id=9eea02f4-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=9eea02f4-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to oracle://devdb10/ral_writer has been added in the active list. Id=9eea02f4-ffad-11da-9544-000347cf812f
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection /dbdev/service_1 was ok.
-Trying to failover on the same db...
-CORAL/Services/ConnectionService    Debug The invalid connection id=9eea02f4-ffad-11da-9544-000347cf812f to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService    Debug No valid connection to /dbdev/service_1 found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Read-Only Connection to oracle://devdb10/ral_writer established. Id=9f12c964-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=9f12c964-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to oracle://devdb10/ral_writer has been added in the active list. Id=9f12c964-ffad-11da-9544-000347cf812f
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection /dbdev/service_1 was ok.
-CORAL/Services/ConnectionService    Debug The valid active connection id=9f12c964-ffad-11da-9544-000347cf812f to oracle://devdb10/ral_writer has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=9f12c964-ffad-11da-9544-000347cf812f to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService  Warning Failure while retrieving credential parameter "user" from authentication service: Connection string "oracle://devdb9/govi" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService  Warning Failure while retrieving credential parameter "password" from authentication service: Connection string "oracle://devdb9/govi" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService    Debug No valid connection to /dbdev/service_2 found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService  Warning Failure while retrieving credential parameter "user" from authentication service: Connection string "oracle://devdb9/govi" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService  Warning Failure while retrieving credential parameter "password" from authentication service: Connection string "oracle://devdb9/govi" is not known to the service ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/XMLAuthenticationService" )
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb9/govi
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/RelationalPlugins/oracle    Error ORA-12154: TNS:could not resolve the connect identifier specified (attaching a server)
-CORAL/Services/ConnectionService  Warning Failure while attempting to connect to oracle://devdb9/govi: The database server could not be reached ( CORAL : "ISession::connect" from "CORAL/RelationalPlugins/oracle" )
-CORAL/Services/ConnectionService  Warning Connection oracle://devdb9/govi is currently unavailable, and will be temporarely excluded from replicas.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to sqlite_file:ral.db
-CORAL/Services/ConnectionService     Info Read-Only Connection to sqlite_file:ral.db established. Id=c3a3dd2c-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService     Info Session on connection to sqlite_file:ral.db started for user . Id=c3a3dd2c-ffad-11da-9544-000347cf812f
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to sqlite_file:ral.db has been added in the active list. Id=c3a3dd2c-ffad-11da-9544-000347cf812f
-[OVAL]Connection /dbdev/service_2 was ok.
-CORAL/Services/ConnectionService    Debug The valid active connection id=c3a3dd2c-ffad-11da-9544-000347cf812f to sqlite_file:ral.db has been moved to the idle list.
-[OVAL] Success
-
-[oval run] ==========================================
-[oval run] result: OK
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/authentication.xml coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/authentication.xml
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/authentication.xml	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/authentication.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,29 +0,0 @@
-<?xml version="1.0" ?>
-<connectionlist>
-
-<connection name="oracle://devdb10/ral_writer">
-  <parameter name="user" value="ral_writer" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="sqlite_file:ral.db">
-  <parameter name="user" value="" />
-  <parameter name="password" value="" />
-</connection>
-
-<connection name="oracle://devdb10/ral_reader">
-  <parameter name="user" value="ral_reader" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="mysql://pcitdb59.cern.ch/ral_writer">
-  <parameter name="user" value="ral_writer" />
-  <parameter name="password" value="ral" />
-</connection>
-
-<connection name="mysql://pcitdb59.cern.ch/GIACOMODB">
-  <parameter name="user" value="giacomo" />
-  <parameter name="password" value="giacomo" />
-</connection>
-
-</connectionlist>
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/BuildFile coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/BuildFile
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/BuildFile	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,3 +0,0 @@
-<use name=RelationalAccess></use>
-<use name=ConnectionService></use>
-<lib name=lcg_coral_ConnectionService></lib>
\ No newline at end of file
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/dblookup.xml coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/dblookup.xml
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/dblookup.xml	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,13 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-
-  <logicalservice name="/dbdev/service_1">
-    <service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-  </logicalservice>
-  
-  <logicalservice name="/dbdev/service_2">
-     <service name="oracle://devdb9/govi" accessMode="update" authentication="password" />
-     <service name="sqlite_file:ral.db" accessMode="update" authentication="password" />
-  </logicalservice>
-
-</servicelist>
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/OvalFile coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/OvalFile
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/OvalFile	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_SimpleFailover_LFCLookupService"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_ConnectionService_SimpleFailover_LFCLookupService"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/ral.db coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/ral.db
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/ral.db	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/ral.db	1970-01-01 01:00:00.000000000 +0100
@@ -1 +0,0 @@
-SQLite format 3   @     	                                                                        { {                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ??tableT_CONNECTION_SERVICE_TESTT_CONNECTION_SERVICE_TESTCREATE TABLE "T_CONNECTION_SERVICE_TEST" ( "N_X" INT ,"N_S" TEXT  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
\ No newline at end of file
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/main.cpp coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/main.cpp
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/main.cpp	2006-08-10 12:10:18.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,40 +0,0 @@
-#include "TestApp.h"
-#include "CoralBase/Exception.h"
-#include "SealKernel/Exception.h"
-#include <iostream>
-#include <exception>
-#include <cstdlib>
-
-
-int main( int, char** )
-{
-  try {
-    // Set the authentication path
-    if ( ! ::getenv( "CORAL_AUTH_PATH" ) ) {
-      ::putenv( "CORAL_AUTH_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    }
-    //if ( ! ::getenv( "CORAL_DBLOOKUP_PATH" ) ) {
-    // ::putenv( "CORAL_DBLOOKUP_PATH=/afs/cern.ch/sw/lcg/app/pool/db" );
-    //}
-
-    TestApp app;
-    app.run();
-  }
-  catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.cpp coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.cpp
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.cpp	2006-10-27 15:34:12.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,137 +0,0 @@
-#include "TestApp.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/IMessageService.h"
-#include "PluginManager/PluginManager.h"
-#include <stdexcept>
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "../../../ConnectionService/src/ConnectionService.h"
-#include "../../../ConnectionService/src/SessionProxy.h"
-#include "../../../ConnectionService/src/ConnectionPool.h"
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp():
-  m_context( new seal::Context ){
-  this->loadServices();
-}
-
-
-TestApp::~TestApp()
-{
-}
-
-//
-void TestApp::setupDataSource( const std::string& connectionString){
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-  session->transaction().start();
-  // creates a dummy table to be looked up
-  session->nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session->nominalSchema().createTable( descr );
-  session->transaction().commit();
-  delete session;
-}
-
-void
-TestApp::loadServices()
-{
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context.get() );
-
-  // Load the SEAL Message service and set the output threshold to Info
-  loader->load( "SEAL/Services/MessageService" );
-  std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-  m_context->query( v_msgSvc );
-  if ( ! v_msgSvc.empty() ) {
-    seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-    msgSvc->setOutputLevel( seal::Msg::Debug);
-  }
-
-  // Load the Connection Service
-  std::cout << "Loading Connection Service"<<std::endl;
-  loader->load( "CORAL/Services/ConnectionService" );
-  loader->load( "CORAL/Services/LFCLookupService" );
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  std::vector< seal::IHandle<coral::IConnectionService> > v_svc;
-  m_context->query( v_svc );
-  if ( v_svc.empty() ) {
-    throw std::runtime_error( "Could not locate the connection service" );
-  }
-  return v_svc.front();
-}
-
-void
-TestApp::run(){
-  
-  
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-  theConnectionService->configuration().setConnectionTimeOut(0);
-  setupDataSource("oracle://devdb10/ral_writer");
-  setupDataSource("sqlite_file:ral.db");
-  ::sleep(1);
-  theConnectionService->purgeConnectionPool();
-
-  try {
-    std::string connectionString("write_test");  
-    coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly );
-    session->transaction().start( true );
-    std::set<std::string> tables = session->nominalSchema().listTables();
-    session->transaction().commit();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    std::cout << "Trying to failover on the same db..."<<std::endl;
-    dynamic_cast<coral::ConnectionService::SessionProxy*>(session)->session()->disconnect();
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session;
-    ::sleep(1);
-    theConnectionService->purgeConnectionPool();
-    connectionString = "service_2";  
-    session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    session->transaction().commit();  
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    delete session;
- 
-  }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.h coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.h
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.h	2006-10-27 15:34:12.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/src/TestApp.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,37 +0,0 @@
-#ifndef INCLUDE_TESTAPP_H
-#define INCLUDE_TESTAPP_H
-
-#include "RelationalAccess/IConnectionService.h"
-#include "SealKernel/Context.h"
-#include <string>
-
-class TestApp
-{
-public:
-  static const std::string OVALTAG;
-  
-  // Constructor
-  TestApp();
-
-  // Destructor
-  ~TestApp();
-
-  // run method
-  void run();
-
-private:
-  // Loads the basic services
-  void loadServices();
-
-  // Returns the connection service handle
-  seal::IHandle<coral::IConnectionService> connectionService();
-
-  //
-  void setupDataSource( const std::string& connectionString);
-  
-private:
-  // The application context
-  seal::Handle<seal::Context> m_context;
-};
-
-#endif
diff -Naur orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/test_Integration_ConnectionService_SimpleFailover_LFCLookupService.ref coral/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/test_Integration_ConnectionService_SimpleFailover_LFCLookupService.ref
--- orig.src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/test_Integration_ConnectionService_SimpleFailover_LFCLookupService.ref	2006-08-10 12:10:17.000000000 +0200
+++ src/Tests/Integration_ConnectionService_SimpleFailover_LFCLookupService/test_Integration_ConnectionService_SimpleFailover_LFCLookupService.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,82 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : dpathy
-[oval run] HOST : lxplus009.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: test_Integration_ConnectionService_SimpleFailover_LFCLookupService
-[oval run] =================================================
-
-Loading Connection Service
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IRelationalService: CORAL/Services/RelationalService
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "frontier" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "mysql" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "oracle" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "sqlite" with native implementation
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "frontier" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "mysql" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "oracle" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "sqlite" is native
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IAuthenticationService: CORAL/Services/XMLAuthenticationService
-CORAL/Services/ConnectionService    Debug No valid connection to oracle://devdb10/ral_writer found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Update connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Update Connection to oracle://devdb10/ral_writer established. Id=6322020a-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=6322020a-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Update connection to oracle://devdb10/ral_writer has been added in the active list. Id=6322020a-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "DROP TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST""
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "CREATE TABLE RAL_WRITER."T_CONNECTION_SERVICE_TEST" ( "N_X" NUMBER(10), "N_S" VARCHAR2(4000) )"
-CORAL/Services/ConnectionService    Debug The valid active connection id=6322020a-27ab-11db-9240-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug No valid connection to sqlite_file:ral.db found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Update connection to sqlite_file:ral.db
-CORAL/Services/ConnectionService     Info Update Connection to sqlite_file:ral.db established. Id=63dc1ca8-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to sqlite_file:ral.db started for user . Id=63dc1ca8-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Update connection to sqlite_file:ral.db has been added in the active list. Id=63dc1ca8-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=1
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=6322020a-27ab-11db-9240-000e0c4d41f8 to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/RelationalPlugins/sqlite    Debug SQLiteStatement::prepare BEGIN
-CORAL/RelationalPlugins/sqlite    Debug SQLiteStatement::prepare SELECT name FROM sqlite_master WHERE type='table' UNION ALL SELECT name FROM sqlite_temp_master WHERE type='table' ORDER BY 1
-CORAL/RelationalPlugins/sqlite    Debug SQLiteStatement::prepare DROP TABLE "T_CONNECTION_SERVICE_TEST"
-CORAL/RelationalPlugins/sqlite    Debug SQLiteStatement::prepare CREATE TABLE "T_CONNECTION_SERVICE_TEST" ( "N_X" INT ,"N_S" TEXT  )
-CORAL/RelationalPlugins/sqlite    Debug SQLiteStatement::prepare COMMIT
-CORAL/Services/ConnectionService    Debug The valid active connection id=63dc1ca8-27ab-11db-9240-000e0c4d41f8 to sqlite_file:ral.db has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=1
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=63dc1ca8-27ab-11db-9240-000e0c4d41f8 to sqlite_file:ral.db has been removed from pool.
-CORAL/Services/ConnectionService    Debug No valid connection to write_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Read-Only Connection to oracle://devdb10/ral_writer established. Id=64f4462e-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=64f4462e-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to oracle://devdb10/ral_writer has been added in the active list. Id=64f4462e-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection write_test was ok.
-Trying to failover on the same db...
-CORAL/Services/ConnectionService    Debug The invalid connection id=64f4462e-27ab-11db-9240-000e0c4d41f8 to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService    Debug No valid connection to write_test found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to oracle://devdb10/ral_writer
-CORAL/Services/ConnectionService     Info Read-Only Connection to oracle://devdb10/ral_writer established. Id=65c0efd0-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService     Info Session on connection to oracle://devdb10/ral_writer started for user ral_writer. Id=65c0efd0-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to oracle://devdb10/ral_writer has been added in the active list. Id=65c0efd0-27ab-11db-9240-000e0c4d41f8
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection write_test was ok.
-CORAL/Services/ConnectionService    Debug The valid active connection id=65c0efd0-27ab-11db-9240-000e0c4d41f8 to oracle://devdb10/ral_writer has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=1
-CORAL/Services/ConnectionService    Debug The timed-out idle connection id=65c0efd0-27ab-11db-9240-000e0c4d41f8 to oracle://devdb10/ral_writer has been removed from pool.
-CORAL/Services/ConnectionService    Debug No valid connection to service_2 found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new Read-Only connection to mysql://pcitdb59.cern.ch/GIACOMODB
-CORAL/RelationalPlugins/mysql    Debug MySQLAccess domain is loading its components
-MySQLAccess::TypeConverter    Debug Initializing MySQL type converter
-CORAL/RelationalPlugins/mysql  Warning Establishing connection with login name failed, user supplied credentials required
-CORAL/Services/ConnectionService     Info Read-Only Connection to mysql://pcitdb59.cern.ch/GIACOMODB established. Id=677cf58a-27ab-11db-9240-000e0c4d41f8
-CORAL/RelationalPlugins/mysql    Debug Starting user session by connecting for: giacomo
-CORAL/Services/ConnectionService     Info Session on connection to mysql://pcitdb59.cern.ch/GIACOMODB started for user giacomo. Id=677cf58a-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug A new Read-Only connection to mysql://pcitdb59.cern.ch/GIACOMODB has been added in the active list. Id=677cf58a-27ab-11db-9240-000e0c4d41f8
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - size=0
-[OVAL]TEST ERROR with connection service_2 table T_CONNECTION_SERVICE_TEST is not found.
-CORAL/Services/ConnectionService    Debug The valid active connection id=677cf58a-27ab-11db-9240-000e0c4d41f8 to mysql://pcitdb59.cern.ch/GIACOMODB has been moved to the idle list.
-[OVAL] Success
-
-[oval run] ==========================================
-[oval run] result: OK
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Integration_LFCReplicaService/BuildFile coral/Tests/Integration_LFCReplicaService/BuildFile
--- orig.src/Tests/Integration_LFCReplicaService/BuildFile	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,4 +0,0 @@
-<use name=RelationalAccess></use>
-<use name=ConnectionService></use>
-<use name=LFCReplicaService></use>
-<lib name=lcg_ConnectionService></lib>
diff -Naur orig.src/Tests/Integration_LFCReplicaService/integration_lfcreplicaservice.qmt coral/Tests/Integration_LFCReplicaService/integration_lfcreplicaservice.qmt
--- orig.src/Tests/Integration_LFCReplicaService/integration_lfcreplicaservice.qmt	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/integration_lfcreplicaservice.qmt	1970-01-01 01:00:00.000000000 +0100
@@ -1,53 +0,0 @@
-<?xml version="1.0" ?>
-<!DOCTYPE extension  PUBLIC "-//QM/2.3/Extension//EN"  "http://www.codesourcery.com/qm/dtds/2.3/-//qm/2.3/extension//en.dtd">
-
-<extension class="LCG_QMTestExtensions.ShellCommandTest" kind="test">
- <argument name="excluded_lines">
-  <text />
- </argument>
- <argument name="target_group">
-  <text>.*</text>
- </argument>
- <argument name="stderr">
-  <text>*</text>
- </argument>
- <argument name="stdout">
-  <text />
- </argument>
- <argument name="prerequisites">
-  <set />
- </argument>
- <argument name="stdout_ref">
-  <text>test_Integration_LFCReplicaService.ref</text>
- </argument>
- <argument name="stdout_tol">
-  <integer>0</integer>
- </argument>
- <argument name="exit_code">
-  <integer>0</integer>
- </argument>
- <argument name="stdout_tag">
-  <text>[OVAL]</text>
- </argument>
- <argument name="environment">
-  <set />
- </argument>
- <argument name="stdout_ref_path">
-  <text>./</text>
- </argument>
- <argument name="timeout">
-  <integer>-1</integer>
- </argument>
- <argument name="description_test">
-  <text />
- </argument>
- <argument name="command">
-  <text>test_Integration_LFCReplicaService</text>
- </argument>
- <argument name="resources">
-  <set />
- </argument>
- <argument name="stdin">
-  <text />
- </argument>
-</extension>
diff -Naur orig.src/Tests/Integration_LFCReplicaService/OvalFile coral/Tests/Integration_LFCReplicaService/OvalFile
--- orig.src/Tests/Integration_LFCReplicaService/OvalFile	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_Integration_ConnectionService_ReplicaHandling"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_ConnectionService_ReplicaHandling"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/Integration_LFCReplicaService/src/main.cpp coral/Tests/Integration_LFCReplicaService/src/main.cpp
--- orig.src/Tests/Integration_LFCReplicaService/src/main.cpp	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,47 +0,0 @@
-#include "TestApp.h"
-#include "CoralBase/Exception.h"
-#include "SealKernel/Exception.h"
-#include <iostream>
-#include <exception>
-#include <cstdlib>
-
-
-int main( int, char** )
-{
-  try {
-    // Set the authentication path
-    if ( ! ::getenv( "CORAL_AUTH_PATH" ) ) {
-      ::putenv( "CORAL_AUTH_PATH=/afs/cern.ch/sw/lcg/app/pool/db/LFCReplicaService" );
-    }
-    if ( ! ::getenv( "CORAL_DBLOOKUP_PATH" ) ) {
-     ::putenv( "CORAL_DBLOOKUP_PATH=/afs/cern.ch/sw/lcg/app/pool/db/LFCReplicaService" );
-    }
-    
-    if ( ! ::getenv( "LFC_HOST" ) ) {
-     ::putenv( "LFC_HOST=lxb1925.cern.ch" );
-    }
-    if ( ! ::getenv( "CORAL_LFC_BASEDIR" ) ) {
-     ::putenv( "CORAL_LFC_BASEDIR=/databasetest" );
-    }
-
-    TestApp app;
-    app.run();
-  }
-  catch ( coral::Exception& e )
-  {
-    std::cerr << "CORAL exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( std::exception& e )
-  {
-    std::cerr << "Standard C++ exception " << e.what() << std::endl;
-    return 1;
-  }
-  catch( ... )
-  {
-    std::cerr << "Unknown exception ..." << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/Integration_LFCReplicaService/src/TestApp.cpp coral/Tests/Integration_LFCReplicaService/src/TestApp.cpp
--- orig.src/Tests/Integration_LFCReplicaService/src/TestApp.cpp	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/src/TestApp.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,228 +0,0 @@
-#include "TestApp.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/IMessageService.h"
-#include "PluginManager/PluginManager.h"
-#include <stdexcept>
-#include "RelationalAccess/ConnectionService.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/TableDescription.h"
-#include "RelationalAccess/ISchema.h"
-#include "RelationalAccess/ITransaction.h"
-#include "CoralBase/Exception.h"
-#include "CoralBase/AttributeSpecification.h"
-#include "RelationalAccess/ISession.h"
-#include "RelationalAccess/ISessionProxy.h"
-#include "RelationalAccess/IConnectionService.h"
-#include "RelationalAccess/IConnectionServiceConfiguration.h"
-#include "RelationalAccess/ConnectionServiceException.h"
-#include "CoralCommon/Utilities.h"
-#include "../../../LFCReplicaService/src/LFCReplicaService.h"
-#include "../../../LFCReplicaService/src/ReplicaSet.h"
-#include "../../../LFCReplicaService/src/XMLReplicaImporter.h"
-
-const std::string TestApp::OVALTAG = "[OVAL]";
-
-TestApp::TestApp():
-  m_context( new seal::Context ){
-  this->loadServices();
-}
-
-
-TestApp::~TestApp()
-{
-}
-
-void
-TestApp::loadServices()
-{
-  seal::PluginManager* pm = seal::PluginManager::get();
-  pm->initialise();
-  seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( m_context.get() );
-
-  // Load the SEAL Message service and set the output threshold to Info
-  loader->load( "SEAL/Services/MessageService" );
-  std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-  m_context->query( v_msgSvc );
-  if ( ! v_msgSvc.empty() ) {
-    seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-    msgSvc->setOutputLevel( seal::Msg::Debug);
-  }
-
-  // Load the Connection Service
-  std::cout << "Loading Connection Service"<<std::endl;
-  loader->load( "CORAL/Services/ConnectionService" );
-}
-
-seal::IHandle<coral::IConnectionService>
-TestApp::connectionService()
-{
-  std::vector< seal::IHandle<coral::IConnectionService> > v_svc;
-  m_context->query( v_svc );
-  if ( v_svc.empty() ) {
-    throw std::runtime_error( "Could not locate the connection service" );
-  }
-  return v_svc.front();
-}
-
-//
-void TestApp::setupDataSource( coral::ISessionProxy& session ){
-  session.transaction().start();
-  // creates a dummy table to be looked up
-  session.nominalSchema().dropIfExistsTable("T_CONNECTION_SERVICE_TEST");
-  coral::TableDescription descr;
-  descr.setName("T_CONNECTION_SERVICE_TEST");
-  descr.insertColumn("N_X",coral::AttributeSpecification::typeNameForType<int>());
-  descr.insertColumn("N_S",coral::AttributeSpecification::typeNameForType<std::string>());
-  session.nominalSchema().createTable( descr );
-  session.transaction().commit();
-  coral::sleepSeconds(1);
-}
-
-void
-TestApp::run(){
-  
-  seal::IHandle<coral::IConnectionService> theConnectionService = connectionService();
-  if(! theConnectionService ){
-    std::cout << "Connection Service not loaded."<<std::endl;
-    return;
-  }
-  //theConnectionService->configuration().disablePoolAutomaticCleanUp();
-  theConnectionService->configuration().setDefaultLookupService("CORAL/Services/LFCReplicaService");
-  theConnectionService->configuration().setDefaultAuthenticationService("CORAL/Services/LFCReplicaService");
-
-  try {
-    // here we non existing conection, just to let the LFCreplicaService to be loaded    
-    try {
-      std::string connectionString = "missing_connection_string";  
-      coral::ISessionProxy* session = theConnectionService->connect( connectionString, coral::ReadOnly  );
-      session->transaction().start( true);
-      session->transaction().commit();  
-      delete session;
-    } catch (const coral::Exception& ex){
-      std::cout << OVALTAG <<"Exception:"<<ex.what()<<std::endl;
-    }
-    seal::Handle<coral::LFCReplicaService::LFCReplicaService> replicaService = m_context->component<coral::LFCReplicaService::LFCReplicaService>("CORAL/Services/LFCReplicaService");
-    if(!replicaService) throw std::runtime_error("The LFC Replica service has not been loaded.");
-    coral::LFCReplicaService::ReplicaFilter filter;
-    try{
-      replicaService->deleteReplicas("/connection_folder/connection0",
-                                     "",
-                                     filter);
-    } catch (coral::Exception& ex){
-      std::cout << "Exception:"<<ex.what()<<std::endl;      
-    }
-    try{
-      replicaService->deleteReplicas("/connection_folder/connection1",
-                                     "",
-                                     filter);
-    } catch (coral::Exception& ex){
-      std::cout << "Exception:"<<ex.what()<<std::endl;      
-    }
-    std::string authenticationFile("/afs/cern.ch/sw/lcg/app/pool/db/LFCReplicaService/authentication.xml");
-    std::string lookupFile("/afs/cern.ch/sw/lcg/app/pool/db/LFCReplicaService/dblookup.xml");
-    coral::LFCReplicaService::XMLReplicaImporter importer(m_context.get(),"coral_replica_manager",lookupFile,authenticationFile);
-    coral::LFCReplicaService::ReplicaSet* replicaSet = importer.getData();
-    if( replicaSet) {
-      replicaService->importReplicas( *replicaSet );
-      delete replicaSet;
-    }
-
-
-    theConnectionService->configuration().disableReadOnlySessionOnUpdateConnections();
-    std::string connectionString = "/connection_folder/connection0";
-    coral::ISessionProxy* session = theConnectionService->connect( connectionString );
-    setupDataSource( *session );
-    session->transaction().start( true);
-    std::set<std::string> tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();
-    delete session;
-    session = 0;
-    connectionString = "/connection_folder/connection0";  
-    session = theConnectionService->connect( connectionString, coral::ReadOnly   );
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    connectionString = "/connection_folder/connection0";
-    std::string role("writer");
-    std::cout << "# Connection with role=\""<<role<<"\""<<std::endl;
-    session = theConnectionService->connect( connectionString, role );
-    session->transaction().start( true );
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    role = "reader";
-    std::cout << "# Connection with role=\""<<role<<"\""<<std::endl;
-    try{
-      session = theConnectionService->connect( connectionString, role );
-      session->transaction().start( true );
-      tables = session->nominalSchema().listTables();
-      session->transaction().commit();  
-      delete session;
-      session = 0;
-    } catch (coral::Exception& e){
-      std::cout << "Connection not established: "<<e.what()<<std::endl;
-    }
-    connectionString = "/connection_folder/connection1";  
-    session = theConnectionService->connect( connectionString, coral::Update  );
-    setupDataSource( *session );
-    session->transaction().start();
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    role = "writer";
-    connectionString = "/connection_folder/connection1";  
-    std::cout << "# Connection with role=\""<<role<<"\""<<std::endl;
-    session = theConnectionService->connect( connectionString, role, coral::Update  );
-    session->transaction().start();
-    tables = session->nominalSchema().listTables();
-    if(tables.find("T_CONNECTION_SERVICE_TEST")==tables.end()){
-      std::cout << OVALTAG <<"TEST ERROR with connection "<<connectionString<<" table T_CONNECTION_SERVICE_TEST is not found."<<std::endl;
-    } else {
-      std::cout << OVALTAG << "Connection "<<connectionString<<" was ok."<<std::endl;
-    }
-    session->transaction().commit();  
-    delete session;
-    session = 0;
-    role = "reader";
-    connectionString = "/connection_folder/connection1";  
-    std::cout << "# Connection with role=\""<<role<<"\""<<std::endl;
-    try{
-      session = theConnectionService->connect( connectionString, role, coral::Update  );
-      session->transaction().start();
-      tables = session->nominalSchema().listTables();
-      session->transaction().commit();  
-      delete session;
-      session = 0;
-    } catch (coral::Exception& e){
-      std::cout << "Connection not established: "<<e.what()<<std::endl;
-    }
- }catch ( const coral::Exception& exc) {
-    std::cout << "TEST ERROR: "<<exc.what()<<std::endl;
-  }
-  
-   
-}
diff -Naur orig.src/Tests/Integration_LFCReplicaService/src/TestApp.h coral/Tests/Integration_LFCReplicaService/src/TestApp.h
--- orig.src/Tests/Integration_LFCReplicaService/src/TestApp.h	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/src/TestApp.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,37 +0,0 @@
-#ifndef INCLUDE_TESTAPP_H
-#define INCLUDE_TESTAPP_H
-
-#include "RelationalAccess/IConnectionService.h"
-#include "SealKernel/Context.h"
-#include <string>
-
-class TestApp
-{
-public:
-  static const std::string OVALTAG;
-  
-  // Constructor
-  TestApp();
-
-  // Destructor
-  ~TestApp();
-
-  // run method
-  void run();
-
-private:
-  // Loads the basic services
-  void loadServices();
-
-  // Returns the connection service handle
-  seal::IHandle<coral::IConnectionService> connectionService();
-
-  //
-  void setupDataSource( coral::ISessionProxy& session);
-  
-private:
-  // The application context
-  seal::Handle<seal::Context> m_context;
-};
-
-#endif
diff -Naur orig.src/Tests/Integration_LFCReplicaService/test_Integration_LFCReplicaService.ref coral/Tests/Integration_LFCReplicaService/test_Integration_LFCReplicaService.ref
--- orig.src/Tests/Integration_LFCReplicaService/test_Integration_LFCReplicaService.ref	2007-04-02 17:11:43.000000000 +0200
+++ src/Tests/Integration_LFCReplicaService/test_Integration_LFCReplicaService.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,189 +0,0 @@
-Loading Connection Service
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::IRelationalService: CORAL/Services/RelationalService
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "frontier" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "mysql" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "oracle" with native implementation
-CORAL/Services/RelationalService     Info Found plugin for RDBMS technology "sqlite" with native implementation
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "frontier" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "mysql" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "oracle" is native
-CORAL/Services/RelationalService     Info Default implementation for RDBMS technology "sqlite" is native
-CORAL/Services/ConnectionService    Debug Looking up read-only replicas for logical connection: "missing_connection_string"
-CORAL/Services/ConnectionService     Info Loading default plugin for coral::ILookupService: CORAL/Services/LFCReplicaService
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "missing_connection_string" with access mode=Read-Only
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Error Logical connection string "/databasetest/missing_connection_string" not found. Closing transaction.
-[OVAL]Exception:Logical connection string is unknown. ( CORAL : "LFCReplicaService::listReplicas" from "CORAL/Services/LFCReplicaService" )
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for logical string="/connection_folder/connection0", role=""
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for file /databasetest/connection_folder/connection0/coral_default_role
-CORAL/Services/LFCReplicaService    Debug Deleting file /databasetest/connection_folder/connection0/coral_default_role from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for file /databasetest/connection_folder/connection0/reader
-CORAL/Services/LFCReplicaService    Debug Deleting file /databasetest/connection_folder/connection0/reader from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for file /databasetest/connection_folder/connection0/writer
-CORAL/Services/LFCReplicaService    Debug Deleting file /databasetest/connection_folder/connection0/writer from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Deleted 5 replicas.
-CORAL/Services/LFCReplicaService    Debug Starting transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Removing folder /databasetest/connection_folder/connection0 from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Delete operation completed.
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for logical string="/connection_folder/connection1", role=""
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for file /databasetest/connection_folder/connection1/coral_default_role
-CORAL/Services/LFCReplicaService    Debug Deleting file /databasetest/connection_folder/connection1/coral_default_role from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Deleting replicas for file /databasetest/connection_folder/connection1/writer
-CORAL/Services/LFCReplicaService    Debug Deleting file /databasetest/connection_folder/connection1/writer from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Deleted 5 replicas.
-CORAL/Services/LFCReplicaService    Debug Starting transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Removing folder /databasetest/connection_folder/connection1 from LFC name server.
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Delete operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection0", role="coral_default_role": pcs="oracle://int5r/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection0", role="coral_default_role": pcs="oracle://int5r/coral_writer".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection0", role="coral_default_role": pcs="sqlite_file:ral.db".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection0", role="reader": pcs="oracle://int5r/coral_writer".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection0", role="writer": pcs="oracle://int5r/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection1", role="coral_default_role": pcs="mysql://itrac424.cern.ch/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection1", role="coral_default_role": pcs="oracle://int5r/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection1", role="coral_default_role": pcs="sqlite_file:ral.db".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection1", role="writer": pcs="mysql://itrac424.cern.ch/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/LFCReplicaService    Debug Adding replica for logical string="/connection_folder/connection1", role="writer": pcs="oracle://int5r/CORAL_WRITER".
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Committing transaction.
-CORAL/Services/LFCReplicaService     Info Add Replica operation completed.
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection0"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection0" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/CORAL_WRITER" in the credential map. Total entries=1
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/CORAL_WRITER" in the credential map. Total entries=1
-CORAL/Services/ConnectionService    Debug No valid connection for string "/connection_folder/connection0" found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new update session on "oracle://int5r/CORAL_WRITER"
-CORAL/Services/ConnectionService    Debug Connection parameters are: Retry-Period=10sec, Retry-Timeout=60sec, Connection-Timeout=300sec.
-CORAL/Services/ConnectionService     Info  Connection to service "int5r" established. Id=278d347c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService     Info New session on connection to service "int5r" started for user "CORAL_WRITER". Connection Id=278d347c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug  A New connection to service "int5r" has been added in the active list. Id=278d347c-e12c-11db-8804-000347cf812f
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "DROP TABLE CORAL_WRITER."T_CONNECTION_SERVICE_TEST""
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "CREATE TABLE CORAL_WRITER."T_CONNECTION_SERVICE_TEST" ( "N_X" NUMBER(10), "N_S" VARCHAR2(4000) )"
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection /connection_folder/connection0 was ok.
-CORAL/Services/ConnectionService    Debug Connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has 0 session(s) opended.
-CORAL/Services/ConnectionService    Debug The active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been removed from the active list.
-CORAL/Services/ConnectionService    Debug The valid active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been moved to the idle list.
-CORAL/Services/ConnectionService    Debug Looking up read-only replicas for logical connection: "/connection_folder/connection0"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection0" with access mode=Read-Only
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - Total=1, Expired=0
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/coral_writer" in the credential map. Total entries=2
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/coral_writer" in the credential map. Total entries=2
-CORAL/Services/ConnectionService     Info New session on connection to service "int5r" started for user "CORAL_WRITER". Connection Id=278d347c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug The idle connection Id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been moved to the active list.
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection /connection_folder/connection0 was ok.
-CORAL/Services/ConnectionService    Debug Connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has 0 session(s) opended.
-CORAL/Services/ConnectionService    Debug The active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been removed from the active list.
-CORAL/Services/ConnectionService    Debug The valid active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been moved to the idle list.
-# Connection with role="writer"
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection0"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection0" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/CORAL_WRITER" in the credential map. Total entries=1
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/CORAL_WRITER" in the credential map. Total entries=1
-CORAL/Services/ConnectionService     Info New session on connection to service "int5r" started for user "CORAL_WRITER". Connection Id=278d347c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug The idle connection Id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been moved to the active list.
-CORAL/RelationalPlugins/oracle    Debug Prepared statement : "SELECT TABLE_NAME FROM ALL_TABLES WHERE OWNER=:"owner""
-[OVAL]Connection /connection_folder/connection0 was ok.
-CORAL/Services/ConnectionService    Debug Connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has 0 session(s) opended.
-CORAL/Services/ConnectionService    Debug The active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been removed from the active list.
-CORAL/Services/ConnectionService    Debug The valid active connection id=278d347c-e12c-11db-8804-000347cf812f to service "int5r" has been moved to the idle list.
-# Connection with role="reader"
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection0"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection0" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "oracle://int5r/CORAL_WRITER" in the credential map. Total entries=1
-CORAL/Services/ConnectionService    Debug Could not retrieve credentials for connection "oracle://int5r/CORAL_WRITER" from authentication service: Role "reader" is not known for connection string "oracle://int5r/CORAL_WRITER" ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/LFCReplicaService" )
-CORAL/Services/ConnectionService  Warning Replica on connection "oracle://int5r/CORAL_WRITER" skipped (no authentication provided).
-Connection not established: No physical Update connection for "/connection_folder/connection0" is available. ( CORAL : "ReplicaCatalogue::replicasForConnection" from "CORAL/Services/ConnectionService" )
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection1"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection1" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-MySQLAccess::TypeConverter    Debug Initializing MySQL type converter
-CORAL/RelationalPlugins/mysql    Debug MySQLAccess domain is loading its components
-CORAL/Services/LFCReplicaService    Debug Searching connection "mysql://itrac424.cern.ch/CORAL_WRITER" in the credential map. Total entries=2
-CORAL/Services/LFCReplicaService    Debug Searching connection "mysql://itrac424.cern.ch/CORAL_WRITER" in the credential map. Total entries=2
-CORAL/Services/ConnectionService    Debug No valid connection for string "/connection_folder/connection1" found in the pool. Creating a new connection.
-CORAL/Services/ConnectionService    Debug Trying to get a new update session on "mysql://itrac424.cern.ch/CORAL_WRITER"
-CORAL/Services/ConnectionService    Debug Connection parameters are: Retry-Period=10sec, Retry-Timeout=60sec, Connection-Timeout=300sec.
-CORAL/RelationalPlugins/mysql  Warning Establishing connection with login name failed, user supplied credentials required
-CORAL/RelationalPlugins/mysql    Debug Connecting to : itrac424.cern.ch
-
-CORAL/Services/ConnectionService     Info  Connection to service "itrac424.cern.ch" established. Id=2f7a640c-e12c-11db-8804-000347cf812f
-CORAL/RelationalPlugins/mysql    Debug Starting user session by connecting to: mysql://itrac424.cern.ch as "CORAL_WRITER"
-CORAL/Services/ConnectionService     Info New session on connection to service "itrac424.cern.ch" started for user "CORAL_WRITER". Connection Id=2f7a640c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug  A New connection to service "itrac424.cern.ch" has been added in the active list. Id=2f7a640c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - Total=1, Expired=0
-CORAL/RelationalPlugins/mysql    Debug Executing: DROP TABLE "CORAL_WRITER"."T_CONNECTION_SERVICE_TEST"
-CORAL/RelationalPlugins/mysql    Debug Table DDL: CREATE TABLE "CORAL_WRITER"."T_CONNECTION_SERVICE_TEST" ("N_X" INTEGER, "N_S" VARCHAR(255) BINARY)
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - Total=1, Expired=0
-[OVAL]Connection /connection_folder/connection1 was ok.
-CORAL/Services/ConnectionService    Debug Connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has 0 session(s) opended.
-CORAL/Services/ConnectionService    Debug The active connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has been removed from the active list.
-CORAL/Services/ConnectionService    Debug The valid active connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has been moved to the idle list.
-# Connection with role="writer"
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection1"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection1" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "mysql://itrac424.cern.ch/CORAL_WRITER" in the credential map. Total entries=2
-CORAL/Services/LFCReplicaService    Debug Searching connection "mysql://itrac424.cern.ch/CORAL_WRITER" in the credential map. Total entries=2
-CORAL/RelationalPlugins/mysql    Debug Starting user session by re-authentication as: CORAL_WRITER
-CORAL/Services/ConnectionService     Info New session on connection to service "itrac424.cern.ch" started for user "CORAL_WRITER". Connection Id=2f7a640c-e12c-11db-8804-000347cf812f
-CORAL/Services/ConnectionService    Debug The idle connection Id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has been moved to the active list.
-CORAL/Services/ConnectionService    Debug Checking idle pool for timed-out connections - Total=1, Expired=0
-[OVAL]Connection /connection_folder/connection1 was ok.
-CORAL/Services/ConnectionService    Debug Connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has 0 session(s) opended.
-CORAL/Services/ConnectionService    Debug The active connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has been removed from the active list.
-CORAL/Services/ConnectionService    Debug The valid active connection id=2f7a640c-e12c-11db-8804-000347cf812f to service "itrac424.cern.ch" has been moved to the idle list.
-# Connection with role="reader"
-CORAL/Services/ConnectionService    Debug Looking up update replicas for logical connection: "/connection_folder/connection1"
-CORAL/Services/LFCReplicaService    Debug Looking up logical string "/connection_folder/connection1" with access mode=Update
-CORAL/Services/LFCReplicaService    Debug Opening transaction on LFC host "lxb1925.cern.ch"
-CORAL/Services/LFCReplicaService    Debug Lookup completed. Closing transaction.
-CORAL/Services/LFCReplicaService    Debug Searching connection "mysql://itrac424.cern.ch/CORAL_WRITER" in the credential map. Total entries=2
-CORAL/Services/ConnectionService    Debug Could not retrieve credentials for connection "mysql://itrac424.cern.ch/CORAL_WRITER" from authentication service: Role "reader" is not known for connection string "mysql://itrac424.cern.ch/CORAL_WRITER" ( CORAL : "IAuthenticationService::credentials" from "CORAL/Services/LFCReplicaService" )
-CORAL/Services/ConnectionService  Warning Replica on connection "mysql://itrac424.cern.ch/CORAL_WRITER" skipped (no authentication provided).
-Connection not established: No physical Update connection for "/connection_folder/connection1" is available. ( CORAL : "ReplicaCatalogue::replicasForConnection" from "CORAL/Services/ConnectionService" )
-[OVAL] Success
diff -Naur orig.src/Tests/Integration_Monitoring/src/main.cpp coral/Tests/Integration_Monitoring/src/main.cpp
--- orig.src/Tests/Integration_Monitoring/src/main.cpp	2008-08-13 18:52:27.000000000 +0200
+++ src/Tests/Integration_Monitoring/src/main.cpp	2008-12-12 14:57:10.000000000 +0100
@@ -10,7 +10,10 @@
 
   TestApp app("MONITORING");
   
-  app.addWriters().addDefault("oracle").add("mysql").add("sqlite");
+  TestEnvWriters& wr01 = app.addWriters().addDefault("oracle").add("mysql").add("sqlite");
+  wr01.readers("oracle").addDefault("oracle").add("coral");
+//  wr01.readers("mysql").addDefault("mysql");  
+//  wr01.readers("sqlite").addDefault("sqlite");  
 
   if(app.check(argc, argv)){   
     
diff -Naur orig.src/Tests/Integration_Monitoring/src/TestApp.cpp coral/Tests/Integration_Monitoring/src/TestApp.cpp
--- orig.src/Tests/Integration_Monitoring/src/TestApp.cpp	2008-10-27 23:20:39.000000000 +0100
+++ src/Tests/Integration_Monitoring/src/TestApp.cpp	2008-12-12 14:57:10.000000000 +0100
@@ -69,11 +69,15 @@
   ///new independent object sw is handling now all connection stuff (seal, noseal version)
   //extract the connection string from the service name
   std::string connectionString = sw.getConnectionString(getServiceName(0));
+ 
+  std::cout << "Try to connect to " << connectionString << std::endl;
   //get the authentication credentials
   const coral::IAuthenticationCredentials& crds = sw.getCredentials(connectionString);
   //get the domain
   std::pair<std::string,std::string> cs = sw.getDomain( connectionString ).decodeUserConnectionString( connectionString );
   //create a new connection
+  std::cout << "Credentials: " << cs.first << ", " << cs.second << std::endl;
+  
   std::auto_ptr<coral::IConnection> connection( sw.getDomain( connectionString ).newConnection( cs.first ) );
 
   connection->connect();
diff -Naur orig.src/Tests/LFCLookup_Performance_Test/BuildFile coral/Tests/LFCLookup_Performance_Test/BuildFile
--- orig.src/Tests/LFCLookup_Performance_Test/BuildFile	2006-09-04 15:35:29.000000000 +0200
+++ src/Tests/LFCLookup_Performance_Test/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-<use name=CoralCommon></use>
-<external ref=xerces-c ></external>
-<use name=RelationalAccess></use>
-<use name=LFCLookupService></use>
-<use name=XMLLookupService></use>
-
-<External ref=lfc></External>
-
-<external ref=boost>
-
-ifneq (,$(findstring win32, $(SCRAM_ARCH)))
-        lib += boost_thread-vc71-mt
-endif
-ifneq (,$(findstring gcc, $(SCRAM_ARCH)))
-        lib += boost_thread-gcc-mt
-endif
-
diff -Naur orig.src/Tests/LFCLookup_Performance_Test/dblookup.xml coral/Tests/LFCLookup_Performance_Test/dblookup.xml
--- orig.src/Tests/LFCLookup_Performance_Test/dblookup.xml	2006-09-04 15:35:29.000000000 +0200
+++ src/Tests/LFCLookup_Performance_Test/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,98 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-
-<logicalservice name="F1/F2/F3/F4/F5/F6/F7/F8/F9/Service1">
-<service name="oracle://FolderTest9/Service9_1" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/F5/F6/F7/F8/Service8">
-<service name="oracle://F8/Replica8" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/F5/F6/F7/Service7">
-<service name="oracle://F7/Replica7" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/F5/F6/Service6">
-<service name="oracle://FolderTest6/Service6_1" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/F5/Service5">
-<service name="oracle://FolderTest5/Service5_1" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/F5/Service5_5">
-<service name="oracle://devdb10/giacomo" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/F4/Service4">
-<service name="oracle://F4/Replica4" accessMode="readonly" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/Service3">
-<service name="oracle://F3/Replica3" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="F1/F2/F3/my_test">
-<service name="mysql://pcitdb59.cern.ch/RADO_POOL" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="F1/F2/Service2">
-<service name="oracle://F2/Replica2" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="F1/Service1">
-<service name="oracle://FolderTest1/Service1_1" accessMode="readonly" authentication="password" />
-<service name="oracle://FolderTest1/Service1_2" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="my_conn">
-<service name="oracle://blabla" accessMode="readonly" authentication="password" />
-</logicalservice>
-
-<logicalservice name="my_conn3">
-<service name="mysql://xxxx" accessMode="readonly" authentication="password" />
-</logicalservice>
-
-<logicalservice name="my_role::my_db">
-<service name="oracle://blabla::the_user" accessMode="update" authentication="the_password" />
-</logicalservice>
-
-<logicalservice name="myservice1">
-<service name="oracle://host1/schema1_1" accessMode="update" authentication="password" />
-<service name="oracle://host1/schema1_2" accessMode="readonly" authentication="password" />
-<service name="oracle://host1/schema1_3" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="myservice2">
-<service name="oracle://host1/schema2_1" accessMode="readonly" authentication="password" />
-<service name="oracle://host1/schema2_2" accessMode="readonly" authentication="certificate" />
-<service name="oracle://host1/schema2_3" accessMode="update" authentication="certificate" />
-</logicalservice>
-
-<logicalservice name="reader_test">
-<service name="oracle://devdb10/ral_reader" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="service1">
-<service name="oracle:/myserver/myschema" accessMode="update" authentication="password" />
-<service name="oracle:/myserver/myschema1" accessMode="readonly" authentication="kerberos" />
-</logicalservice>
-
-<logicalservice name="service4">
-<service name="oracle://test1/test2" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="service_2">
-<service name="mysql://pcitdb59.cern.ch/GIACOMODB" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="sql_test">
-<service name="sqlite_file:yulia.db" accessMode="update" authentication="password" />
-</logicalservice>
-
-<logicalservice name="write_test">
-<service name="oracle://devdb10/ral_writer" accessMode="update" authentication="password" />
-</logicalservice>
-
-</servicelist>
diff -Naur orig.src/Tests/LFCLookup_Performance_Test/LFCLookupPython.py coral/Tests/LFCLookup_Performance_Test/LFCLookupPython.py
--- orig.src/Tests/LFCLookup_Performance_Test/LFCLookupPython.py	2006-09-04 15:35:29.000000000 +0200
+++ src/Tests/LFCLookup_Performance_Test/LFCLookupPython.py	1970-01-01 01:00:00.000000000 +0100
@@ -1,64 +0,0 @@
-import threading
-import commands
-import string
-import sys
-import time
-
-total = 0
-
-class LFCLookupThread(threading.Thread):
-  def __init__( self, name ):
-    threading.Thread.__init__( self, name=name )
-    self.__timePerQuery = []
-    return
-
-  def run( self ):
-    cmd = 'test_LFCLookup_Performance_Test 50'
-   # cmd = 'eval `scram runtime -csh`;'
-   # cmd = cmd + 'setenv LFC_HOST=lxb1925.cern.ch;'
-   # cmd = cmd + 'test_LFCLookupService_Thread'
-    for i in range( 1 ):
-      ret = commands.getstatusoutput( cmd )
-      if ret[0] != 0:
-        print self.getName() + ' failed at i = ' + str(i)
-        fe = open( self.getName() + '.err','a+')
-        fe.write( ret[1] )
-        fe.write( '\n' )
-        fe.close()
-        return 
-      output = string.split( ret[1], '\n' )
-      for line in output:
-        index = string.find( line, 'Time taken ::' )
-        if index >= 0:
-          infos = string.split( line[index + len('Time taken :: '):] )
-          f = open( self.getName() + '.txt','a+')
-          for info in infos:
-            f.write( info + ' ' )
-          f.write('\n')
-          f.close()
-          print infos
-
-  def times( self ):
-    result = self.__timePerQuery
-    return result
-
-
-if __name__ == '__main__':
-  
-  # Create the threads
-  t = []
-  for i in range(int(sys.argv[3])):
-    t.append( LFCLookupThread( sys.argv[1] + '/R_' + sys.argv[2] + '_t_' + str(i) ) )
-
-  for ti in t:
-    print 'Starting ' + ti.getName()
-    ti.start()
-    time.sleep(5)
-    print '...Running'
-
-  for ti in t:
-    while ti.isAlive(): time.sleep(1);
-    print ti.getName() + ' done'
-
-
-
diff -Naur orig.src/Tests/LFCLookup_Performance_Test/OvalFile coral/Tests/LFCLookup_Performance_Test/OvalFile
--- orig.src/Tests/LFCLookup_Performance_Test/OvalFile	2006-09-04 15:35:29.000000000 +0200
+++ src/Tests/LFCLookup_Performance_Test/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_LFCLookup_Performance_Test"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_LFCLookup_Performance_Test"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/LFCLookup_Performance_Test/src/main.cpp coral/Tests/LFCLookup_Performance_Test/src/main.cpp
--- orig.src/Tests/LFCLookup_Performance_Test/src/main.cpp	2006-09-04 15:35:30.000000000 +0200
+++ src/Tests/LFCLookup_Performance_Test/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,170 +0,0 @@
-#include <iostream>
-#include <stdlib.h>
-#include <string.h>
-#include <sstream>
-#include <stdexcept>
-#include <sys/time.h>
-#include "PluginManager/PluginManager.h"
-#include "SealBase/Time.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/Context.h"
-#include "SealKernel/Service.h"
-#include "SealKernel/PropertyManager.h"
-#include "SealKernel/IMessageService.h"
-#include "RelationalAccess/ILookupService.h"
-#include "RelationalAccess/IDatabaseServiceSet.h"
-#include "RelationalAccess/IDatabaseServiceDescription.h"
-
-// Wallclock time in seconds
-time_t startWallClockTimeLFC, endWallClockTimeLFC, startWallClockTimeXML, endWallClockTimeXML;
-
-void reportReplica( const coral::IDatabaseServiceDescription& replica,
-                    const std::string& logicalName )
-{
-  std::cout << logicalName << " : "
-            << replica.connectionString() << ", "
-            << replica.authenticationMechanism() << ", "
-            << ( ( replica.accessMode() == coral::ReadOnly ) ? std::string("Read-Only") : std::string("Update") )
-            << std::endl;
-}
-
-
-int XMLLookupThread(int lookupCount)
-{
- try {
-
-    int numberOfReplicas=0;	
-    seal::PluginManager* pm = seal::PluginManager::get();
-    pm->initialise();
-
-    seal::Handle< seal::Context > context = new seal::Context();
-    seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( context.get() );
-
-    loader->load( "CORAL/Services/XMLLookupService" );
-
-    seal::IHandle<seal::Service> svc = context->query<seal::Service>( "CORAL/Services/XMLLookupService" );
-
-    seal::Handle<seal::PropertyManager>& pmgr = svc->propertyManager();
-    seal::PropertyBase* property = pmgr->property( "LookupFile" );
-    property->set( std::string( "dblookup.xml" ) );
-
-    std::vector< seal::IHandle<coral::ILookupService> > v_lookupSvc;
-    context->query( v_lookupSvc );
-
-    if ( ! v_lookupSvc.empty() )
-    {
-      const coral::ILookupService& lookupSvc = *( v_lookupSvc.front() );
-
-	//std::cout<<"Performs the XMLLookupService test"<<std::endl;
-
-	startWallClockTimeXML=time(NULL);
-
-	//seal::Time start = seal::Time::current();
-
-	for (int count=0; count < lookupCount; count++)
-	{
-      coral::IDatabaseServiceSet* dbSet = lookupSvc.lookup( "myservice1" );
-      numberOfReplicas = dbSet->numberOfReplicas();
-       }
-
-	//seal::Time end = seal::Time::current();
-
-	endWallClockTimeXML=time(NULL);
-
-	printf("Time taken :: %ld seconds\n",(long)(endWallClockTimeXML - startWallClockTimeXML));   
-
-    }
-    else {
-      throw std::runtime_error("Could not retrieve an lookup service.");
-    }
- }
-  catch ( std::exception& e ) {
-    std::cerr << "Standard C++ exception : " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( ... ) {
-    std::cerr << "Exception caught (...)" << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
-
-int LFCLookupThread(int lookupCount)
-{
-  try {
-	
-
-    int numberOfReplicas = 0;
-    seal::PluginManager* pm = seal::PluginManager::get();
-    pm->initialise();
-
-    seal::Handle< seal::Context > context = new seal::Context();
-    seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( context.get() );
-
-   // Load the SEAL Message service and set the output threshold to Debug
-   loader->load( "SEAL/Services/MessageService" );
-   std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-   context->query( v_msgSvc );
-   if ( ! v_msgSvc.empty() ) {
-     seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-     msgSvc->setOutputLevel( seal::Msg::Debug);
-   }
-	
-	
-// Code for Seal Message Service
-    loader->load( "CORAL/Services/LFCLookupService" );
-
-    seal::IHandle<seal::Service> svc = context->query<seal::Service>( "CORAL/Services/LFCLookupService" );
-
-    std::vector< seal::IHandle<coral::ILookupService> > v_lookupSvc;
-    context->query( v_lookupSvc );
-    if ( ! v_lookupSvc.empty() ) {
-    	const coral::ILookupService& lookupSvc = *( v_lookupSvc.front() );
-
-	//std::cout<<"Performs the LFCLookupService test"<<std::endl;
-
-	startWallClockTimeLFC=time(NULL);
-	
-	//seal::Time start = seal::Time::current();
-
-       coral::IDatabaseServiceSet* dbSet;
-
-	std::cout<<" For = "<<lookupCount<<" lookups "<<std::endl;
-	for (int count=0; count < lookupCount; count++)
-	{
-
-       dbSet = lookupSvc.lookup( "write_test");
-       //dbSet = lookupSvc.lookup( "F1/Service1");
-       numberOfReplicas = dbSet->numberOfReplicas();
-	}
-	
-	//seal::Time end = seal::Time::current();
-
-	endWallClockTimeLFC=time(NULL);
-
-	printf("Time taken :: %ld seconds\n",(long)(endWallClockTimeLFC - startWallClockTimeLFC));   
-    }
-    else {
-      throw std::runtime_error("Could not retrieve an lookup service.");
-    }
-  }
-  catch ( std::exception& e ) {
-    std::cerr << "Standard C++ exception : " << e.what() << std::endl;
-    return -1;
-  }
-  catch ( ... ) {
-    std::cerr << "Exception caught (...)" << std::endl;
-    return -1;
-  }
-  return 0;
-}
-
-int main(int argc, char **argv)
-{
-	argc=1;
-
-	//XMLLookupThread(atoi(argv[1]));
-
-	LFCLookupThread(atoi(argv[1]));
-}
diff -Naur orig.src/Tests/Libraries/TestEnv/src/TestEnv.cpp coral/Tests/Libraries/TestEnv/src/TestEnv.cpp
--- orig.src/Tests/Libraries/TestEnv/src/TestEnv.cpp	2008-10-27 23:20:40.000000000 +0100
+++ src/Tests/Libraries/TestEnv/src/TestEnv.cpp	2008-11-19 11:57:12.000000000 +0100
@@ -26,11 +26,15 @@
   platformMatrix.insert(TStrStrPair("slc4_amd64_gcc34_dbg", "A1"));
   platformMatrix.insert(TStrStrPair("slc4_amd64_gcc41", "A2"));
   platformMatrix.insert(TStrStrPair("slc4_amd64_gcc41_dbg", "A3"));
+  platformMatrix.insert(TStrStrPair("slc4_amd64_gcc43", "A4"));
+  platformMatrix.insert(TStrStrPair("slc4_amd64_gcc43_dbg", "A5"));
   //intel 32bit
   platformMatrix.insert(TStrStrPair("slc4_ia32_gcc34", "B0"));
   platformMatrix.insert(TStrStrPair("slc4_ia32_gcc34_dbg", "B1"));
   platformMatrix.insert(TStrStrPair("slc4_ia32_gcc41", "B2"));
   platformMatrix.insert(TStrStrPair("slc4_ia32_gcc41_dbg", "B3"));
+  platformMatrix.insert(TStrStrPair("slc4_ia32_gcc43", "B4"));
+  platformMatrix.insert(TStrStrPair("slc4_ia32_gcc43_dbg", "B5"));
   //macosx for intel
   platformMatrix.insert(TStrStrPair("osx104_ia32_gcc401", "C0"));
   platformMatrix.insert(TStrStrPair("osx104_ia32_gcc401_dbg", "C1"));
@@ -40,7 +44,19 @@
   
   platformMatrix.insert(TStrStrPair("win32_vc71", "D0"));
   platformMatrix.insert(TStrStrPair("win32_vc71_dbg", "D1"));
-
+  //new platforms
+  platformMatrix.insert(TStrStrPair("i686-slc5-gcc34-opt", "E0"));
+  platformMatrix.insert(TStrStrPair("i686-slc5-gcc34-dbg", "E1"));
+  platformMatrix.insert(TStrStrPair("i686-slc5-gcc43-opt", "E2"));
+  platformMatrix.insert(TStrStrPair("i686-slc5-gcc43-dbg", "E3"));
+  
+  platformMatrix.insert(TStrStrPair("x86_64-slc5-gcc34-opt", "F0"));
+  platformMatrix.insert(TStrStrPair("x86_64-slc5-gcc34-dbg", "F1"));
+  platformMatrix.insert(TStrStrPair("x86_64-slc5-gcc43-opt", "F2"));
+  platformMatrix.insert(TStrStrPair("x86_64-slc5-gcc43-dbg", "F3"));
+  
+  platformMatrix.insert(TStrStrPair("i686-winxp-vc9-dbg", "G0"));
+  
   std::map<std::string, std::string> slotMatrix;
   
   slotMatrix.insert(TStrStrPair("dev", "A"));
@@ -201,8 +217,8 @@
   return m_services.size() - 1;
 }
 
-std::string
-TestEnv::getServiceName(size_t index, bool reader)
+const std::string
+TestEnv::getServiceName(size_t index, bool reader) const
 {
   if( index >= m_services.size() ) throw coral::Exception( "TestEnv", "Index out of range", "TestEnv::getServiceName" );
   if( reader == TESTENV_READER ){
@@ -212,15 +228,15 @@
   }
 }
 
-std::string&
-TestEnv::getTableString(std::string& source, const std::string& tableName)
+const std::string&
+TestEnv::getTableString(std::string& source, const std::string& tableName) const
 {
   source = m_slotPrefix + m_platformPrefix + "_" + m_testName + "_" + tableName;
   return source;
 }
 
-std::string
-TestEnv::getDBType(size_t pos, bool reader)
+const std::string
+TestEnv::getDBType(size_t pos, bool reader) const
 {
   if( reader == TESTENV_READER ){
     return m_writers[pos]->readers(m_writers[pos]->getCurrentName()).getCurrentName();
diff -Naur orig.src/Tests/Libraries/TestEnv/src/TestEnvReaders.cpp coral/Tests/Libraries/TestEnv/src/TestEnvReaders.cpp
--- orig.src/Tests/Libraries/TestEnv/src/TestEnvReaders.cpp	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Libraries/TestEnv/src/TestEnvReaders.cpp	2008-12-12 14:57:10.000000000 +0100
@@ -69,7 +69,6 @@
 std::string&
 TestEnvReaders::getCurrentName()
 {
-  if( m_current.empty() ) setCurrentName("");
   return m_current;
 }
 
diff -Naur orig.src/Tests/Libraries/TestEnv/src/TestEnvWriters.cpp coral/Tests/Libraries/TestEnv/src/TestEnvWriters.cpp
--- orig.src/Tests/Libraries/TestEnv/src/TestEnvWriters.cpp	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Libraries/TestEnv/src/TestEnvWriters.cpp	2008-12-12 14:57:10.000000000 +0100
@@ -40,7 +40,6 @@
 TestEnvWriters::setCurrentName(const std::string name)
 {
   std::map<std::string, TestEnvReaders*>::iterator i(m_backends.begin());
-  m_current = i->first;
   for( ; i != m_backends.end(); i++ ){
     if( i->first.compare(name) == 0){
       m_current = i->first;
@@ -53,7 +52,12 @@
 std::string&
 TestEnvWriters::getCurrentName()
 {
-  if( m_current.empty() ) setCurrentName("");
+  if( m_current.empty() ){
+    //it means we have no default backend
+    //take the first element instead
+    std::map<std::string, TestEnvReaders*>::iterator i(m_backends.begin());
+    m_current = i->first;
+  }
   return m_current;
 }
 
diff -Naur orig.src/Tests/Libraries/TestEnv/src/Testing.cpp coral/Tests/Libraries/TestEnv/src/Testing.cpp
--- orig.src/Tests/Libraries/TestEnv/src/Testing.cpp	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Libraries/TestEnv/src/Testing.cpp	2008-11-13 18:41:52.000000000 +0100
@@ -4,9 +4,9 @@
 #include <cmath>
 
 Testing::Testing(TestEnv * env)
-  : m_rowBuffer( 0 )
+  : _env(*env)
+  , m_rowBuffer( 0 )
 {
-  this->env = env;
   //set default table names
   env->getTableString(T1, "T1");
   env->getTableString(T2, "T2");  
@@ -22,18 +22,23 @@
 
   
 void 
-Testing::createSession(int index, bool reader)
+Testing::createSession(int index, bool reader, bool sharing)
 {
   deleteSession();
-  createSession(index, coral::Update, reader);
+  createSession(index, coral::Update, reader, sharing);
 }
 
-void 
-Testing::createSession(int index, coral::AccessMode mode, bool reader)
+void
+Testing::createSession(int index, coral::AccessMode mode, bool reader, bool sharing)
 {
   deleteSession();
   coral::ConnectionService * connService = new coral::ConnectionService();
-  std::string serviceName = env->getServiceName(index, reader);
+  if(!sharing){
+    coral::IConnectionServiceConfiguration& config = connService->configuration();
+    config.disableConnectionSharing();
+  }
+  
+  std::string serviceName = _env.getServiceName(index, reader);
 
   session = connService->connect( serviceName, mode );
   if ( ! session )
diff -Naur orig.src/Tests/Libraries/TestEnv/TestEnv/TestEnv.h coral/Tests/Libraries/TestEnv/TestEnv/TestEnv.h
--- orig.src/Tests/Libraries/TestEnv/TestEnv/TestEnv.h	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Libraries/TestEnv/TestEnv/TestEnv.h	2008-11-13 18:41:52.000000000 +0100
@@ -43,11 +43,11 @@
     //set a service name
     size_t addServiceName(size_t pos, const std::string writerexp, const std::string readerexp = "");
     //get the service name using the index
-    std::string getServiceName(size_t index, bool reader = TESTENV_WRITER);
+    const std::string getServiceName(size_t index, bool reader = TESTENV_WRITER) const;
     //get the backend
-    std::string getDBType(size_t pos, bool reader = TESTENV_WRITER);
+    const std::string getDBType(size_t pos, bool reader = TESTENV_WRITER) const;
     //get table name
-    std::string& getTableString(std::string& source, const std::string& tableName);
+    const std::string& getTableString(std::string& source, const std::string& tableName) const;
 
 private:
     void setupUserInput(int argc, char * argv[]);
diff -Naur orig.src/Tests/Libraries/TestEnv/TestEnv/Testing.h coral/Tests/Libraries/TestEnv/TestEnv/Testing.h
--- orig.src/Tests/Libraries/TestEnv/TestEnv/Testing.h	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Libraries/TestEnv/TestEnv/Testing.h	2008-11-13 18:41:52.000000000 +0100
@@ -22,9 +22,9 @@
     //destructor
     ~Testing();
     //create a session with coral::update mode
-    void createSession(int index, bool reader = TESTENV_WRITER);
+    void createSession(int index, bool reader = TESTENV_WRITER, bool sharing = true);
     //create a session with custom mode
-    void createSession(int index, coral::AccessMode mode, bool reader = TESTENV_WRITER);
+    void createSession(int index, coral::AccessMode mode, bool reader = TESTENV_WRITER, bool sharing = true);
     //create a session with a handle
 //    void createSession(int index, coral::IHandle<coral::IConnectionService> handle, coral::AccessMode mode);
     //delete all
@@ -53,7 +53,7 @@
 
 protected:
     //test environment
-    TestEnv * env;
+    const TestEnv& _env;
     //default tables and views    
     std::string T1;
     std::string T2;
diff -Naur orig.src/Tests/LookupService_TimeComparison/BuildFile coral/Tests/LookupService_TimeComparison/BuildFile
--- orig.src/Tests/LookupService_TimeComparison/BuildFile	2006-08-10 12:12:12.000000000 +0200
+++ src/Tests/LookupService_TimeComparison/BuildFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,7 +0,0 @@
-<use name=CoralCommon></use>
-<external ref=xerces-c ></external>
-<use name=RelationalAccess></use>
-<use name=LFCLookupService></use>
-<use name=XMLLookupService></use>
-
-<External ref=lfc></External>
diff -Naur orig.src/Tests/LookupService_TimeComparison/dblookup.xml coral/Tests/LookupService_TimeComparison/dblookup.xml
--- orig.src/Tests/LookupService_TimeComparison/dblookup.xml	2006-08-10 12:12:12.000000000 +0200
+++ src/Tests/LookupService_TimeComparison/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,16 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-
-  <logicalservice name="myservice1">
-    <service name="oracle://host1/schema1" accessMode="update" authentication="password" />
-    <service name="oracle://host2/schema1" accessMode="readonly" authentication="password" />
-    <service name="oracle://host3/schema1" accessMode="update" authentication="certificate" />
-  </logicalservice>
-
-  <logicalservice name="myservice2">
-    <service name="oracle://host1/schema2" accessMode="readonly" authentication="password certificate" />
-    <service name="oracle://host2/schema2" accessMode="readonly" authentication="certificate" />
-    <service name="oracle://host3/schema2" accessMode="update" authentication="certificate password" />
-  </logicalservice>
-
-</servicelist>
diff -Naur orig.src/Tests/LookupService_TimeComparison/OvalFile coral/Tests/LookupService_TimeComparison/OvalFile
--- orig.src/Tests/LookupService_TimeComparison/OvalFile	2006-08-10 12:12:12.000000000 +0200
+++ src/Tests/LookupService_TimeComparison/OvalFile	1970-01-01 01:00:00.000000000 +0100
@@ -1,41 +0,0 @@
-=================================================
-================================================= 
-OvalFile: basic configuration file to run OVAL
-           validation and regression tool and/or:` 
-           CppUnit unit-test tool 
-           PyUnit unit-test tool 
-
-SPI project ->
-Software Development Infrastructure LCG project 
-=================================================
-=================================================
-
-
-=================================================
- Error report concerning these tests will be send
- to the following e-mail if -w option is used
- Write here your e-mail and uncomment the line.
-=================================================
-<!watcher mail=name@cern.ch>
-
-=================================================
- Standard OVAL environment to run test programs
-=================================================
- For the diff command,define single lines to
- compare, through a Perl regular expression. Oval
- will find lines with "OVAL", but can be changed.
-<diffline expr="^\[OVAL">
-
-
- Here we define a new environment
-<environment name=StandardOval-0>
-
-# This will run the pure Oval tests or Cppunit tests
-<executable name="test_LookupService_TimeComparison"> Oval test</executable>
-
-# To run Valgrind 
-<!script name="ovalgrind" args="test_LookupService_TimeComparison"></script>
-
-</environment>
-
-
diff -Naur orig.src/Tests/LookupService_TimeComparison/src/main.cpp coral/Tests/LookupService_TimeComparison/src/main.cpp
--- orig.src/Tests/LookupService_TimeComparison/src/main.cpp	2006-08-10 12:12:12.000000000 +0200
+++ src/Tests/LookupService_TimeComparison/src/main.cpp	1970-01-01 01:00:00.000000000 +0100
@@ -1,165 +0,0 @@
-#include <iostream>
-#include <sstream>
-#include <stdexcept>
-#include <time.h>
-#include "PluginManager/PluginManager.h"
-#include "SealKernel/ComponentLoader.h"
-#include "SealKernel/Context.h"
-#include "SealKernel/Service.h"
-#include "SealKernel/PropertyManager.h"
-#include "SealKernel/IMessageService.h"
-#include "RelationalAccess/ILookupService.h"
-#include "RelationalAccess/IDatabaseServiceSet.h"
-#include "RelationalAccess/IDatabaseServiceDescription.h"
-
-
-void reportReplica( const coral::IDatabaseServiceDescription& replica,
-                    const std::string& logicalName )
-{
-  std::cout << logicalName << " : "
-            << replica.connectionString() << ", "
-            << replica.authenticationMechanism() << ", "
-            << ( ( replica.accessMode() == coral::ReadOnly ) ? std::string("Read-Only") : std::string("Update") )
-            << std::endl;
-}
-
-
-int main( int, char** )
-{
-	clock_t startClock, endClock;
-	double elapsedTime;
- try {
-	int numberOfReplicas=0;	
-    seal::PluginManager* pm = seal::PluginManager::get();
-    pm->initialise();
-
-    seal::Handle< seal::Context > context = new seal::Context();
-    seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( context.get() );
-
-    loader->load( "CORAL/Services/XMLLookupService" );
-
-    seal::IHandle<seal::Service> svc = context->query<seal::Service>( "CORAL/Services/XMLLookupService" );
-
-    seal::Handle<seal::PropertyManager>& pmgr = svc->propertyManager();
-    seal::PropertyBase* property = pmgr->property( "LookupFile" );
-    property->set( std::string( "dblookup.xml" ) );
-
-    std::vector< seal::IHandle<coral::ILookupService> > v_lookupSvc;
-    context->query( v_lookupSvc );
-
-    if ( ! v_lookupSvc.empty() )
-    {
-      const coral::ILookupService& lookupSvc = *( v_lookupSvc.front() );
-
-	std::cout<<"Performs the XMLLookupService test"<<std::endl;
-
-	startClock = clock();
-      coral::IDatabaseServiceSet* dbSet = lookupSvc.lookup( "myservice1" );
-      numberOfReplicas = dbSet->numberOfReplicas();
-      if ( numberOfReplicas != 2 ) {
-        delete dbSet;
-        throw std::runtime_error( "Unexpected number of replicas retrieved" );
-      }
-      for ( int i = 0; i < numberOfReplicas; ++i )
-        reportReplica( dbSet->replica( i ), "myservice1" );
-      delete dbSet;
-
-      dbSet = lookupSvc.lookup( "myservice1" );
-      numberOfReplicas = dbSet->numberOfReplicas();
-      if ( numberOfReplicas != 2 ) {
-        delete dbSet;
-        throw std::runtime_error( "Unexpected number of replicas retrieved" );
-      }
-      for ( int i = 0; i < numberOfReplicas; ++i )
-        reportReplica( dbSet->replica( i ), "myservice1" );
-      delete dbSet;
-
-
-	endClock=clock();
-        elapsedTime=((double) (endClock - startClock)) / CLOCKS_PER_SEC;
-        std::cout<<"Time taken in micro seconds : "<<elapsedTime<<std::endl;
-	std::cout<<"Ends the XMLLookupService test"<<std::endl;
-
-    }
-    else {
-      throw std::runtime_error("Could not retrieve an lookup service.");
-    }
- }
-  catch ( std::exception& e ) {
-    std::cerr << "Standard C++ exception : " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( ... ) {
-    std::cerr << "Exception caught (...)" << std::endl;
-    return 1;
-  }
-
-  try {
-
-    int numberOfReplicas = 0;
-    seal::PluginManager* pm = seal::PluginManager::get();
-    pm->initialise();
-
-    seal::Handle< seal::Context > context = new seal::Context();
-    seal::Handle<seal::ComponentLoader> loader = new seal::ComponentLoader( context.get() );
-
-// Code for Seal Message Service
-   // Load the SEAL Message service and set the output threshold to Debug
-   loader->load( "SEAL/Services/MessageService" );
-   std::vector< seal::Handle<seal::IMessageService> > v_msgSvc;
-   context->query( v_msgSvc );
-   if ( ! v_msgSvc.empty() ) {
-     seal::Handle<seal::IMessageService>& msgSvc = v_msgSvc.front();
-     msgSvc->setOutputLevel( seal::Msg::Debug);
-   }
-	
-	
-// Code for Seal Message Service
-    loader->load( "CORAL/Services/LFCLookupService" );
-
-    seal::IHandle<seal::Service> svc = context->query<seal::Service>( "CORAL/Services/LFCLookupService" );
-
-    std::vector< seal::IHandle<coral::ILookupService> > v_lookupSvc;
-    context->query( v_lookupSvc );
-    if ( ! v_lookupSvc.empty() ) {
-    	const coral::ILookupService& lookupSvc = *( v_lookupSvc.front() );
-
-	std::cout<<"Performs the LFCLookupService test"<<std::endl;
-
-	startClock = clock();
-       coral::IDatabaseServiceSet* dbSet = lookupSvc.lookup( "myservice1");
-       numberOfReplicas = dbSet->numberOfReplicas();
-
-      for ( int i = 0; i < numberOfReplicas; ++i )
-        reportReplica( dbSet->replica( i ), "myservice1" );
-      delete dbSet;
-
-      dbSet = lookupSvc.lookup( "myservice1");
-      numberOfReplicas = dbSet->numberOfReplicas();
-
-      for ( int i = 0; i < numberOfReplicas; ++i )
-        reportReplica( dbSet->replica( i ), "myservice1" );
-      delete dbSet;
-
-	endClock=clock();
-	elapsedTime=((double) (endClock - startClock)) / CLOCKS_PER_SEC;
-
-        std::cout<<"Time taken in micro seconds : "<<elapsedTime<<std::endl;
-	std::cout<<"Ends the LFCLookupService test"<<std::endl;
-    }
-    else {
-      throw std::runtime_error("Could not retrieve an lookup service.");
-    }
-    std::cout << "Exiting..." << std::endl;
-  }
-  catch ( std::exception& e ) {
-    std::cerr << "Standard C++ exception : " << e.what() << std::endl;
-    return 1;
-  }
-  catch ( ... ) {
-    std::cerr << "Exception caught (...)" << std::endl;
-    return 1;
-  }
-  std::cout << "[OVAL] Success" << std::endl;
-  return 0;
-}
diff -Naur orig.src/Tests/LookupService_TimeComparison/test_LookupService_TimeComparison.ref coral/Tests/LookupService_TimeComparison/test_LookupService_TimeComparison.ref
--- orig.src/Tests/LookupService_TimeComparison/test_LookupService_TimeComparison.ref	2006-08-10 12:14:26.000000000 +0200
+++ src/Tests/LookupService_TimeComparison/test_LookupService_TimeComparison.ref	1970-01-01 01:00:00.000000000 +0100
@@ -1,31 +0,0 @@
-
-[oval run] =================================================
-[oval run] USER : dpathy
-[oval run] HOST : lxplus059.cern.ch
-[oval run] run tool: oval
-[oval run] final instruction: test_LookupService_TimeComparison
-[oval run] =================================================
-
-Performs the XMLLookupService test
-CORAL/Services/XMLLookupService: level[Error] XXXX
-myservice1 : oracle://host1/schema1, password, Update
-myservice1 : oracle://host3/schema1, certificate, Update
-CORAL/Services/XMLLookupService: level[Error] XXXX
-myservice1 : oracle://host1/schema1, password, Update
-myservice1 : oracle://host3/schema1, certificate, Update
-Time taken in micro seconds : 0.01
-Ends the XMLLookupService test
-Performs the LFCLookupService test
-myservice1 : oracle://host1/schema1_1, password, Update
-myservice1 : oracle://host1/schema1_3, certificate, Update
-myservice1 : oracle://host1/schema1_1, password, Update
-myservice1 : oracle://host1/schema1_3, certificate, Update
-Time taken in micro seconds : 0.08
-Ends the LFCLookupService test
-Exiting...
-[OVAL] Success
-
-[oval run] ==========================================
-[oval run] result: OK
-[oval run] ==========================================
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/bashrc coral/Tests/Performance_RelationalAccess/bin/bashrc
--- orig.src/Tests/Performance_RelationalAccess/bin/bashrc	2007-12-10 17:28:15.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/bashrc	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-# --------------------------------------------------------
-# Add this to your .bashrc
-# --------------------------------------------------------
-
-export AFS=/afs
-export SITEROOT=$AFS/cern.ch
-export CMTROOT=$SITEROOT/sw/contrib/CMT/v1r20p20070524
-export CMTCONFIG=slc4_amd64_gcc34
-source $CMTROOT/mgr/setup.sh
-export CMTPROJECTPATH=$SITEROOT/sw/lcg/app/releases
-export LD_LIBRARY_PATH
-export CORAL_VERSION=CORAL_1_9_2
-cd $CMTPROJECTPATH/CORAL/$CORAL_VERSION/src/config/cmt/
-source setup.sh
-cd $OLDPWD
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/config.xml coral/Tests/Performance_RelationalAccess/bin/config.xml
--- orig.src/Tests/Performance_RelationalAccess/bin/config.xml	2008-10-07 16:24:56.000000000 +0200
+++ src/Tests/Performance_RelationalAccess/bin/config.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,44 +0,0 @@
-<?xml version="1.0" ?>
-<config>
-	<machines>
-		<client>node1</client>
-		<client>node2</client>
-		<client>node3</client>
-
-		<server>server1</server>
-		<server>server2</server>
-	</machines>
-
-        <statistic
-                cpu="1"
-                waitEvents="1"/>
-
-	<execution
-		numCliNode="1"
-		numSessPerCliNode="2"
-		numSessIni="1"
-		numSessInc="1"
-		stepDuration="20"
-		maxTestDuration="3600"/>
-		
-	<locations
-		baseDir="/afs/cern.ch/user/j/jsmith/PerfTests/"
-		clientLogDir="/afs/cern.ch/user/j/jsmith/PerfTests/logs/"/>
-
-	<metrics>
-		<dynamic>Object inserted</dynamic>
-		<static>Memory usage in MB</static>
-	</metrics>
-
-	<clientConf
-		dbUser="ORACLE_USER"
-		clientCmd="client.py"
-		clientExe="python"
-		reportPeriod="10"
-		reportDbConnect="/OracleStressReport"/>
-
-        <fileToSave>
-                <file name="Client execution script">client.py</file>
-                <file name="Configuration file">config.xml</file>
-        </fileToSave>
-</config>
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/cshrc coral/Tests/Performance_RelationalAccess/bin/cshrc
--- orig.src/Tests/Performance_RelationalAccess/bin/cshrc	2007-12-10 17:28:15.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/cshrc	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-# --------------------------------------------------------
-# Add this to your .cshrc
-# --------------------------------------------------------
-
-setenv AFS /afs
-setenv SITEROOT $AFS/cern.ch
-setenv CMTROOT $SITEROOT/sw/contrib/CMT/v1r20p20070524
-setenv CMTCONFIG slc4_amd64_gcc34
-source $CMTROOT/mgr/setup.csh
-setenv CMTPROJECTPATH $SITEROOT/sw/lcg/app/releases
-setenv LD_LIBRARY_PATH
-setenv CORAL_VERSION CORAL_1_9_2
-cd $CMTPROJECTPATH/CORAL/$CORAL_VERSION/src/config/cmt/
-source setup.csh
-cd -
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/desc.txt coral/Tests/Performance_RelationalAccess/bin/desc.txt
--- orig.src/Tests/Performance_RelationalAccess/bin/desc.txt	2007-11-20 15:29:50.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/desc.txt	1970-01-01 01:00:00.000000000 +0100
@@ -1,3 +0,0 @@
-Enter the test description here...
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/install.sql coral/Tests/Performance_RelationalAccess/bin/install.sql
--- orig.src/Tests/Performance_RelationalAccess/bin/install.sql	2007-11-16 15:32:23.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/install.sql	1970-01-01 01:00:00.000000000 +0100
@@ -1,38 +0,0 @@
--- ----------------------------------------------------------------------------
--- Create an Oracle account for the monitoring feature.
--- ----------------------------------------------------------------------------
-
--- create account
-CREATE USER &&Monitoring_user IDENTIFIED BY &Password;
-
--- grant required privileges
-GRANT cern_app_role TO &&Monitoring_user;
-GRANT SELECT ON sys.gv_$session TO &&Monitoring_user;
-GRANT SELECT ON sys.v_$event_name TO &&Monitoring_user;
-GRANT SELECT ON sys.gv_$waitclassmetric TO &&Monitoring_user;
-GRANT SELECT ON sys.gv_$sysmetric TO &&Monitoring_user;
-GRANT CREATE VIEW TO &&Monitoring_user;
-
--- create views
-CREATE OR REPLACE VIEW &&Monitoring_user..st_session AS
-SELECT inst_id, username, program
-FROM sys.gv_$session;
-
-CREATE OR REPLACE VIEW &&Monitoring_user..st_avg_active_sessions AS
-SELECT class, sum(time_waited) / avg(intsize_csec) value
-  FROM
- (
- SELECT wc.inst_id, en.wait_class class,wc.time_waited, wc.intsize_csec
-   FROM gv$waitclassmetric wc, 
-	(SELECT UNIQUE wait_class, wait_class# 
-	 FROM v$event_name 
-	 WHERE wait_class != 'Idle') en
-  WHERE wc.wait_class# = en.wait_class#
- UNION ALL
- SELECT inst_id, 'CPU Used', value, 100
-   FROM gv$sysmetric
-  WHERE metric_name='CPU Usage Per Sec'
- )
-GROUP BY class
-ORDER BY class;
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/authentication.xml coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/authentication.xml
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/authentication.xml	2007-11-16 16:00:51.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/authentication.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-<?xml version="1.0" ?>
-<connectionslist>
-  <connection name="oracle://oracle_service_name/oracle_monitoring_username">
-    <parameter name="user" value="oracle_monitoring_username" />
-    <parameter name="password" value="oracle_monitoring_password" />
-  </connection>
-
-  <connection name="oracle://oracle_service_name_node1/oracle_client_username">
-    <parameter name="user" value="oracle_client_username" />
-    <parameter name="password" value="oracle_client_password" />
-  </connection>
-
-  <connection name="oracle://oracle_service_name_node2/oracle_client_username">
-    <parameter name="user" value="oracle_client_username" />
-    <parameter name="password" value="oracle_client_password" />
-  </connection>
-</connectionslist>
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/bashrc coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/bashrc
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/bashrc	2007-12-10 17:28:15.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/bashrc	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-# --------------------------------------------------------
-# Add this to your .bashrc
-# --------------------------------------------------------
-
-export AFS=/afs
-export SITEROOT=$AFS/cern.ch
-export CMTROOT=$SITEROOT/sw/contrib/CMT/v1r20p20070524
-export CMTCONFIG=slc4_amd64_gcc34
-source $CMTROOT/mgr/setup.sh
-export CMTPROJECTPATH=$SITEROOT/sw/lcg/app/releases
-export LD_LIBRARY_PATH
-export COOL_VERSION=COOL_2_2_2
-cd $CMTPROJECTPATH/COOL/$COOL_VERSION/src/config/cmt/
-source setup.sh
-cd $OLDPWD
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/config.xml coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/config.xml
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/config.xml	2008-10-07 16:24:55.000000000 +0200
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/config.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,46 +0,0 @@
-<?xml version="1.0" ?>
-<config>
-	<machines>
-		<client>node1</client>
-		<client>node2</client>
-		<client>node3</client>
-
-		<server>server1</server>
-		<server>server2</server>
-	</machines>
-
-        <statistic
-                cpu="1"
-                waitEvents="1"/>
-
-	<execution
-		numCliNode="1"
-		numSessPerCliNode="2"
-		numSessIni="1"
-		numSessInc="1"
-		stepDuration="20"
-		maxTestDuration="3600"/>
-		
-	<locations
-		baseDir="/afs/cern.ch/user/j/jsmith/PerfTests/"
-		clientLogDir="/afs/cern.ch/user/j/jsmith/PerfTests/logs/"/>
-
-	<metrics>
-		<dynamic>Object inserted</dynamic>
-		<!--<static>Memory usage in MB</static>-->
-	</metrics>
-
-	<clientConf
-		dbUser="oracle_client_username"
-		clientCmd="coolClient.py"
-		clientExe="python"
-		reportPeriod="10"
-		reportDbConnect="/dbdev/OracleStress"/>
-
-        <fileToSave>
-                <file name="Configuration file">config.xml</file>
-		<file name="Client execution script">coolClient.py</file>
-		<file name="Client configuration file">coolSetup.py</file>
-		<file name="Initialisation (create database)">createCoolDb.py</file>
-        </fileToSave>
-</config>
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/cshrc coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/cshrc
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/cshrc	2007-11-16 16:00:51.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/cshrc	1970-01-01 01:00:00.000000000 +0100
@@ -1,17 +0,0 @@
-# --------------------------------------------------------
-# Add this to your .cshrc
-# --------------------------------------------------------
-
-setenv AFS /afs
-setenv SITEROOT $AFS/cern.ch
-setenv CMTROOT $SITEROOT/sw/contrib/CMT/v1r20p20070524
-setenv CMTCONFIG slc4_amd64_gcc34
-source $CMTROOT/mgr/setup.csh
-setenv CMTPROJECTPATH $SITEROOT/sw/lcg/app/releases
-setenv LD_LIBRARY_PATH
-setenv COOL_VERSION COOL_2_2_1
-cd $CMTPROJECTPATH/COOL/$COOL_VERSION/src/config/cmt/
-source setup.csh
-cd -
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/dblookup.xml coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/dblookup.xml
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/dblookup.xml	2007-12-07 15:10:21.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/dblookup.xml	1970-01-01 01:00:00.000000000 +0100
@@ -1,8 +0,0 @@
-<?xml version="1.0" ?>
-<servicelist>
-  <logicalservice name="/OracleStressReport">
-     <service name="oracle://oracle_service_name/oracle_monitoring_username"
-              accessMode="readonly"
-              authentication="password" />
-  </logicalservice>
-</servicelist>
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/desc.txt coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/desc.txt
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/desc.txt	2007-11-27 11:18:09.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/desc.txt	1970-01-01 01:00:00.000000000 +0100
@@ -1,8 +0,0 @@
-SVMC insertions with COOL 2.2.2
-- 250 folders
-- 200 channels/folder
-- 1000 iovs/channel
-- closed IOV
-
-Tested on Oracle RAC 10g : oracleTestRAC
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/install_client.sql coral/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/install_client.sql
--- orig.src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/install_client.sql	2007-11-20 15:29:51.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/bin/sample_tests/COOL_insertions/install_client.sql	1970-01-01 01:00:00.000000000 +0100
@@ -1,10 +0,0 @@
--- create tablespace
-CREATE BIGFILE TABLESPACE &&New_tablespace DATAFILE SIZE 1G AUTOEXTEND ON NEXT 1G MAXSIZE UNLIMITED LOGGING EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO ;
-
--- create account
-CREATE USER &&ClientUsername IDENTIFIED BY &Password DEFAULT TABLESPACE &&New_tablespace QUOTA UNLIMITED on &&New_tablespace;
-
--- grant required privileges
-GRANT cern_dev_role TO &&ClientUsername;
-
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/etc/cpuplot.php coral/Tests/Performance_RelationalAccess/etc/cpuplot.php
--- orig.src/Tests/Performance_RelationalAccess/etc/cpuplot.php	2007-11-06 16:54:50.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/etc/cpuplot.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,46 +0,0 @@
-<?php
-
-include ("../jpgraph/src/jpgraph.php");
-include ("../jpgraph/src/jpgraph_line.php");
-include ("../jpgraph/src/jpgraph_date.php");
-
-include ("jpgraphdata/cpudata.php");
-include ("jpgraphdata/xdata.php");
-
-$graph = new Graph(800,400,"auto");
-$graph->SetScale("datlin");
-$graph->img->SetAntiAliasing();
-$graph->SetMargin(40,20,20,90);
-$graph->SetMarginColor('white'); 
-
-$lineplot1=new LinePlot($maxcpudata, $xdata);
-$lineplot2=new LinePlot($avgcpudata, $xdata);
-$lineplot3=new LinePlot($mincpudata, $xdata);
-
-$lineplot1->SetColor("red");
-$lineplot2->SetColor("blue");
-$lineplot3->SetColor("green");
-
-$lineplot1->SetLegend("Maximum");
-$lineplot2->SetLegend("Average");
-$lineplot3->SetLegend("Minimum");
-
-$graph->Add($lineplot1);
-$graph->Add($lineplot2);
-$graph->Add($lineplot3);
-
-$graph->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->title->Set("Database Server CPU Host Utilisation");
-$graph->xaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->xaxis->SetTitle("Timeline","middle");
-$graph->xaxis->SetLabelAngle(90);
-$graph->xaxis->scale->SetDateFormat('H:i:s');
-$graph->yaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->yaxis->SetTitle("CPU Utilization (%)","middle");
-
-$graph->legend->Pos(0.5,0.99,"center","bottom");
-$graph->legend->SetLayout(LEGEND_HOR);
-$graph->Stroke();
-
-?>
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/etc/metricplot.php coral/Tests/Performance_RelationalAccess/etc/metricplot.php
--- orig.src/Tests/Performance_RelationalAccess/etc/metricplot.php	2007-12-11 10:42:27.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/etc/metricplot.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,52 +0,0 @@
-<?php
-
-include ("../jpgraph/src/jpgraph.php");
-include ("../jpgraph/src/jpgraph_line.php");
-include ("../jpgraph/src/jpgraph_date.php");
-
-$metric = $_GET["metric"];
-
-include ("jpgraphdata/metricdata".$metric.".php");
-include ("jpgraphdata/xdata.php");
-include ("jpgraphdata/xdatametric.php");
-
-// Create the graph. These two calls are always required
-$graph = new Graph(800,400,"auto");    
-$graph->SetScale("datlin");
-$graph->SetY2Scale("lin");
-$graph->img->SetAntiAliasing();
-$graph->img->SetMargin(60,40,20,90);
-$graph->SetMarginColor('white'); 
-
-// Rate (average since the beginning of the test)
-$lineplot2 = new LinePlot($metricdata, $xdatametric);
-$lineplot2->SetColor("blue");
-$lineplot2->SetLegend($metricname);
-$graph->Add($lineplot2);
-
-// Number of clients
-$lineplot3 = new LinePlot($clientdata, $xdata);
-$lineplot3->SetColor("orange");
-$lineplot3->SetLegend("Number of clients");
-$graph->AddY2($lineplot3);
-
-$graph->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->title->Set($graphname);
-$graph->xaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->xaxis->SetTitle("Timeline","middle");
-$graph->xaxis->SetLabelAngle(90);
-$graph->xaxis->scale->SetDateFormat('H:i:s');
-$graph->yaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->yaxis->SetTitle($metricname,"middle");
-$graph->yaxis->SetColor("blue","black");
-$graph->yaxis->SetTitleMargin(45);
-$graph->y2axis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->y2axis->SetTitle("Clients","middle");
-$graph->y2axis->SetColor("orange","black");
-
-$graph->legend->Pos(0.5,0.99,"center","bottom");
-$graph->legend->SetLayout(LEGEND_HOR);
-$graph->Stroke();
-
-?>
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/etc/metricplotthroughput.php coral/Tests/Performance_RelationalAccess/etc/metricplotthroughput.php
--- orig.src/Tests/Performance_RelationalAccess/etc/metricplotthroughput.php	2007-12-03 10:42:51.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/etc/metricplotthroughput.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,42 +0,0 @@
-<?php
-
-include ("../jpgraph/src/jpgraph.php");
-include ("../jpgraph/src/jpgraph_scatter.php");
-include ("../jpgraph/src/jpgraph_date.php");
-
-$metric = $_GET["metric"];
-
-include ("jpgraphdata/metricthroughput".$metric.".php");
-include ("jpgraphdata/xdatathroughput.php");
-
-// Create the graph. These two calls are always required
-$graph = new Graph(800,400,"auto"); 
-$graph->SetScale("datlin");
-$graph->img->SetAntiAliasing();
-$graph->img->SetMargin(60,40,20,90);
-$graph->SetMarginColor('white'); 
-
-// Rate (average since the beginning of the test)
-$lineplot2 = new ScatterPlot($metricdata, $xdata);
-$lineplot2->mark->SetType(MARK_CROSS);
-$lineplot2->mark->SetColor("blue");
-$lineplot2->SetLegend($metricname);
-$graph->Add($lineplot2);
-
-$graph->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->title->Set($graphname);
-$graph->xaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->xaxis->SetTitle("Timeline","middle");
-$graph->xaxis->SetLabelAngle(90);
-$graph->xaxis->scale->SetDateFormat('H:i:s');
-$graph->yaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->yaxis->SetTitle($metricname,"middle");
-$graph->yaxis->SetColor("blue","black");
-$graph->yaxis->SetTitleMargin(45);
-
-$graph->legend->Pos(0.5,0.99,"center","bottom");
-$graph->legend->SetLayout(LEGEND_HOR);
-$graph->Stroke();
-
-?>
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/etc/waitplot.php coral/Tests/Performance_RelationalAccess/etc/waitplot.php
--- orig.src/Tests/Performance_RelationalAccess/etc/waitplot.php	2007-11-06 16:54:50.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/etc/waitplot.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,49 +0,0 @@
-<?php
-
-include ("../jpgraph/src/jpgraph.php");
-include ("../jpgraph/src/jpgraph_line.php");
-include ("../jpgraph/src/jpgraph_date.php");
-
-include ("jpgraphdata/waitdata.php");
-include ("jpgraphdata/xdata.php");
-
-$colors = array("limegreen","palegreen","blue","deepskyblue","firebrick","red","orange3","brown4","darkgray","lightgoldenrod3","lemonchiffon2","deeppink");
-
-// Create the graph. These two calls are always required
-$graph = new Graph(800,400,"auto");    
-$graph->SetScale("datlin");
-$graph->img->SetAntiAliasing();
-$graph->SetMargin(40,140,20,70);
-$graph->SetMarginColor('white'); 
-
-// Create the linear plots for each category
-for($i=0; $i < count($waitdata); $i++){
-   $dplot[] = new LinePlot($waitdata[$i], $xdata);
-   $dplot[$i]->SetFillColor($colors[$i]);
-   $dplot[$i]->SetLegend($waitheaders[$i]);
-   $dplot[$i]->SetWeight(0);
-}
-
-// Create the accumulated graph
-$accplot = new AccLinePlot($dplot);
-
-// Add the plot to the graph
-$graph->Add($accplot);
-
-$graph->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->title->Set("Average Active Sessions");
-$graph->xaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->xaxis->SetTitle("Timeline","middle");
-$graph->xaxis->SetLabelAngle(90);
-$graph->xaxis->scale->SetDateFormat('H:i:s');
-$graph->yaxis->title->SetFont(FF_FONT1,FS_BOLD);
-$graph->yaxis->SetTitle("Sessions actives","middle");
-
-// Adjust the legend position
-$graph->legend->Pos(0.01,0.5,"right","center");
-$graph->legend->SetReverse(); 
-
-// Display the graph
-$graph->Stroke();
-?>
-
diff -Naur orig.src/Tests/Performance_RelationalAccess/logs/index.php coral/Tests/Performance_RelationalAccess/logs/index.php
--- orig.src/Tests/Performance_RelationalAccess/logs/index.php	2007-12-07 12:14:50.000000000 +0100
+++ src/Tests/Performance_RelationalAccess/logs/index.php	1970-01-01 01:00:00.000000000 +0100
@@ -1,22 +0,0 @@
-<HTML>
-<BODY>
-<h2>List of test runs available:</h2>
-<ul>
-<?php
-   $path = opendir(getcwd());
-
-   $excluded_files = array('index.php', '.htaccess', '.', '..', 'jpgraph', 'CVS');
-   while (false !== ($file = readdir($path))) {
-      if (!in_array($file, $excluded_files))
-         $dirs[]=$dir."/".$file;
-   }
-   if (sizeof($dirs)>0) {
-      natcasesort($dirs);
-      foreach($dirs as $dir)
-         echo '<li><a href=".'.$dir.'">'.$dir.'</a>';
-      closedir($path);
-   }
-?>
-</ul>
-</body>
-</html>
diff -Naur orig.src/Tests/RetryAndFailOver/BuildFile coral/Tests/RetryAndFailOver/BuildFile
--- orig.src/Tests/RetryAndFailOver/BuildFile	2006-05-26 16:02:49.000000000 +0200
+++ src/Tests/RetryAndFailOver/BuildFile	2008-10-30 16:18:59.000000000 +0100
@@ -1 +1,6 @@
-<use name=Tests/Libraries/Connectivity></use>
+<bin name=test_RetryAndFailOver file=src/*.cpp>
+  <use name=Tests/Libraries/TestEnv>
+  <use name=Tests/Libraries/Connectivity>
+  <use name=RelationalAccess>
+  <use name=CoralCommon>
+</bin>
diff -Naur orig.src/UnitTests/src/gnuplot.cpp coral/UnitTests/src/gnuplot.cpp
--- orig.src/UnitTests/src/gnuplot.cpp	1970-01-01 01:00:00.000000000 +0100
+++ src/UnitTests/src/gnuplot.cpp	2008-11-03 20:18:35.000000000 +0100
@@ -0,0 +1,1628 @@
+///////////////////////////////////////////////////////////
+//
+// A C++ interface to gnuplot.
+//
+// This is a direct translation from the C interface
+// written by Nicolas Devillard (ndevilla@free.fr) which
+// is available from http://ndevilla.free.fr/gnuplot/.
+//
+// As in the C interface this uses pipes and so wont
+// run on a system that doesn't have POSIX pipe support
+//
+// Rajarshi Guha
+// e-mail: rguha@indiana.edu, rajarshi@presidency.com
+// http://cheminfo.informatics.indiana.edu/~rguha/code/cc++/
+//
+// 07/03/03
+//
+///////////////////////////////////////////////////////////
+//
+// A little correction for Win32 compatibility
+// and MS VC 6.0 done by V.Chyzhdzenka
+//
+// Notes:
+// 1. Added private method Gnuplot::init().
+// 2. Temporary file is created in the current
+//    folder but not in /tmp.
+// 3. Added #ifdef WIN32 e.t.c. where is needed.
+// 4. Added private member m_sGNUPlotFileName is
+//    a name of executed GNUPlot file.
+//
+// Viktor Chyzhdzenka
+// e-mail: chyzhdzenka@mail.ru
+//
+// 20/05/03
+//
+///////////////////////////////////////////////////////////
+//
+// corrections for Win32 and Linux compatibility
+//
+// some member functions added:
+//  set_GNUPlotPath, set_terminal_std,
+//  create_tmpfile, get_program_path, file_exists,
+//  operator<<, replot, reset_all, savetops, showonscreen,
+//  plotfile_*, plot_xy_err, plot_equation3d
+// set, unset: pointsize, grid, *logscale, *autoscale,
+//  smooth, title, legend, samples, isosamples,
+//  hidden3d, cbrange, contour
+//
+// Markus Burgis
+// e-mail: mail@burgis.info
+//
+// 10/03/08
+//
+///////////////////////////////////////////////////////////
+
+
+#include <fstream>              // for std::ifstream
+#include <sstream>              // for std::ostringstream
+#include <list>                 // for std::list
+#include <cstdio>               // for FILE, fputs(), fflush(), popen()
+#include <cstdlib>              // for getenv()
+#include "gnuplot.h"
+
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__) //defined for 32 and 64-bit environments
+ #include <io.h>                // for _access(), _mktemp()
+ #define GP_MAX_TMP_FILES  27   // 27 temporary files it's Microsoft restriction
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__) //all UNIX-like OSs (Linux, *BSD, MacOSX, Solaris, ...)
+ #include <unistd.h>            // for access(), mkstemp()
+ #define GP_MAX_TMP_FILES  64
+#else
+ #error unsupported or unknown operating system
+#endif
+
+
+
+
+//----------------------------------------------------------------------------------
+//
+// initialize static data
+//
+int Gnuplot::tmpfile_num = 0;
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+std::string Gnuplot::m_sGNUPlotFileName = "pgnuplot.exe";
+std::string Gnuplot::m_sGNUPlotPath = "C:/program files/gnuplot/bin/";
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+std::string Gnuplot::m_sGNUPlotFileName = "gnuplot";
+std::string Gnuplot::m_sGNUPlotPath = "/usr/bin/";
+#endif
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+std::string Gnuplot::terminal_std = "windows";
+#elif ( defined(unix) || defined(__unix) || defined(__unix__) ) && !defined(__APPLE__)
+std::string Gnuplot::terminal_std = "x11";
+#elif defined(__APPLE__)
+std::string Gnuplot::terminal_std = "aqua";
+#endif
+
+//----------------------------------------------------------------------------------
+//
+// define static member function: set Gnuplot path manual
+//   for windows: path with slash '/' not backslash '\'
+//
+bool Gnuplot::set_GNUPlotPath(const std::string &path)
+{
+
+    std::string tmp = path + "/" + Gnuplot::m_sGNUPlotFileName;
+
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    if ( Gnuplot::file_exists(tmp,0) ) // check existence
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if ( Gnuplot::file_exists(tmp,1) ) // check existence and execution permission
+#endif
+    {
+        Gnuplot::m_sGNUPlotPath = path;
+        return true;
+    }
+    else
+    {
+        Gnuplot::m_sGNUPlotPath.clear();
+        return false;
+    }
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// define static member function: set standart terminal, used by showonscreen
+//  defaults: Windows - win, Linux - x11, Mac - aqua
+//
+void Gnuplot::set_terminal_std(const std::string &type)
+{
+#if defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if (type.find("x11") != std::string::npos && getenv("DISPLAY") == NULL)
+    {
+        throw GnuplotException("Can't find DISPLAY variable");
+    }
+#endif
+
+
+    Gnuplot::terminal_std = type;
+    return;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// A string tokenizer taken from http://www.sunsite.ualberta.ca/Documentation/
+// /Gnu/libstdc++-2.90.8/html/21_strings/stringtok_std_h.txt
+//
+template <typename Container>
+void stringtok (Container &container,
+                std::string const &in,
+                const char * const delimiters = " \t\n")
+{
+    const std::string::size_type len = in.length();
+          std::string::size_type i = 0;
+
+    while ( i < len )
+    {
+        // eat leading whitespace
+        i = in.find_first_not_of (delimiters, i);
+
+        if (i == std::string::npos)
+            return;   // nothing left but white space
+
+        // find the end of the token
+        std::string::size_type j = in.find_first_of (delimiters, i);
+
+        // push token
+        if (j == std::string::npos)
+        {
+            container.push_back (in.substr(i));
+            return;
+        }
+        else
+            container.push_back (in.substr(i, j-i));
+
+        // set up for next loop
+        i = j + 1;
+    }
+
+    return;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// constructor: set a style during construction
+//
+Gnuplot::Gnuplot(const std::string &style)
+{
+    init();
+    set_style(style);
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// constructor: open a new session, plot a signal (x)
+//
+Gnuplot::Gnuplot(const std::vector<double> &x,
+                 const std::string &title,
+                 const std::string &style,
+                 const std::string &labelx,
+                 const std::string &labely)
+{
+    init();
+
+
+    set_style(style);
+    set_xlabel(labelx);
+    set_ylabel(labely);
+
+    plot_x(x,title);
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// constructor: open a new session, plot a signal (x,y)
+//
+Gnuplot::Gnuplot(const std::vector<double> &x,
+                 const std::vector<double> &y,
+                 const std::string &title,
+                 const std::string &style,
+                 const std::string &labelx,
+                 const std::string &labely)
+{
+    init();
+
+    set_style(style);
+    set_xlabel(labelx);
+    set_ylabel(labely);
+
+    plot_xy(x,y,title);
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// constructor: open a new session, plot a signal (x,y,z)
+//
+Gnuplot::Gnuplot(const std::vector<double> &x,
+                 const std::vector<double> &y,
+                 const std::vector<double> &z,
+                 const std::string &title,
+                 const std::string &style,
+                 const std::string &labelx,
+                 const std::string &labely,
+                 const std::string &labelz)
+{
+    init();
+
+    set_style(style);
+    set_xlabel(labelx);
+    set_ylabel(labely);
+    set_zlabel(labelz);
+
+    plot_xyz(x,y,z,title);
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Destructor: needed to delete temporary files
+//
+Gnuplot::~Gnuplot()
+{
+    if ((tmpfile_list).size() > 0)
+    {
+        for (unsigned int i = 0; i < tmpfile_list.size(); i++)
+            remove( tmpfile_list[i].c_str() );
+
+        Gnuplot::tmpfile_num -= tmpfile_list.size();
+    }
+
+    // A stream opened by popen() should be closed by pclose()
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    if (_pclose(gnucmd) == -1)
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if (pclose(gnucmd) == -1)
+#endif
+        throw GnuplotException("Problem closing communication to gnuplot");
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Resets a gnuplot session (next plot will erase previous ones)
+//
+Gnuplot& Gnuplot::reset_plot()
+{
+    if (tmpfile_list.size() > 0)
+    {
+        for (unsigned int i = 0; i < tmpfile_list.size(); i++)
+            remove(tmpfile_list[i].c_str());
+
+        Gnuplot::tmpfile_num -= tmpfile_list.size();
+        tmpfile_list.clear();
+    }
+
+    nplots = 0;
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// resets a gnuplot session and sets all varibles to default
+//
+Gnuplot& Gnuplot::reset_all()
+{
+    if (tmpfile_list.size() > 0)
+    {
+        for (unsigned int i = 0; i < tmpfile_list.size(); i++)
+            remove(tmpfile_list[i].c_str());
+
+        Gnuplot::tmpfile_num -= tmpfile_list.size();
+        tmpfile_list.clear();
+    }
+
+    nplots = 0;
+    cmd("reset");
+    cmd("clear");
+    pstyle = "points";
+    smooth = "";
+    showonscreen();
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Find out if valid is true
+//
+bool Gnuplot::is_valid()
+{
+    return(valid);
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// replot repeats the last plot or splot command
+//
+Gnuplot& Gnuplot::replot()
+{
+    if (nplots > 0)
+    {
+        cmd("replot");
+    }
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Change the plotting style of a gnuplot session
+//
+Gnuplot& Gnuplot::set_style(const std::string &stylestr)
+{
+    if (stylestr.find("lines")          == std::string::npos  &&
+        stylestr.find("points")         == std::string::npos  &&
+        stylestr.find("linespoints")    == std::string::npos  &&
+        stylestr.find("impulses")       == std::string::npos  &&
+        stylestr.find("dots")           == std::string::npos  &&
+        stylestr.find("steps")          == std::string::npos  &&
+        stylestr.find("fsteps")         == std::string::npos  &&
+        stylestr.find("histeps")        == std::string::npos  &&
+        stylestr.find("boxes")          == std::string::npos  &&  // 1-4 columns of data are required
+        stylestr.find("filledcurves")   == std::string::npos  &&
+        stylestr.find("histograms")     == std::string::npos  )   //only for one data column
+//        stylestr.find("labels")         == std::string::npos  &&  // 3 columns of data are required
+//        stylestr.find("xerrorbars")     == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("xerrorlines")    == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("errorbars")      == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("errorlines")     == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("yerrorbars")     == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("yerrorlines")    == std::string::npos  &&  // 3-4 columns of data are required
+//        stylestr.find("boxerrorbars")   == std::string::npos  &&  // 3-5 columns of data are required
+//        stylestr.find("xyerrorbars")    == std::string::npos  &&  // 4,6,7 columns of data are required
+//        stylestr.find("xyerrorlines")   == std::string::npos  &&  // 4,6,7 columns of data are required
+//        stylestr.find("boxxyerrorbars") == std::string::npos  &&  // 4,6,7 columns of data are required
+//        stylestr.find("financebars")    == std::string::npos  &&  // 5 columns of data are required
+//        stylestr.find("candlesticks")   == std::string::npos  &&  // 5 columns of data are required
+//        stylestr.find("vectors")        == std::string::npos  &&
+//        stylestr.find("image")          == std::string::npos  &&
+//        stylestr.find("rgbimage")       == std::string::npos  &&
+//        stylestr.find("pm3d")           == std::string::npos  )
+    {
+        pstyle = std::string("points");
+    }
+    else
+    {
+        pstyle = stylestr;
+    }
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// smooth: interpolation and approximation of data
+//
+Gnuplot& Gnuplot::set_smooth(const std::string &stylestr)
+{
+    if (stylestr.find("unique")    == std::string::npos  &&
+        stylestr.find("frequency") == std::string::npos  &&
+        stylestr.find("csplines")  == std::string::npos  &&
+        stylestr.find("acsplines") == std::string::npos  &&
+        stylestr.find("bezier")    == std::string::npos  &&
+        stylestr.find("sbezier")   == std::string::npos  )
+    {
+        smooth = "";
+    }
+    else
+    {
+        smooth = stylestr;
+    }
+
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// unset smooth
+//
+Gnuplot& Gnuplot::unset_smooth()
+{
+    smooth = "";
+
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// sets terminal type to windows / x11
+//
+Gnuplot& Gnuplot::showonscreen()
+{
+    cmd("set output");
+    cmd("set terminal " + Gnuplot::terminal_std);
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// saves a gnuplot session to a postscript file
+//
+Gnuplot& Gnuplot::savetops(const std::string &filename)
+{
+    cmd("set terminal postscript color");
+
+    std::ostringstream cmdstr;
+    cmdstr << "set output \"" << filename << ".ps\"";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Switches legend on
+//
+Gnuplot& Gnuplot::set_legend(const std::string &position)
+{
+    std::ostringstream cmdstr;
+    cmdstr << "set key " << position;
+
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Switches legend off
+//
+Gnuplot& Gnuplot::unset_legend()
+{
+    cmd("unset key");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Turns grid on
+//
+Gnuplot& Gnuplot::set_grid()
+{
+    cmd("set grid");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Turns grid off
+//
+Gnuplot& Gnuplot::unset_grid()
+{
+    cmd("unset grid");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns on log scaling for the x axis
+//
+Gnuplot& Gnuplot::set_xlogscale(const double base)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set logscale x " << base;
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns on log scaling for the y axis
+//
+Gnuplot& Gnuplot::set_ylogscale(const double base)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set logscale y " << base;
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns on log scaling for the z axis
+//
+Gnuplot& Gnuplot::set_zlogscale(const double base)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set logscale z " << base;
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns off log scaling for the x axis
+//
+Gnuplot& Gnuplot::unset_xlogscale()
+{
+    cmd("unset logscale x");
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns off log scaling for the y axis
+//
+Gnuplot& Gnuplot::unset_ylogscale()
+{
+    cmd("unset logscale y");
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// turns off log scaling for the z axis
+//
+Gnuplot& Gnuplot::unset_zlogscale()
+{
+    cmd("unset logscale z");
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// scales the size of the points used in plots
+//
+Gnuplot& Gnuplot::set_pointsize(const double pointsize)
+{
+    std::ostringstream cmdstr;
+    cmdstr << "set pointsize " << pointsize;
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// set isoline density (grid) for plotting functions as surfaces
+//
+Gnuplot& Gnuplot::set_samples(const int samples)
+{
+    std::ostringstream cmdstr;
+    cmdstr << "set samples " << samples;
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// set isoline density (grid) for plotting functions as surfaces
+//
+Gnuplot& Gnuplot::set_isosamples(const int isolines)
+{
+    std::ostringstream cmdstr;
+    cmdstr << "set isosamples " << isolines;
+    cmd(cmdstr.str());
+
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// enables hidden line removal for surface plotting
+//
+Gnuplot& Gnuplot::set_hidden3d()
+{
+    cmd("set hidden3d");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// disables hidden line removal for surface plotting
+//
+Gnuplot& Gnuplot::unset_hidden3d()
+{
+    cmd("unset hidden3d");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// enables contour drawing for surfaces set contour {base | surface | both}
+//
+
+Gnuplot& Gnuplot::set_contour(const std::string &position)
+{
+    if (position.find("base")    == std::string::npos  &&
+        position.find("surface") == std::string::npos  &&
+        position.find("both")    == std::string::npos  )
+    {
+        cmd("set contour base");
+    }
+    else
+    {
+        cmd("set contour " + position);
+    }
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// disables contour drawing for surfaces
+//
+
+Gnuplot& Gnuplot::unset_contour()
+{
+    cmd("unset contour");
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// enables the display of surfaces (for 3d plot)
+//
+Gnuplot& Gnuplot::set_surface()
+{
+    cmd("set surface");
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// disables the display of surfaces (for 3d plot)
+//
+Gnuplot& Gnuplot::unset_surface()
+{
+    cmd("unset surface");
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Sets the title of a gnuplot session
+//
+Gnuplot& Gnuplot::set_title(const std::string &title)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set title \"" << title << "\"";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Clears the title of a gnuplot session
+//
+Gnuplot& Gnuplot::unset_title()
+{
+    set_title("");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// set labels
+//
+// set the xlabel
+Gnuplot& Gnuplot::set_xlabel(const std::string &label)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set xlabel \"" << label << "\"";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set the ylabel
+//
+Gnuplot& Gnuplot::set_ylabel(const std::string &label)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set ylabel \"" << label << "\"";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set the zlabel
+//
+Gnuplot& Gnuplot::set_zlabel(const std::string &label)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set zlabel \"" << label << "\"";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// set range
+//
+// set the xrange
+Gnuplot& Gnuplot::set_xrange(const int iFrom,
+                             const int iTo)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set xrange[" << iFrom << ":" << iTo << "]";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set autoscale x
+//
+Gnuplot& Gnuplot::set_xautoscale()
+{
+    cmd("set xrange restore");
+    cmd("set autoscale x");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set the yrange
+//
+Gnuplot& Gnuplot::set_yrange(const int iFrom,
+                             const int iTo)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set yrange[" << iFrom << ":" << iTo << "]";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set autoscale y
+//
+Gnuplot& Gnuplot::set_yautoscale()
+{
+    cmd("set yrange restore");
+    cmd("set autoscale y");
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+// set the zrange
+//
+Gnuplot& Gnuplot::set_zrange(const int iFrom,
+                             const int iTo)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set zrange[" << iFrom << ":" << iTo << "]";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+// set autoscale z
+//
+Gnuplot& Gnuplot::set_zautoscale()
+{
+    cmd("set zrange restore");
+    cmd("set autoscale z");
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// set the palette range
+//
+Gnuplot& Gnuplot::set_cbrange(const int iFrom,
+                              const int iTo)
+{
+    std::ostringstream cmdstr;
+
+    cmdstr << "set cbrange[" << iFrom << ":" << iTo << "]";
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Plots a linear equation y=ax+b (where you supply the
+// slope a and intercept b)
+//
+Gnuplot& Gnuplot::plot_slope(const double a,
+                             const double b,
+                             const std::string &title)
+{
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    cmdstr << a << " * x + " << b << " title \"";
+
+    if (title == "")
+        cmdstr << "f(x) = " << a << " * x + " << b;
+    else
+        cmdstr << title;
+
+    cmdstr << "\" with " << pstyle;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// Plot an equation which is supplied as a std::string y=f(x) (only f(x) expected)
+//
+Gnuplot& Gnuplot::plot_equation(const std::string &equation,
+                                const std::string &title)
+{
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    cmdstr << equation << " title \"";
+
+    if (title == "")
+        cmdstr << "f(x) = " << equation;
+    else
+        cmdstr << title;
+
+    cmdstr << "\" with " << pstyle;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+//----------------------------------------------------------------------------------
+//
+// plot an equation supplied as a std::string y=(x)
+//
+Gnuplot& Gnuplot::plot_equation3d(const std::string &equation,
+                                  const std::string &title)
+{
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == false)
+        cmdstr << "replot ";
+    else
+        cmdstr << "splot ";
+
+    cmdstr << equation << " title \"";
+
+    if (title == "")
+        cmdstr << "f(x,y) = " << equation;
+    else
+        cmdstr << title;
+
+    cmdstr << "\" with " << pstyle;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles (x) saved in a file
+//
+Gnuplot& Gnuplot::plotfile_x(const std::string &filename,
+                             const int column,
+                             const std::string &title)
+{
+    //
+    // check if file exists
+    //
+    if( !(Gnuplot::file_exists(filename,4)) ) // check existence and read permission
+    {
+        std::ostringstream except;
+        if( !(Gnuplot::file_exists(filename,0)) ) // check existence
+            except << "File \"" << filename << "\" does not exist";
+        else
+            except << "No read permission for File \"" << filename << "\"";
+        throw GnuplotException( except.str() );
+        return *this;
+    }
+
+
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    cmdstr << "\"" << filename << "\" using " << column;
+
+    if (title == "")
+        cmdstr << " notitle ";
+    else
+        cmdstr << " title \"" << title << "\" ";
+
+    if(smooth == "")
+        cmdstr << "with " << pstyle;
+    else
+        cmdstr << "smooth " << smooth;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str()); //nplots++; two_dim = true;  already in cmd();
+
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles (x y) saved in a file
+//
+Gnuplot& Gnuplot::plotfile_xy(const std::string &filename,
+                              const int column_x,
+                              const int column_y,
+                              const std::string &title)
+{
+    //
+    // check if file exists
+    //
+    if( !(Gnuplot::file_exists(filename,4)) ) // check existence and read permission
+    {
+        std::ostringstream except;
+        if( !(Gnuplot::file_exists(filename,0)) ) // check existence
+            except << "File \"" << filename << "\" does not exist";
+        else
+            except << "No read permission for File \"" << filename << "\"";
+        throw GnuplotException( except.str() );
+        return *this;
+    }
+
+
+
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    cmdstr << "\"" << filename << "\" using " << column_x << ":" << column_y;
+
+    if (title == "")
+        cmdstr << " notitle ";
+    else
+        cmdstr << " title \"" << title << "\" ";
+
+    if(smooth == "")
+        cmdstr << "with " << pstyle;
+    else
+        cmdstr << "smooth " << smooth;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph with errorbars from a list of doubles (x y dy) saved in a file
+//
+Gnuplot& Gnuplot::plotfile_xy_err(const std::string &filename,
+                                  const int column_x,
+                                  const int column_y,
+                                  const int column_dy,
+                                  const std::string &title)
+{
+    //
+    // check if file exists
+    //
+    if( !(Gnuplot::file_exists(filename,4)) ) // check existence and read permission
+    {
+        std::ostringstream except;
+        if( !(Gnuplot::file_exists(filename,0)) ) // check existence
+            except << "File \"" << filename << "\" does not exist";
+        else
+            except << "No read permission for File \"" << filename << "\"";
+        throw GnuplotException( except.str() );
+        return *this;
+    }
+
+
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    cmdstr << "\"" << filename << "\" using " << column_x << ":" << column_y;
+
+    if (title == "")
+        cmdstr << " notitle ";
+    else
+        cmdstr << " title \"" << title << "\" ";
+
+    cmdstr << "with " << pstyle << ", \"" << filename << "\" using "
+           << column_x << ":" << column_y << ":" << column_dy << " notitle with errorbars";
+
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// plot x,y pairs with dy errorbars
+//
+Gnuplot& Gnuplot::plot_xy_err(const std::vector<double> &x,
+                              const std::vector<double> &y,
+                              const std::vector<double> &dy,
+                              const std::string &title)
+{
+    if (x.size() == 0 || y.size() == 0 || dy.size() == 0)
+    {
+        throw GnuplotException("std::vectors too small");
+        return *this;
+    }
+
+    if (x.size() != y.size() || y.size() != dy.size())
+    {
+        throw GnuplotException("Length of the std::vectors differs");
+        return *this;
+    }
+
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+        tmp << x[i] << " " << y[i] << " " << dy[i] << std::endl;
+
+    tmp.flush();
+    tmp.close();
+
+
+    // Do the actual plot
+    plotfile_xy_err(name, 1, 2, 3, title);
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 3d graph from a list of doubles (x y z) saved in a file
+//
+Gnuplot& Gnuplot::plotfile_xyz(const std::string &filename,
+                               const int column_x,
+                               const int column_y,
+                               const int column_z,
+                               const std::string &title)
+{
+    //
+    // check if file exists
+    //
+    if( !(Gnuplot::file_exists(filename,4)) ) // check existence and read permission
+    {
+        std::ostringstream except;
+        if( !(Gnuplot::file_exists(filename,0)) ) // check existence
+            except << "File \"" << filename << "\" does not exist";
+        else
+            except << "No read permission for File \"" << filename << "\"";
+        throw GnuplotException( except.str() );
+        return *this;
+    }
+
+
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == false)
+        cmdstr << "replot ";
+    else
+        cmdstr << "splot ";
+
+    cmdstr << "\"" << filename << "\" using " << column_x << ":" << column_y << ":" << column_z;
+
+    if (title == "")
+        cmdstr << " notitle with " << pstyle;
+    else
+        cmdstr << " title \"" << title << "\" with " << pstyle;
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 3d graph from a list of doubles: x y z
+//
+Gnuplot& Gnuplot::plot_xyz(const std::vector<double> &x,
+                           const std::vector<double> &y,
+                           const std::vector<double> &z,
+                           const std::string &title)
+{
+    if (x.size() == 0 || y.size() == 0 || z.size() == 0)
+    {
+        throw GnuplotException("std::vectors too small");
+        return *this;
+    }
+
+    if (x.size() != y.size() || x.size() != z.size())
+    {
+        throw GnuplotException("Length of the std::vectors differs");
+        return *this;
+    }
+
+
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+    {
+        tmp << x[i] << " " << y[i] << " " << z[i] <<std::endl;
+    }
+
+    tmp.flush();
+    tmp.close();
+
+
+    plotfile_xyz(name, 1, 2, 3, title);
+
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+/// *  note that this function is not valid for versions of GNUPlot below 4.2
+//
+Gnuplot& Gnuplot::plot_image(const unsigned char * ucPicBuf,
+                             const int iWidth,
+                             const int iHeight,
+                             const std::string &title)
+{
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    int iIndex = 0;
+    for(int iRow = 0; iRow < iHeight; iRow++)
+    {
+        for(int iColumn = 0; iColumn < iWidth; iColumn++)
+        {
+            tmp << iColumn << " " << iRow  << " " << static_cast<float>(ucPicBuf[iIndex++]) << std::endl;
+        }
+    }
+
+    tmp.flush();
+    tmp.close();
+
+
+    std::ostringstream cmdstr;
+    //
+    // command to be sent to gnuplot
+    //
+    if (nplots > 0  &&  two_dim == true)
+        cmdstr << "replot ";
+    else
+        cmdstr << "plot ";
+
+    if (title == "")
+        cmdstr << "\"" << name << "\" with image";
+    else
+        cmdstr << "\"" << name << "\" title \"" << title << "\" with image";
+
+    //
+    // Do the actual plot
+    //
+    cmd(cmdstr.str());
+
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// Sends a command to an active gnuplot session
+//
+Gnuplot& Gnuplot::cmd(const std::string &cmdstr)
+{
+    if( !(valid) )
+    {
+        return *this;
+    }
+
+
+    // int fputs ( const char * str, FILE * stream );
+    // writes the string str to the stream.
+    // The function begins copying from the address specified (str) until it reaches the
+    // terminating null character ('\0'). This final null-character is not copied to the stream.
+    fputs( (cmdstr+"\n").c_str(), gnucmd );
+
+    // int fflush ( FILE * stream );
+    // If the given stream was open for writing and the last i/o operation was an output operation,
+    // any unwritten data in the output buffer is written to the file.
+    // If the argument is a null pointer, all open files are flushed.
+    // The stream remains open after this call.
+    fflush(gnucmd);
+
+
+    if( cmdstr.find("replot") != std::string::npos )
+    {
+        return *this;
+    }
+    else if( cmdstr.find("splot") != std::string::npos )
+    {
+        two_dim = false;
+        nplots++;
+    }
+    else if( cmdstr.find("plot") != std::string::npos )
+    {
+        two_dim = true;
+        nplots++;
+    }
+
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// Sends a command to an active gnuplot session, identical to cmd()
+//
+Gnuplot& Gnuplot::operator<<(const std::string &cmdstr)
+{
+    cmd(cmdstr);
+    return *this;
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// Opens up a gnuplot session, ready to receive commands
+//
+void Gnuplot::init()
+{
+    // char * getenv ( const char * name );  get value of an environment variable
+    // Retrieves a C string containing the value of the environment variable whose name is specified as argument.
+    // If the requested variable is not part of the environment list, the function returns a NULL pointer.
+#if ( defined(unix) || defined(__unix) || defined(__unix__) ) && !defined(__APPLE__)
+    if (getenv("DISPLAY") == NULL)
+    {
+        valid = false;
+        throw GnuplotException("Can't find DISPLAY variable");
+    }
+#endif
+
+
+    // if gnuplot not available
+    if (!Gnuplot::get_program_path())
+    {
+        valid = false;
+        throw GnuplotException("Can't find gnuplot");
+    }
+
+
+    //
+    // open pipe
+    //
+    std::string tmp = Gnuplot::m_sGNUPlotPath + "/" + Gnuplot::m_sGNUPlotFileName;
+
+    // FILE *popen(const char *command, const char *mode);
+    // The popen() function shall execute the command specified by the string command,
+    // create a pipe between the calling program and the executed command, and
+    // return a pointer to a stream that can be used to either read from or write to the pipe.
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    gnucmd = _popen(tmp.c_str(),"w");
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    gnucmd = popen(tmp.c_str(),"w");
+#endif
+
+    // popen() shall return a pointer to an open stream that can be used to read or write to the pipe.
+    // Otherwise, it shall return a null pointer and may set errno to indicate the error.
+    if (!gnucmd)
+    {
+        valid = false;
+        throw GnuplotException("Couldn't open connection to gnuplot");
+    }
+
+    nplots = 0;
+    valid = true;
+    smooth = "";
+
+    //set terminal type
+    showonscreen();
+
+    return;
+}
+
+
+//----------------------------------------------------------------------------------
+//
+// Find out if a command lives in m_sGNUPlotPath or in PATH
+//
+bool Gnuplot::get_program_path()
+{
+    //
+    // first look in m_sGNUPlotPath for Gnuplot
+    //
+    std::string tmp = Gnuplot::m_sGNUPlotPath + "/" + Gnuplot::m_sGNUPlotFileName;
+
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    if ( Gnuplot::file_exists(tmp,0) ) // check existence
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if ( Gnuplot::file_exists(tmp,1) ) // check existence and execution permission
+#endif
+    {
+        return true;
+    }
+
+
+    //
+    // second look in PATH for Gnuplot
+    //
+    char *path;
+    // Retrieves a C string containing the value of the environment variable PATH
+    path = getenv("PATH");
+
+
+    if (path == NULL)
+    {
+        throw GnuplotException("Path is not set");
+        return false;
+    }
+    else
+    {
+        std::list<std::string> ls;
+
+        //split path (one long string) into list ls of strings
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+        stringtok(ls,path,";");
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+        stringtok(ls,path,":");
+#endif
+
+        // scan list for Gnuplot program files
+        for (std::list<std::string>::const_iterator i = ls.begin(); i != ls.end(); ++i)
+        {
+            tmp = (*i) + "/" + Gnuplot::m_sGNUPlotFileName;
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+            if ( Gnuplot::file_exists(tmp,0) ) // check existence
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+            if ( Gnuplot::file_exists(tmp,1) ) // check existence and execution permission
+#endif
+            {
+                Gnuplot::m_sGNUPlotPath = *i; // set m_sGNUPlotPath
+                return true;
+            }
+        }
+
+        tmp = "Can't find gnuplot neither in PATH nor in \"" + Gnuplot::m_sGNUPlotPath + "\"";
+        throw GnuplotException(tmp);
+
+        Gnuplot::m_sGNUPlotPath = "";
+        return false;
+    }
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// check if file exists
+//
+bool Gnuplot::file_exists(const std::string &filename, int mode)
+{
+    if ( mode < 0 || mode > 7)
+    {
+        throw std::runtime_error("In function \"Gnuplot::file_exists\": mode has to be an integer between 0 and 7");
+        return false;
+    }
+
+    // int _access(const char *path, int mode);
+    //  returns 0 if the file has the given mode,
+    //  it returns -1 if the named file does not exist or is not accessible in the given mode
+    // mode = 0 (F_OK) (default): checks file for existence only
+    // mode = 1 (X_OK): execution permission
+    // mode = 2 (W_OK): write permission
+    // mode = 4 (R_OK): read permission
+    // mode = 6       : read and write permission
+    // mode = 7       : read, write and execution permission
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    if (_access(filename.c_str(), mode) == 0)
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if (access(filename.c_str(), mode) == 0)
+#endif
+    {
+        return true;
+    }
+    else
+    {
+        return false;
+    }
+
+}
+
+
+
+//----------------------------------------------------------------------------------
+//
+// Opens a temporary file
+//
+std::string Gnuplot::create_tmpfile(std::ofstream &tmp)
+{
+
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    char name[] = "gnuplotiXXXXXX"; //tmp file in working directory
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    char name[] = "/tmp/gnuplotiXXXXXX"; // tmp file in /tmp
+#endif
+
+    //
+    // check if maximum number of temporary files reached
+    //
+    if (Gnuplot::tmpfile_num == GP_MAX_TMP_FILES - 1)
+    {
+        std::ostringstream except;
+        except << "Maximum number of temporary files reached (" << GP_MAX_TMP_FILES
+               << "): cannot open more files" << std::endl;
+
+        throw GnuplotException( except.str() );
+        return "";
+    }
+
+    // int mkstemp(char *name);
+    // shall replace the contents of the string pointed to by "name" by a unique filename,
+    // and return a file descriptor for the file open for reading and writing.
+    // Otherwise, -1 shall be returned if no suitable file could be created.
+    // The string in template should look like a filename with six trailing 'X' s;
+    // mkstemp() replaces each 'X' with a character from the portable filename character set.
+    // The characters are chosen such that the resulting name does not duplicate the name of an existing file at the time of a call to mkstemp()
+
+
+    //
+    // open temporary files for output
+    //
+#if defined(WIN32) || defined(_WIN32) || defined(__WIN32__) || defined(__TOS_WIN__)
+    if (_mktemp(name) == NULL)
+#elif defined(unix) || defined(__unix) || defined(__unix__) || defined(__APPLE__)
+    if (mkstemp(name) == -1)
+#endif
+    {
+        std::ostringstream except;
+        except << "Cannot create temporary file \"" << name << "\"";
+        throw GnuplotException(except.str());
+        return "";
+    }
+
+    tmp.open(name);
+    if (tmp.bad())
+    {
+        std::ostringstream except;
+        except << "Cannot create temporary file \"" << name << "\"";
+        throw GnuplotException(except.str());
+        return "";
+    }
+
+    //
+    // Save the temporary filename
+    //
+    tmpfile_list.push_back(name);
+    Gnuplot::tmpfile_num++;
+
+    return name;
+}
diff -Naur orig.src/UnitTests/src/gnuplot.h coral/UnitTests/src/gnuplot.h
--- orig.src/UnitTests/src/gnuplot.h	1970-01-01 01:00:00.000000000 +0100
+++ src/UnitTests/src/gnuplot.h	2008-11-03 20:18:35.000000000 +0100
@@ -0,0 +1,404 @@
+////////////////////////////////////////////////////////////////////////////////////////
+//
+// A C++ interface to gnuplot.
+//
+//
+// The interface uses pipes and so won't run on a system that doesn't have POSIX pipe support
+// Tested on Windows (MinGW and Visual C++) and Linux (GCC)
+//
+// Version history:
+// 0. C interface
+//    by N. Devillard (27/01/03)
+// 1. C++ interface: direct translation from the C interface
+//    by Rajarshi Guha (07/03/03)
+// 2. corrections for Win32 compatibility
+//    by V. Chyzhdzenka (20/05/03)
+// 3. some member functions added, corrections for Win32 and Linux compatibility
+//    by M. Burgis (10/03/08)
+//
+// Requirements:
+// * gnuplot has to be installed (http://www.gnuplot.info/download.html)
+// * for Windows: set Path-Variable for Gnuplot path (e.g. C:/program files/gnuplot/bin)
+//             or set Gnuplot path with: Gnuplot::set_GNUPlotPath(const std::string &path);
+//
+////////////////////////////////////////////////////////////////////////////////////////
+
+
+#ifndef _GNUPLOT_PIPES_H_
+#define _GNUPLOT_PIPES_H_
+
+
+#include <string>
+#include <vector>
+#include <fstream>    // for std::ifstream
+#include <stdexcept>  // for std::runtime_error class in GnuplotException
+#include <cstdio>     // for FILE (identifies a stream and contains a pointer to its buffer, its position indicator and all its state indicators)
+
+
+//declare classes in global namespace
+
+
+class GnuplotException : public std::runtime_error
+{
+    public:
+        GnuplotException(const std::string &msg) : std::runtime_error(msg){}
+};
+
+
+
+class Gnuplot
+{
+    private:
+
+    //----------------------------------------------------------------------------------
+    // member data
+        FILE                    *gnucmd;       // pointer to the stream that can be used to write to the pipe
+        bool                     valid;        // validation of gnuplot session
+        bool                     two_dim;      // true = 2d, false = 3d
+        int                      nplots;       // number of plots in session
+        std::string              pstyle;       // functions and data are displayed in a defined styles
+        std::string              smooth;       // interpolate and approximate data in defined styles (e.g. spline)
+        std::vector<std::string> tmpfile_list; // list of created tmpfiles
+
+    //----------------------------------------------------------------------------------
+    // static data
+        static int               tmpfile_num;        // number of all tmpfiles (number of tmpfiles restricted)
+        static std::string       m_sGNUPlotFileName; // name of executed GNUPlot file
+        static std::string       m_sGNUPlotPath;     // gnuplot path
+        static std::string       terminal_std;       // standart terminal, used by showonscreen
+
+    //----------------------------------------------------------------------------------
+    // member functions (auxiliary functions)
+        void           init();                              // get_program_path(); and popen();
+        std::string    create_tmpfile(std::ofstream &tmp);  // creates tmpfile and returns its name
+
+    //----------------------------------------------------------------------------------
+    //static functions
+        static bool    get_program_path();                                   // gnuplot path found?
+        static bool    file_exists(const std::string &filename, int mode=0); // checks if file exists
+
+
+//--------------------------------------------------------------------------------------
+//--------------------------------------------------------------------------------------
+    public:
+
+        // optional: set Gnuplot path manual
+        //   for windows: path with slash '/' not backslash '\'
+        static bool set_GNUPlotPath(const std::string &path);
+
+        // optional: set standart terminal, used by showonscreen
+        //   defaults: Windows - win, Linux - x11, Mac - aqua
+        static void set_terminal_std(const std::string &type);
+
+    //----------------------------------------------------------------------------------
+    // constructors
+
+        // set a style during construction
+        Gnuplot(const std::string &style = "points");
+
+        // plot a single std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y");
+
+        // plot pairs std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::vector<double> &y,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y");
+
+        // plot triples std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::vector<double> &y,
+                const std::vector<double> &z,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y",
+                const std::string &labelz = "z");
+
+        // destructor: needed to delete temporary files
+        ~Gnuplot();
+
+
+    //----------------------------------------------------------------------------------
+
+        // send a command to gnuplot
+        Gnuplot& cmd(const std::string &cmdstr);
+        Gnuplot& operator<<(const std::string &cmdstr);
+
+
+    //----------------------------------------------------------------------------------
+    // show on screen or write to file
+
+        // sets terminal type to terminal_std
+        Gnuplot& showonscreen(); // window output is set by default (win/x11/aqua)
+
+        // saves a gnuplot session to a postscript file, filename without extension
+        Gnuplot& savetops(const std::string &filename = "gnuplot_output");
+
+
+    //----------------------------------------------------------------------------------
+    // set and unset
+
+        // set line style (some of these styles require additional information):
+        //  lines, points, linespoints, impulses, dots, steps, fsteps, histeps,
+        //  boxes, histograms, filledcurves
+        Gnuplot& set_style(const std::string &stylestr = "points");
+
+        // interpolation and approximation of data, arguments:
+        //  csplines, bezier, acsplines (for data values > 0), sbezier, unique, frequency
+        // (works only with plot_x, plot_xy, plotfile_x, plotfile_xy
+        // (if smooth is set, set_style has no effekt on data plotting)
+        Gnuplot& set_smooth(const std::string &stylestr = "csplines");
+        Gnuplot& unset_smooth(); // smooth is not set by default
+
+        // scales the size of the points used in plots
+        Gnuplot& set_pointsize(const double pointsize = 1.0);
+
+        // turns grid on/off
+        Gnuplot& set_grid();
+        Gnuplot& unset_grid(); // grid is not set by default
+
+        // set sampling rate of functions, or for interpolating data
+        Gnuplot& set_samples(const int samples = 100);
+        // set isoline density (grid) for plotting functions as surfaces (for 3d plots)
+        Gnuplot& set_isosamples(const int isolines = 10);
+
+        // enables/disables hidden line removal for surface plotting (for 3d plot)
+        Gnuplot& set_hidden3d();
+        Gnuplot& unset_hidden3d(); // hidden3d is not set by default
+
+        // enables/disables contour drawing for surfaces (for 3d plot)
+        //  base, surface, both
+        Gnuplot& set_contour(const std::string &position = "base");
+        Gnuplot& unset_contour(); // contour is not set by default
+
+        // enables/disables the display of surfaces (for 3d plot)
+        Gnuplot& set_surface(); // surface is set by default
+        Gnuplot& unset_surface();
+
+        // switches legend on/off
+        // position: inside/outside, left/center/right, top/center/bottom, nobox/box
+        Gnuplot& set_legend(const std::string &position = "default"); // legend is set by default
+        Gnuplot& unset_legend();
+
+        // sets and clears the title of a gnuplot session
+        Gnuplot& set_title(const std::string &title = "");
+        Gnuplot& unset_title(); // title is not set by default
+
+        // set y and x axis labels
+        Gnuplot& set_ylabel(const std::string &label = "x");
+        Gnuplot& set_xlabel(const std::string &label = "y");
+        Gnuplot& set_zlabel(const std::string &label = "z");
+
+        // set axis - ranges
+        Gnuplot& set_xrange(const int iFrom,
+                            const int iTo);
+        Gnuplot& set_yrange(const int iFrom,
+                            const int iTo);
+        Gnuplot& set_zrange(const int iFrom,
+                            const int iTo);
+        // autoscale axis (set by default)
+        Gnuplot& set_xautoscale();
+        Gnuplot& set_yautoscale();
+        Gnuplot& set_zautoscale();
+
+
+        // turns on/off log scaling for the specified axes (logscale is not set by default)
+        Gnuplot& set_xlogscale(const double base = 10);
+        Gnuplot& set_ylogscale(const double base = 10);
+        Gnuplot& set_zlogscale(const double base = 10);
+        Gnuplot& unset_xlogscale();
+        Gnuplot& unset_ylogscale();
+        Gnuplot& unset_zlogscale();
+
+        // set palette range (autoscale by default)
+        Gnuplot& set_cbrange(const int iFrom, const int iTo);
+
+
+    //----------------------------------------------------------------------------------
+    // plot
+
+        // plot a single std::vector: x
+        //   from file
+        Gnuplot& plotfile_x(const std::string &filename,
+                            const int column = 1,
+                            const std::string &title = "");
+        //   from std::vector
+        template<typename X>
+        Gnuplot& plot_x(const X& x, const std::string &title = "");
+
+
+        // plot x,y pairs: x y
+        //   from file
+        Gnuplot& plotfile_xy(const std::string &filename,
+                             const int column_x = 1,
+                             const int column_y = 2,
+                             const std::string &title = "");
+        //   from std::vector
+        template<typename X, typename Y>
+        Gnuplot& plot_xy(const X& x, const Y& y, const std::string &title = "");
+
+
+        // plot x,y pairs with dy errorbars: x y dy
+        //   from file
+        Gnuplot& plotfile_xy_err(const std::string &filename,
+                                 const int column_x  = 1,
+                                 const int column_y  = 2,
+                                 const int column_dy = 3,
+                                 const std::string &title = "");
+        //   from std::vector
+        Gnuplot& plot_xy_err(const std::vector<double> &x,
+                             const std::vector<double> &y,
+                             const std::vector<double> &dy,
+                             const std::string &title = "");
+
+
+        // plot x,y,z triples: x y z
+        //   from file
+        Gnuplot& plotfile_xyz(const std::string &filename,
+                              const int column_x = 1,
+                              const int column_y = 2,
+                              const int column_z = 3,
+                              const std::string &title = "");
+        //   from std::vector
+        Gnuplot& plot_xyz(const std::vector<double> &x,
+                          const std::vector<double> &y,
+                          const std::vector<double> &z,
+                          const std::string &title = "");
+
+
+
+        // plot an equation of the form: y = ax + b, you supply a and b
+        Gnuplot& plot_slope(const double a,
+                            const double b,
+                            const std::string &title = "");
+
+
+        // plot an equation supplied as a std::string y=f(x), write only the function f(x) not y=
+        // the independent variable has to be x
+        // binary operators: ** exponentiation, * multiply, / divide, + add, - substract, % modulo
+        // unary operators: - minus, ! factorial
+        // elementary functions: rand(x), abs(x), sgn(x), ceil(x), floor(x), int(x), imag(x), real(x), arg(x),
+        //   sqrt(x), exp(x), log(x), log10(x), sin(x), cos(x), tan(x), asin(x), acos(x), atan(x), atan2(y,x),
+        //   sinh(x), cosh(x), tanh(x), asinh(x), acosh(x), atanh(x)
+        // special functions: erf(x), erfc(x), inverf(x), gamma(x), igamma(a,x), lgamma(x), ibeta(p,q,x),
+        //   besj0(x), besj1(x), besy0(x), besy1(x), lambertw(x)
+        // statistical fuctions: norm(x), invnorm(x)
+        Gnuplot& plot_equation(const std::string &equation,
+                               const std::string &title = "");
+
+        // plot an equation supplied as a std::string z=f(x,y), write only the function f(x,y) not z=
+        // the independent variables have to be x and y
+        Gnuplot& plot_equation3d(const std::string &equation,
+                                 const std::string &title = "");
+
+
+        // plot image
+        Gnuplot& plot_image(const unsigned char * ucPicBuf,
+                            const int iWidth,
+                            const int iHeight,
+                            const std::string &title = "");
+
+
+    //----------------------------------------------------------------------------------
+
+        // replot repeats the last plot or splot command.
+        //  this can be useful for viewing a plot with different set options,
+        //  or when generating the same plot for several devices (showonscreen, savetops)
+        Gnuplot& replot();
+
+
+        // resets a gnuplot session (next plot will erase previous ones)
+        Gnuplot& reset_plot();
+
+        // resets a gnuplot session and sets all variables to default
+        Gnuplot& reset_all();
+
+
+        // validation of gnuplot session
+        bool is_valid();
+
+};
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles: x
+//
+template<typename X>
+Gnuplot& Gnuplot::plot_x(const X& x, const std::string &title)
+{
+    if (x.size() == 0)
+    {
+        throw GnuplotException("std::vector too small");
+        return *this;
+    }
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+        tmp << x[i] << std::endl;
+
+    tmp.flush();
+    tmp.close();
+
+
+    plotfile_x(name, 1, title);
+
+    return *this;
+}
+
+ 
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles: x y
+//
+template<typename X, typename Y>
+Gnuplot& Gnuplot::plot_xy(const X& x, const Y& y, const std::string &title)
+{
+    if (x.size() == 0 || y.size() == 0)
+    {
+        throw GnuplotException("std::vectors too small");
+        return *this;
+    }
+
+    if (x.size() != y.size())
+    {
+        throw GnuplotException("Length of the std::vectors differs");
+        return *this;
+    }
+
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+        tmp << x[i] << " " << y[i] << std::endl;
+
+    tmp.flush();
+    tmp.close();
+
+
+    plotfile_xy(name, 1, 2, title);
+
+    return *this;
+}
+
+#endif
diff -Naur orig.src/UnitTests/UnitTests/gnuplot.h coral/UnitTests/UnitTests/gnuplot.h
--- orig.src/UnitTests/UnitTests/gnuplot.h	1970-01-01 01:00:00.000000000 +0100
+++ src/UnitTests/UnitTests/gnuplot.h	2008-11-03 20:18:35.000000000 +0100
@@ -0,0 +1,404 @@
+////////////////////////////////////////////////////////////////////////////////////////
+//
+// A C++ interface to gnuplot.
+//
+//
+// The interface uses pipes and so won't run on a system that doesn't have POSIX pipe support
+// Tested on Windows (MinGW and Visual C++) and Linux (GCC)
+//
+// Version history:
+// 0. C interface
+//    by N. Devillard (27/01/03)
+// 1. C++ interface: direct translation from the C interface
+//    by Rajarshi Guha (07/03/03)
+// 2. corrections for Win32 compatibility
+//    by V. Chyzhdzenka (20/05/03)
+// 3. some member functions added, corrections for Win32 and Linux compatibility
+//    by M. Burgis (10/03/08)
+//
+// Requirements:
+// * gnuplot has to be installed (http://www.gnuplot.info/download.html)
+// * for Windows: set Path-Variable for Gnuplot path (e.g. C:/program files/gnuplot/bin)
+//             or set Gnuplot path with: Gnuplot::set_GNUPlotPath(const std::string &path);
+//
+////////////////////////////////////////////////////////////////////////////////////////
+
+
+#ifndef _GNUPLOT_PIPES_H_
+#define _GNUPLOT_PIPES_H_
+
+
+#include <string>
+#include <vector>
+#include <fstream>    // for std::ifstream
+#include <stdexcept>  // for std::runtime_error class in GnuplotException
+#include <cstdio>     // for FILE (identifies a stream and contains a pointer to its buffer, its position indicator and all its state indicators)
+
+
+//declare classes in global namespace
+
+
+class GnuplotException : public std::runtime_error
+{
+    public:
+        GnuplotException(const std::string &msg) : std::runtime_error(msg){}
+};
+
+
+
+class Gnuplot
+{
+    private:
+
+    //----------------------------------------------------------------------------------
+    // member data
+        FILE                    *gnucmd;       // pointer to the stream that can be used to write to the pipe
+        bool                     valid;        // validation of gnuplot session
+        bool                     two_dim;      // true = 2d, false = 3d
+        int                      nplots;       // number of plots in session
+        std::string              pstyle;       // functions and data are displayed in a defined styles
+        std::string              smooth;       // interpolate and approximate data in defined styles (e.g. spline)
+        std::vector<std::string> tmpfile_list; // list of created tmpfiles
+
+    //----------------------------------------------------------------------------------
+    // static data
+        static int               tmpfile_num;        // number of all tmpfiles (number of tmpfiles restricted)
+        static std::string       m_sGNUPlotFileName; // name of executed GNUPlot file
+        static std::string       m_sGNUPlotPath;     // gnuplot path
+        static std::string       terminal_std;       // standart terminal, used by showonscreen
+
+    //----------------------------------------------------------------------------------
+    // member functions (auxiliary functions)
+        void           init();                              // get_program_path(); and popen();
+        std::string    create_tmpfile(std::ofstream &tmp);  // creates tmpfile and returns its name
+
+    //----------------------------------------------------------------------------------
+    //static functions
+        static bool    get_program_path();                                   // gnuplot path found?
+        static bool    file_exists(const std::string &filename, int mode=0); // checks if file exists
+
+
+//--------------------------------------------------------------------------------------
+//--------------------------------------------------------------------------------------
+    public:
+
+        // optional: set Gnuplot path manual
+        //   for windows: path with slash '/' not backslash '\'
+        static bool set_GNUPlotPath(const std::string &path);
+
+        // optional: set standart terminal, used by showonscreen
+        //   defaults: Windows - win, Linux - x11, Mac - aqua
+        static void set_terminal_std(const std::string &type);
+
+    //----------------------------------------------------------------------------------
+    // constructors
+
+        // set a style during construction
+        Gnuplot(const std::string &style = "points");
+
+        // plot a single std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y");
+
+        // plot pairs std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::vector<double> &y,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y");
+
+        // plot triples std::vector at one go
+        Gnuplot(const std::vector<double> &x,
+                const std::vector<double> &y,
+                const std::vector<double> &z,
+                const std::string &title = "",
+                const std::string &style = "points",
+                const std::string &labelx = "x",
+                const std::string &labely = "y",
+                const std::string &labelz = "z");
+
+        // destructor: needed to delete temporary files
+        ~Gnuplot();
+
+
+    //----------------------------------------------------------------------------------
+
+        // send a command to gnuplot
+        Gnuplot& cmd(const std::string &cmdstr);
+        Gnuplot& operator<<(const std::string &cmdstr);
+
+
+    //----------------------------------------------------------------------------------
+    // show on screen or write to file
+
+        // sets terminal type to terminal_std
+        Gnuplot& showonscreen(); // window output is set by default (win/x11/aqua)
+
+        // saves a gnuplot session to a postscript file, filename without extension
+        Gnuplot& savetops(const std::string &filename = "gnuplot_output");
+
+
+    //----------------------------------------------------------------------------------
+    // set and unset
+
+        // set line style (some of these styles require additional information):
+        //  lines, points, linespoints, impulses, dots, steps, fsteps, histeps,
+        //  boxes, histograms, filledcurves
+        Gnuplot& set_style(const std::string &stylestr = "points");
+
+        // interpolation and approximation of data, arguments:
+        //  csplines, bezier, acsplines (for data values > 0), sbezier, unique, frequency
+        // (works only with plot_x, plot_xy, plotfile_x, plotfile_xy
+        // (if smooth is set, set_style has no effekt on data plotting)
+        Gnuplot& set_smooth(const std::string &stylestr = "csplines");
+        Gnuplot& unset_smooth(); // smooth is not set by default
+
+        // scales the size of the points used in plots
+        Gnuplot& set_pointsize(const double pointsize = 1.0);
+
+        // turns grid on/off
+        Gnuplot& set_grid();
+        Gnuplot& unset_grid(); // grid is not set by default
+
+        // set sampling rate of functions, or for interpolating data
+        Gnuplot& set_samples(const int samples = 100);
+        // set isoline density (grid) for plotting functions as surfaces (for 3d plots)
+        Gnuplot& set_isosamples(const int isolines = 10);
+
+        // enables/disables hidden line removal for surface plotting (for 3d plot)
+        Gnuplot& set_hidden3d();
+        Gnuplot& unset_hidden3d(); // hidden3d is not set by default
+
+        // enables/disables contour drawing for surfaces (for 3d plot)
+        //  base, surface, both
+        Gnuplot& set_contour(const std::string &position = "base");
+        Gnuplot& unset_contour(); // contour is not set by default
+
+        // enables/disables the display of surfaces (for 3d plot)
+        Gnuplot& set_surface(); // surface is set by default
+        Gnuplot& unset_surface();
+
+        // switches legend on/off
+        // position: inside/outside, left/center/right, top/center/bottom, nobox/box
+        Gnuplot& set_legend(const std::string &position = "default"); // legend is set by default
+        Gnuplot& unset_legend();
+
+        // sets and clears the title of a gnuplot session
+        Gnuplot& set_title(const std::string &title = "");
+        Gnuplot& unset_title(); // title is not set by default
+
+        // set y and x axis labels
+        Gnuplot& set_ylabel(const std::string &label = "x");
+        Gnuplot& set_xlabel(const std::string &label = "y");
+        Gnuplot& set_zlabel(const std::string &label = "z");
+
+        // set axis - ranges
+        Gnuplot& set_xrange(const int iFrom,
+                            const int iTo);
+        Gnuplot& set_yrange(const int iFrom,
+                            const int iTo);
+        Gnuplot& set_zrange(const int iFrom,
+                            const int iTo);
+        // autoscale axis (set by default)
+        Gnuplot& set_xautoscale();
+        Gnuplot& set_yautoscale();
+        Gnuplot& set_zautoscale();
+
+
+        // turns on/off log scaling for the specified axes (logscale is not set by default)
+        Gnuplot& set_xlogscale(const double base = 10);
+        Gnuplot& set_ylogscale(const double base = 10);
+        Gnuplot& set_zlogscale(const double base = 10);
+        Gnuplot& unset_xlogscale();
+        Gnuplot& unset_ylogscale();
+        Gnuplot& unset_zlogscale();
+
+        // set palette range (autoscale by default)
+        Gnuplot& set_cbrange(const int iFrom, const int iTo);
+
+
+    //----------------------------------------------------------------------------------
+    // plot
+
+        // plot a single std::vector: x
+        //   from file
+        Gnuplot& plotfile_x(const std::string &filename,
+                            const int column = 1,
+                            const std::string &title = "");
+        //   from std::vector
+        template<typename X>
+        Gnuplot& plot_x(const X& x, const std::string &title = "");
+
+
+        // plot x,y pairs: x y
+        //   from file
+        Gnuplot& plotfile_xy(const std::string &filename,
+                             const int column_x = 1,
+                             const int column_y = 2,
+                             const std::string &title = "");
+        //   from std::vector
+        template<typename X, typename Y>
+        Gnuplot& plot_xy(const X& x, const Y& y, const std::string &title = "");
+
+
+        // plot x,y pairs with dy errorbars: x y dy
+        //   from file
+        Gnuplot& plotfile_xy_err(const std::string &filename,
+                                 const int column_x  = 1,
+                                 const int column_y  = 2,
+                                 const int column_dy = 3,
+                                 const std::string &title = "");
+        //   from std::vector
+        Gnuplot& plot_xy_err(const std::vector<double> &x,
+                             const std::vector<double> &y,
+                             const std::vector<double> &dy,
+                             const std::string &title = "");
+
+
+        // plot x,y,z triples: x y z
+        //   from file
+        Gnuplot& plotfile_xyz(const std::string &filename,
+                              const int column_x = 1,
+                              const int column_y = 2,
+                              const int column_z = 3,
+                              const std::string &title = "");
+        //   from std::vector
+        Gnuplot& plot_xyz(const std::vector<double> &x,
+                          const std::vector<double> &y,
+                          const std::vector<double> &z,
+                          const std::string &title = "");
+
+
+
+        // plot an equation of the form: y = ax + b, you supply a and b
+        Gnuplot& plot_slope(const double a,
+                            const double b,
+                            const std::string &title = "");
+
+
+        // plot an equation supplied as a std::string y=f(x), write only the function f(x) not y=
+        // the independent variable has to be x
+        // binary operators: ** exponentiation, * multiply, / divide, + add, - substract, % modulo
+        // unary operators: - minus, ! factorial
+        // elementary functions: rand(x), abs(x), sgn(x), ceil(x), floor(x), int(x), imag(x), real(x), arg(x),
+        //   sqrt(x), exp(x), log(x), log10(x), sin(x), cos(x), tan(x), asin(x), acos(x), atan(x), atan2(y,x),
+        //   sinh(x), cosh(x), tanh(x), asinh(x), acosh(x), atanh(x)
+        // special functions: erf(x), erfc(x), inverf(x), gamma(x), igamma(a,x), lgamma(x), ibeta(p,q,x),
+        //   besj0(x), besj1(x), besy0(x), besy1(x), lambertw(x)
+        // statistical fuctions: norm(x), invnorm(x)
+        Gnuplot& plot_equation(const std::string &equation,
+                               const std::string &title = "");
+
+        // plot an equation supplied as a std::string z=f(x,y), write only the function f(x,y) not z=
+        // the independent variables have to be x and y
+        Gnuplot& plot_equation3d(const std::string &equation,
+                                 const std::string &title = "");
+
+
+        // plot image
+        Gnuplot& plot_image(const unsigned char * ucPicBuf,
+                            const int iWidth,
+                            const int iHeight,
+                            const std::string &title = "");
+
+
+    //----------------------------------------------------------------------------------
+
+        // replot repeats the last plot or splot command.
+        //  this can be useful for viewing a plot with different set options,
+        //  or when generating the same plot for several devices (showonscreen, savetops)
+        Gnuplot& replot();
+
+
+        // resets a gnuplot session (next plot will erase previous ones)
+        Gnuplot& reset_plot();
+
+        // resets a gnuplot session and sets all variables to default
+        Gnuplot& reset_all();
+
+
+        // validation of gnuplot session
+        bool is_valid();
+
+};
+
+
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles: x
+//
+template<typename X>
+Gnuplot& Gnuplot::plot_x(const X& x, const std::string &title)
+{
+    if (x.size() == 0)
+    {
+        throw GnuplotException("std::vector too small");
+        return *this;
+    }
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+        tmp << x[i] << std::endl;
+
+    tmp.flush();
+    tmp.close();
+
+
+    plotfile_x(name, 1, title);
+
+    return *this;
+}
+
+ 
+//----------------------------------------------------------------------------------
+//
+// Plots a 2d graph from a list of doubles: x y
+//
+template<typename X, typename Y>
+Gnuplot& Gnuplot::plot_xy(const X& x, const Y& y, const std::string &title)
+{
+    if (x.size() == 0 || y.size() == 0)
+    {
+        throw GnuplotException("std::vectors too small");
+        return *this;
+    }
+
+    if (x.size() != y.size())
+    {
+        throw GnuplotException("Length of the std::vectors differs");
+        return *this;
+    }
+
+
+    std::ofstream tmp;
+    std::string name = create_tmpfile(tmp);
+    if (name == "")
+        return *this;
+
+    //
+    // write the data to file
+    //
+    for (unsigned int i = 0; i < x.size(); i++)
+        tmp << x[i] << " " << y[i] << std::endl;
+
+    tmp.flush();
+    tmp.close();
+
+
+    plotfile_xy(name, 1, 2, title);
+
+    return *this;
+}
+
+#endif
